<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>9.1 Leçon | SCI 1031 Visualisation et analyse de données spatiales sous R</title>
  <meta name="description" content="Ce cours est une introduction à la visualisation et l’analyse de données spatiales sous R. Il est offert à la TÉLUQ sous le sigle SCI 1031." />
  <meta name="generator" content="bookdown 0.32 and GitBook 2.6.7" />

  <meta property="og:title" content="9.1 Leçon | SCI 1031 Visualisation et analyse de données spatiales sous R" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="Ce cours est une introduction à la visualisation et l’analyse de données spatiales sous R. Il est offert à la TÉLUQ sous le sigle SCI 1031." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="9.1 Leçon | SCI 1031 Visualisation et analyse de données spatiales sous R" />
  
  <meta name="twitter:description" content="Ce cours est une introduction à la visualisation et l’analyse de données spatiales sous R. Il est offert à la TÉLUQ sous le sigle SCI 1031." />
  

<meta name="author" content="" />


<meta name="date" content="2023-03-07" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="spatiotemp.html"/>
<link rel="next" href="ex_spatiotemp.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
<script src="libs/htmlwidgets-1.6.1/htmlwidgets.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/proj4-2.6.2/proj4.min.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.1.1/leaflet.js"></script>
<script src="libs/FlatGeoBuf-3.21.3/fgb.js"></script>
<script src="libs/FlatGeoBuf-3.21.3/flatgeobuf-geojson.min.js"></script>
<script src="libs/chromajs-2.1.0/chroma.min.js"></script>
<link id="multi_point-1-attachment" rel="attachment" href="libs/multi_point-0.0.1/multi_point_layer.fgb"/>
<link href="libs/HomeButton-0.0.1/home-button.css" rel="stylesheet" />
<script src="libs/HomeButton-0.0.1/home-button.js"></script>
<script src="libs/HomeButton-0.0.1/easy-button-src.min.js"></script>
<script src="libs/clipboard-0.0.1/setClipboardText.js"></script>
<link href="libs/mapviewCSS-0.0.1/mapview-popup.css" rel="stylesheet" />
<link href="libs/mapviewCSS-0.0.1/mapview.css" rel="stylesheet" />
<link id="ligne-1-attachment" rel="attachment" href="libs/ligne-0.0.1/ligne_layer.fgb"/>
<link id="polygone-1-attachment" rel="attachment" href="libs/polygone-0.0.1/polygone_layer.fgb"/>
<script src="libs/Leaflet.Sync-0.0.5/L.Map.Sync.js"></script>
<script src="libs/leaflet-providers-1.9.0/leaflet-providers_1.9.0.js"></script>
<script src="libs/leaflet-providers-plugin-2.1.1/leaflet-providers-plugin.js"></script>
<link id="limites_terrestres-1-attachment" rel="attachment" href="libs/limites_terrestres-0.0.1/limites_terrestres_layer.fgb"/>
<link id="pistes_cyclables-1-attachment" rel="attachment" href="libs/pistes_cyclables-0.0.1/pistes_cyclables_layer.fgb"/>
<link id="accidents_velo-1-attachment" rel="attachment" href="libs/accidents_velo-0.0.1/accidents_velo_layer.fgb"/>
<link id="Typesdepistescyclables-1-attachment" rel="attachment" href="libs/Typesdepistescyclables-0.0.1/Typesdepistescyclables_layer.fgb"/>
<link id="limites_terrestres_rob-1-attachment" rel="attachment" href="libs/limites_terrestres_rob-0.0.1/limites_terrestres_rob_layer.fgb"/>
<link id="MercatorWeb-1-attachment" rel="attachment" href="libs/MercatorWeb-0.0.1/MercatorWeb_layer.fgb"/>
<link id="Mercator-1-attachment" rel="attachment" href="libs/Mercator-0.0.1/Mercator_layer.fgb"/>
<link id="Robinson-1-attachment" rel="attachment" href="libs/Robinson-0.0.1/Robinson_layer.fgb"/>
<link id="ecoles_pub-1-attachment" rel="attachment" href="libs/ecoles_pub-0.0.1/ecoles_pub_layer.fgb"/>
<link id="ecoles_pub_Mtl-1-attachment" rel="attachment" href="libs/ecoles_pub_Mtl-0.0.1/ecoles_pub_Mtl_layer.fgb"/>
<link id="Commissionsscolaires-1-attachment" rel="attachment" href="libs/Commissionsscolaires-0.0.1/Commissionsscolaires_layer.fgb"/>
<link id="Enseignement-1-attachment" rel="attachment" href="libs/Enseignement-0.0.1/Enseignement_layer.fgb"/>
<link id="ecoles_priv_Mtl-1-attachment" rel="attachment" href="libs/ecoles_priv_Mtl-0.0.1/ecoles_priv_Mtl_layer.fgb"/>
<link id="college_Mtl-1-attachment" rel="attachment" href="libs/college_Mtl-0.0.1/college_Mtl_layer.fgb"/>
<link id="univ_Mtl-1-attachment" rel="attachment" href="libs/univ_Mtl-0.0.1/univ_Mtl_layer.fgb"/>
<link id="Nomdeslignes-1-attachment" rel="attachment" href="libs/Nomdeslignes-0.0.1/Nomdeslignes_layer.fgb"/>
<link id="Régions-1-attachment" rel="attachment" href="libs/Régions-0.0.1/Régions_layer.fgb"/>
<link id="nz-1-attachment" rel="attachment" href="libs/nz-0.0.1/nz_layer.fgb"/>
<link id="nz_capitales_points-1-attachment" rel="attachment" href="libs/nz_capitales_points-0.0.1/nz_capitales_points_layer.fgb"/>
<script src="libs/M_3dac54-1/data_stars_M6243ec.txt"></script>
<script src="libs/joda-0.0.1/joda.js"></script>
<script src="libs/joda-0.0.1/addImageQuery-bindings.js"></script>
<script src="libs/M_logique_numeric_24d819-1/data_stars_M_logique_numerica45d0e.txt"></script>
<script src="libs/M_factor_ce7b9d-1/data_stars_M_factor2a704e.txt"></script>
<script src="libs/ICU_08bd9c-1/data_stars_ICU9c1b64.txt"></script>
<script src="libs/ICU_1c02e7-1/data_stars_ICU5debf2.txt"></script>
<script src="libs/T_sec_6fe109-1/data_stars_T_sec4ea06f.txt"></script>
<script src="libs/T_fact4_moy_97b162-1/data_stars_T_fact4_moy9537e8.txt"></script>
<script src="libs/T_fact4_max_e1953c-1/data_stars_T_fact4_maxd3025a.txt"></script>
<script src="libs/T_fact8_moy_8f6234-1/data_stars_T_fact8_moy923a6e.txt"></script>
<script src="libs/T_fact8_max_502368-1/data_stars_T_fact8_maxf046ab.txt"></script>
<script src="libs/SR_659a4b-1/data_stars_SR4615bc.txt"></script>
<script src="libs/SG_712b5c-1/data_stars_SG1c8503.txt"></script>
<script src="libs/SB_d61e25-1/data_stars_SB85dcb9.txt"></script>
<script src="libs/R2001f_cf5170-1/data_stars_R2001f86d359.txt"></script>
<script src="libs/R2001f_601c3f-1/data_stars_R2001fe81fc7.txt"></script>
<script src="libs/R2016f_f2e104-1/data_stars_R2016fb43260.txt"></script>
<link id="municipalites-1-attachment" rel="attachment" href="libs/municipalites-0.0.1/municipalites_layer.fgb"/>
<link id="la_poc-1-attachment" rel="attachment" href="libs/la_poc-0.0.1/la_poc_layer.fgb"/>
<link id="regions-1-attachment" rel="attachment" href="libs/regions-0.0.1/regions_layer.fgb"/>
<link id="villes_reg-1-attachment" rel="attachment" href="libs/villes_reg-0.0.1/villes_reg_layer.fgb"/>
<link id="villes_reg-Rgns_Ad-1-attachment" rel="attachment" href="libs/villes_reg-Rgns_Ad-0.0.1/villes_reg-Rgns_Ad_layer.fgb"/>
<link id="villes_CN-1-attachment" rel="attachment" href="libs/villes_CN-0.0.1/villes_CN_layer.fgb"/>
<link id="reg_pop2-1-attachment" rel="attachment" href="libs/reg_pop2-0.0.1/reg_pop2_layer.fgb"/>
<link id="regions_nad-1-attachment" rel="attachment" href="libs/regions_nad-0.0.1/regions_nad_layer.fgb"/>
<link id="regions_simple_10-1-attachment" rel="attachment" href="libs/regions_simple_10-0.0.1/regions_simple_10_layer.fgb"/>
<link id="regions_simple_40-1-attachment" rel="attachment" href="libs/regions_simple_40-0.0.1/regions_simple_40_layer.fgb"/>
<link id="GIM-Nom_reg-1-attachment" rel="attachment" href="libs/GIM-Nom_reg-0.0.1/GIM-Nom_reg_layer.fgb"/>
<link id="GIM_combine-1-attachment" rel="attachment" href="libs/GIM_combine-0.0.1/GIM_combine_layer.fgb"/>
<link id="GIM_union-1-attachment" rel="attachment" href="libs/GIM_union-0.0.1/GIM_union_layer.fgb"/>
<link id="Mauricie-1-attachment" rel="attachment" href="libs/Mauricie-0.0.1/Mauricie_layer.fgb"/>
<link id="Mauricie_lines-1-attachment" rel="attachment" href="libs/Mauricie_lines-0.0.1/Mauricie_lines_layer.fgb"/>
<link id="Mauricie_pts-1-attachment" rel="attachment" href="libs/Mauricie_pts-0.0.1/Mauricie_pts_layer.fgb"/>
<link id="villes_NQ_combo-1-attachment" rel="attachment" href="libs/villes_NQ_combo-0.0.1/villes_NQ_combo_layer.fgb"/>
<link id="villes_NQ_lines-1-attachment" rel="attachment" href="libs/villes_NQ_lines-0.0.1/villes_NQ_lines_layer.fgb"/>
<link id="villes_NQ_pol-1-attachment" rel="attachment" href="libs/villes_NQ_pol-0.0.1/villes_NQ_pol_layer.fgb"/>
<link id="la_poc_tampon50-1-attachment" rel="attachment" href="libs/la_poc_tampon50-0.0.1/la_poc_tampon50_layer.fgb"/>
<link id="la_poc_tampon10-1-attachment" rel="attachment" href="libs/la_poc_tampon10-0.0.1/la_poc_tampon10_layer.fgb"/>
<link id="SagStJean_tampon50-1-attachment" rel="attachment" href="libs/SagStJean_tampon50-0.0.1/SagStJean_tampon50_layer.fgb"/>
<link id="SagStJean-1-attachment" rel="attachment" href="libs/SagStJean-0.0.1/SagStJean_layer.fgb"/>
<link id="Abitibi_tampon20-1-attachment" rel="attachment" href="libs/Abitibi_tampon20-0.0.1/Abitibi_tampon20_layer.fgb"/>
<link id="Abitibi-1-attachment" rel="attachment" href="libs/Abitibi-0.0.1/Abitibi_layer.fgb"/>
<link id="centre_SagStJean-1-attachment" rel="attachment" href="libs/centre_SagStJean-0.0.1/centre_SagStJean_layer.fgb"/>
<link id="centre_Abitibi-1-attachment" rel="attachment" href="libs/centre_Abitibi-0.0.1/centre_Abitibi_layer.fgb"/>
<link id="A-1-attachment" rel="attachment" href="libs/A-0.0.1/A_layer.fgb"/>
<link id="B-1-attachment" rel="attachment" href="libs/B-0.0.1/B_layer.fgb"/>
<link id="union_AB-1-attachment" rel="attachment" href="libs/union_AB-0.0.1/union_AB_layer.fgb"/>
<link id="diff_AB-1-attachment" rel="attachment" href="libs/diff_AB-0.0.1/diff_AB_layer.fgb"/>
<link id="diff_BA-1-attachment" rel="attachment" href="libs/diff_BA-0.0.1/diff_BA_layer.fgb"/>
<link id="inter_AB-1-attachment" rel="attachment" href="libs/inter_AB-0.0.1/inter_AB_layer.fgb"/>
<link id="sym_diff_AB-1-attachment" rel="attachment" href="libs/sym_diff_AB-0.0.1/sym_diff_AB_layer.fgb"/>
<link id="point_bleu-1-attachment" rel="attachment" href="libs/point_bleu-0.0.1/point_bleu_layer.fgb"/>
<link id="point_rouge-1-attachment" rel="attachment" href="libs/point_rouge-0.0.1/point_rouge_layer.fgb"/>
<link id="point_violet-1-attachment" rel="attachment" href="libs/point_violet-0.0.1/point_violet_layer.fgb"/>
<link id="point_jaune-1-attachment" rel="attachment" href="libs/point_jaune-0.0.1/point_jaune_layer.fgb"/>
<link id="point_vert-1-attachment" rel="attachment" href="libs/point_vert-0.0.1/point_vert_layer.fgb"/>
<link id="trait_bleu-1-attachment" rel="attachment" href="libs/trait_bleu-0.0.1/trait_bleu_layer.fgb"/>
<link id="trait_mauve-1-attachment" rel="attachment" href="libs/trait_mauve-0.0.1/trait_mauve_layer.fgb"/>
<link id="contour_rose-1-attachment" rel="attachment" href="libs/contour_rose-0.0.1/contour_rose_layer.fgb"/>
<link id="trait_vert-1-attachment" rel="attachment" href="libs/trait_vert-0.0.1/trait_vert_layer.fgb"/>
<link id="top10_villes-population-1-attachment" rel="attachment" href="libs/top10_villes-population-0.0.1/top10_villes-population_layer.fgb"/>
<link id="parcs_nationaux-TRQ_NM_TER-1-attachment" rel="attachment" href="libs/parcs_nationaux-TRQ_NM_TER-0.0.1/parcs_nationaux-TRQ_NM_TER_layer.fgb"/>
<link id="top10_villes_buffer-toponyme-1-attachment" rel="attachment" href="libs/top10_villes_buffer-toponyme-0.0.1/top10_villes_buffer-toponyme_layer.fgb"/>
<link id="Poly_Selection-1-attachment" rel="attachment" href="libs/Poly_Selection-0.0.1/Poly_Selection_layer.fgb"/>
<link id="Frontiere-1-attachment" rel="attachment" href="libs/Frontiere-0.0.1/Frontiere_layer.fgb"/>
<link id="Frontiere_tampon-1-attachment" rel="attachment" href="libs/Frontiere_tampon-0.0.1/Frontiere_tampon_layer.fgb"/>
<link id="Villes_Frontiere_tampon-1-attachment" rel="attachment" href="libs/Villes_Frontiere_tampon-0.0.1/Villes_Frontiere_tampon_layer.fgb"/>
<link id="Sherb_Fermont-1-attachment" rel="attachment" href="libs/Sherb_Fermont-0.0.1/Sherb_Fermont_layer.fgb"/>
<link id="Sherb_Fermont_ligne-1-attachment" rel="attachment" href="libs/Sherb_Fermont_ligne-0.0.1/Sherb_Fermont_ligne_layer.fgb"/>
<link id="regions_traversees-1-attachment" rel="attachment" href="libs/regions_traversees-0.0.1/regions_traversees_layer.fgb"/>
<link id="Parcs_SJSR_tampon-1-attachment" rel="attachment" href="libs/Parcs_SJSR_tampon-0.0.1/Parcs_SJSR_tampon_layer.fgb"/>
<link id="SJSR_tampon-1-attachment" rel="attachment" href="libs/SJSR_tampon-0.0.1/SJSR_tampon_layer.fgb"/>
<script src="libs/dem_3560e4-1/data_stars_demfc2e97.txt"></script>
<link id="parcs-TRQ_NM_-1-attachment" rel="attachment" href="libs/parcs-TRQ_NM_-0.0.1/parcs-TRQ_NM__layer.fgb"/>
<script src="libs/nouvelles_classes_dem_48f59c-1/data_stars_nouvelles_classes_demb80d6a.txt"></script>
<script src="libs/reclassify(dem, nouvelles_classes2)_401f79-1/data_stars_reclassifydemnouvelles_classes2be12a8.txt"></script>
<script src="libs/dem_cr_72ed4f-1/data_stars_dem_cr85eab4.txt"></script>
<script src="libs/dem_cr_p_5a97d0-1/data_stars_dem_cr_p79cfe8.txt"></script>
<script src="libs/dem_f0c759-1/data_stars_dem5e3ba4.txt"></script>
<link id="pol-1-attachment" rel="attachment" href="libs/pol-0.0.1/pol_layer.fgb"/>
<script src="libs/dem_ma_e7cba5-1/data_stars_dem_ma15ad32.txt"></script>
<script src="libs/dem_ma_inv_ad97b3-1/data_stars_dem_ma_invcf72d4.txt"></script>
<script src="libs/dem_ma_6d1b09-1/data_stars_dem_mab74ac9.txt"></script>
<script src="libs/dem_ma_inv_83541b-1/data_stars_dem_ma_invc3b905.txt"></script>
<script src="libs/dem_merge_38b02d-1/data_stars_dem_mergefb5ce8.txt"></script>
<script src="libs/dem_merge_ordre1_ad9f72-1/data_stars_dem_merge_ordre16b54d7.txt"></script>
<script src="libs/dem_merge_ordre2_1375a8-1/data_stars_dem_merge_ordre2704935.txt"></script>
<script src="libs/dem_mosaic_min_4a527f-1/data_stars_dem_mosaic_min842e69.txt"></script>
<script src="libs/dem_mosaic_max_7ebf91-1/data_stars_dem_mosaic_maxab2f6e.txt"></script>
<script src="libs/dem_mosaic_mean_5210c7-1/data_stars_dem_mosaic_meanc60347.txt"></script>
<script src="libs/dem_parcs_b7dc58-1/data_stars_dem_parcsfa6291.txt"></script>
<script src="libs/dem_parcs_1c49f5-1/data_stars_dem_parcscaf40d.txt"></script>
<link id="parcs-1-attachment" rel="attachment" href="libs/parcs-0.0.1/parcs_layer.fgb"/>
<link id="sf_point_max-1-attachment" rel="attachment" href="libs/sf_point_max-0.0.1/sf_point_max_layer.fgb"/>
<link id="sentiers-1-attachment" rel="attachment" href="libs/sentiers-0.0.1/sentiers_layer.fgb"/>
<link id="sentiers_megantic-1-attachment" rel="attachment" href="libs/sentiers_megantic-0.0.1/sentiers_megantic_layer.fgb"/>
<link id="sentier_top-1-attachment" rel="attachment" href="libs/sentier_top-0.0.1/sentier_top_layer.fgb"/>
<link id="rando_sections-id-1-attachment" rel="attachment" href="libs/rando_sections-id-0.0.1/rando_sections-id_layer.fgb"/>
<script src="libs/dem_orford_b0c536-1/data_stars_dem_orfordd8c4eb.txt"></script>
<script src="libs/dem_orford_948e7a-1/data_stars_dem_orforda0496b.txt"></script>
<link id="pt_max_orford-1-attachment" rel="attachment" href="libs/pt_max_orford-0.0.1/pt_max_orford_layer.fgb"/>
<script src="libs/dem_orford_quantile_0b312c-1/data_stars_dem_orford_quantile18f6a3.txt"></script>
<script src="libs/dem_orford_quantile_0f9176-1/data_stars_dem_orford_quantilea53964.txt"></script>
<link id="pt_max_megantic-1-attachment" rel="attachment" href="libs/pt_max_megantic-0.0.1/pt_max_megantic_layer.fgb"/>
<link id="pt_max_yamaska-1-attachment" rel="attachment" href="libs/pt_max_yamaska-0.0.1/pt_max_yamaska_layer.fgb"/>
<link id="pt_max_frontenac-1-attachment" rel="attachment" href="libs/pt_max_frontenac-0.0.1/pt_max_frontenac_layer.fgb"/>
<script src="libs/dem_tampon_max_3d8604-1/data_stars_dem_tampon_max0b1d25.txt"></script>
<link id="traj_rapide-1-attachment" rel="attachment" href="libs/traj_rapide-0.0.1/traj_rapide_layer.fgb"/>
<link id="traj_long-1-attachment" rel="attachment" href="libs/traj_long-0.0.1/traj_long_layer.fgb"/>
<link id="lin-1-attachment" rel="attachment" href="libs/lin-0.0.1/lin_layer.fgb"/>
<script src="libs/X1_feb029-1/data_stars_X142fba0.txt"></script>
<script src="libs/X2_15467d-1/data_stars_X2d0c268.txt"></script>
<script src="libs/X3_f26aeb-1/data_stars_X3fad68e.txt"></script>
<link id="megantic-1-attachment" rel="attachment" href="libs/megantic-0.0.1/megantic_layer.fgb"/>
<link id="megantic_buf-1-attachment" rel="attachment" href="libs/megantic_buf-0.0.1/megantic_buf_layer.fgb"/>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  background-color: #f8f8f8; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } /* Alert */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #c4a000; } /* Attribute */
code span.bn { color: #0000cf; } /* BaseN */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4e9a06; } /* Char */
code span.cn { color: #000000; } /* Constant */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cf; } /* Float */
code span.fu { color: #000000; } /* Function */
code span.im { } /* Import */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.ot { color: #8f5902; } /* Other */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.sc { color: #000000; } /* SpecialChar */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.st { color: #4e9a06; } /* String */
code span.va { color: #000000; } /* Variable */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="css/extra.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">TELUQ -  SCI 1031.</a></li>

<li class="divider"></li>
<li><a href="index.html#section" id="toc-section"></a></li>
<li class="part"><span><b>I SCI 1031</b></span></li>
<li class="chapter" data-level="" data-path="à-propos-du-cours.html"><a href="à-propos-du-cours.html"><i class="fa fa-check"></i>À propos du cours</a>
<ul>
<li class="chapter" data-level="" data-path="à-propos-du-cours.html"><a href="à-propos-du-cours.html#présentation"><i class="fa fa-check"></i>Présentation</a>
<ul>
<li class="chapter" data-level="" data-path="à-propos-du-cours.html"><a href="à-propos-du-cours.html#pourquoi-suivre-ce-cours"><i class="fa fa-check"></i>Pourquoi suivre ce cours ?</a></li>
<li class="chapter" data-level="" data-path="à-propos-du-cours.html"><a href="à-propos-du-cours.html#pourquoi-r"><i class="fa fa-check"></i>Pourquoi R ?</a></li>
<li class="chapter" data-level="" data-path="à-propos-du-cours.html"><a href="à-propos-du-cours.html#objectifs"><i class="fa fa-check"></i>Objectifs</a></li>
<li class="chapter" data-level="" data-path="à-propos-du-cours.html"><a href="à-propos-du-cours.html#contenu-sommaire"><i class="fa fa-check"></i>Contenu sommaire</a></li>
<li class="chapter" data-level="" data-path="à-propos-du-cours.html"><a href="à-propos-du-cours.html#fonctionnement-du-cours"><i class="fa fa-check"></i>Fonctionnement du cours</a></li>
<li class="chapter" data-level="" data-path="à-propos-du-cours.html"><a href="à-propos-du-cours.html#travaux-notés"><i class="fa fa-check"></i>Travaux notés</a></li>
<li class="chapter" data-level="" data-path="à-propos-du-cours.html"><a href="à-propos-du-cours.html#rétroaction"><i class="fa fa-check"></i>Rétroaction</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="à-propos-du-cours.html"><a href="à-propos-du-cours.html#route"><i class="fa fa-check"></i>Feuille de route</a></li>
<li class="chapter" data-level="" data-path="à-propos-du-cours.html"><a href="à-propos-du-cours.html#crédits"><i class="fa fa-check"></i>Crédits</a>
<ul>
<li class="chapter" data-level="" data-path="à-propos-du-cours.html"><a href="à-propos-du-cours.html#équipe"><i class="fa fa-check"></i>Équipe</a></li>
<li class="chapter" data-level="" data-path="à-propos-du-cours.html"><a href="à-propos-du-cours.html#reproduction-du-contenu"><i class="fa fa-check"></i>Reproduction du contenu</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="à-propos-du-cours.html"><a href="à-propos-du-cours.html#contact"><i class="fa fa-check"></i>Contact</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="ressources.html"><a href="ressources.html"><i class="fa fa-check"></i>Ressources</a>
<ul>
<li class="chapter" data-level="" data-path="ressources.html"><a href="ressources.html#travaux-notés-1"><i class="fa fa-check"></i>Travaux notés</a></li>
<li class="chapter" data-level="" data-path="ressources.html"><a href="ressources.html#données"><i class="fa fa-check"></i>Données</a>
<ul>
<li class="chapter" data-level="" data-path="ressources.html"><a href="ressources.html#données-du-cours"><i class="fa fa-check"></i>Données du cours</a></li>
<li class="chapter" data-level="" data-path="ressources.html"><a href="ressources.html#autres-sources"><i class="fa fa-check"></i>Autres sources</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="ressources.html"><a href="ressources.html#ressources-r"><i class="fa fa-check"></i>Ressources R</a>
<ul>
<li class="chapter" data-level="" data-path="ressources.html"><a href="ressources.html#documentation-générale-r"><i class="fa fa-check"></i>Documentation générale R</a></li>
<li class="chapter" data-level="" data-path="ressources.html"><a href="ressources.html#documentation-r-géospatial"><i class="fa fa-check"></i>Documentation R-géospatial</a></li>
<li class="chapter" data-level="" data-path="ressources.html"><a href="ressources.html#les-bibliothèques-r"><i class="fa fa-check"></i>Les bibliothèques R</a></li>
<li class="chapter" data-level="" data-path="ressources.html"><a href="ressources.html#res_RMarkdown"><i class="fa fa-check"></i>Documentation R-Markdown</a></li>
<li class="chapter" data-level="" data-path="ressources.html"><a href="ressources.html#les-couleurs-dans-r"><i class="fa fa-check"></i>Les couleurs dans R</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="ressources.html"><a href="ressources.html#références"><i class="fa fa-check"></i>Références</a></li>
</ul></li>
<li class="part"><span><b>II Apprentissage</b></span></li>
<li class="chapter" data-level="1" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="lecon_intro.html"><a href="lecon_intro.html"><i class="fa fa-check"></i><b>1.1</b> Leçon</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="lecon_intro.html"><a href="lecon_intro.html#hist"><i class="fa fa-check"></i><b>1.1.1</b> Les données spatiales d’hier à aujourd’hui</a>
<ul>
<li class="chapter" data-level="" data-path="lecon_intro.html"><a href="lecon_intro.html#les-cartes-anciennes"><i class="fa fa-check"></i>Les cartes anciennes</a></li>
<li class="chapter" data-level="" data-path="lecon_intro.html"><a href="lecon_intro.html#la-géomatique"><i class="fa fa-check"></i>La géomatique</a></li>
<li class="chapter" data-level="" data-path="lecon_intro.html"><a href="lecon_intro.html#la-science-des-données"><i class="fa fa-check"></i>La science des données</a></li>
</ul></li>
<li class="chapter" data-level="1.1.2" data-path="lecon_intro.html"><a href="lecon_intro.html#outils"><i class="fa fa-check"></i><b>1.1.2</b> Les outils et logiciels de visualisation et d’analyse géo-spatiale</a>
<ul>
<li class="chapter" data-level="" data-path="lecon_intro.html"><a href="lecon_intro.html#les-logiciels-commerciaux"><i class="fa fa-check"></i>Les logiciels commerciaux</a></li>
<li class="chapter" data-level="" data-path="lecon_intro.html"><a href="lecon_intro.html#les-logiciels-libres-daccès"><i class="fa fa-check"></i>Les logiciels libres d’accès</a></li>
<li class="chapter" data-level="" data-path="lecon_intro.html"><a href="lecon_intro.html#les-services-dinfonuagique"><i class="fa fa-check"></i>Les services d’infonuagique</a></li>
<li class="chapter" data-level="" data-path="lecon_intro.html"><a href="lecon_intro.html#les-langages-de-programmation-pour-lanalyse-géospatiale"><i class="fa fa-check"></i>Les langages de programmation pour l’analyse géospatiale</a></li>
</ul></li>
<li class="chapter" data-level="1.1.3" data-path="lecon_intro.html"><a href="lecon_intro.html#outil_R"><i class="fa fa-check"></i><b>1.1.3</b> Les bibliothèques géo-spatiales de R</a></li>
<li class="chapter" data-level="1.1.4" data-path="lecon_intro.html"><a href="lecon_intro.html#pensee_geo"><i class="fa fa-check"></i><b>1.1.4</b> La pensée géographique</a>
<ul>
<li class="chapter" data-level="" data-path="lecon_intro.html"><a href="lecon_intro.html#échelle-spatiale"><i class="fa fa-check"></i>Échelle spatiale</a></li>
<li class="chapter" data-level="" data-path="lecon_intro.html"><a href="lecon_intro.html#échelle-cartographique"><i class="fa fa-check"></i>Échelle cartographique</a></li>
<li class="chapter" data-level="" data-path="lecon_intro.html"><a href="lecon_intro.html#distance"><i class="fa fa-check"></i>Distance</a></li>
<li class="chapter" data-level="" data-path="lecon_intro.html"><a href="lecon_intro.html#contiguïté"><i class="fa fa-check"></i>Contiguïté</a></li>
<li class="chapter" data-level="" data-path="lecon_intro.html"><a href="lecon_intro.html#interaction"><i class="fa fa-check"></i>Interaction</a></li>
<li class="chapter" data-level="" data-path="lecon_intro.html"><a href="lecon_intro.html#voisinage"><i class="fa fa-check"></i>Voisinage</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="ex_intro.html"><a href="ex_intro.html"><i class="fa fa-check"></i><b>1.2</b> Exercices</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="ex_intro.html"><a href="ex_intro.html#demarrage"><i class="fa fa-check"></i><b>1.2.1</b> Démarrage</a>
<ul>
<li class="chapter" data-level="" data-path="ex_intro.html"><a href="ex_intro.html#installer-r"><i class="fa fa-check"></i>Installer R</a></li>
<li class="chapter" data-level="" data-path="ex_intro.html"><a href="ex_intro.html#installer-rstudio"><i class="fa fa-check"></i>Installer RStudio</a></li>
<li class="chapter" data-level="" data-path="ex_intro.html"><a href="ex_intro.html#apprivoiser-rstudio"><i class="fa fa-check"></i>Apprivoiser RStudio</a></li>
<li class="chapter" data-level="" data-path="ex_intro.html"><a href="ex_intro.html#créer-un-fichier-r"><i class="fa fa-check"></i>Créer un fichier R</a></li>
<li class="chapter" data-level="" data-path="ex_intro.html"><a href="ex_intro.html#les-bibliothèques"><i class="fa fa-check"></i>Les bibliothèques</a></li>
<li class="chapter" data-level="" data-path="ex_intro.html"><a href="ex_intro.html#le-répertoire-de-travail"><i class="fa fa-check"></i>Le répertoire de travail</a></li>
</ul></li>
<li class="chapter" data-level="1.2.2" data-path="ex_intro.html"><a href="ex_intro.html#introR"><i class="fa fa-check"></i><b>1.2.2</b> Intro à R</a>
<ul>
<li class="chapter" data-level="" data-path="ex_intro.html"><a href="ex_intro.html#la-base"><i class="fa fa-check"></i>La base</a></li>
<li class="chapter" data-level="" data-path="ex_intro.html"><a href="ex_intro.html#les-objets"><i class="fa fa-check"></i>Les objets</a></li>
<li class="chapter" data-level="" data-path="ex_intro.html"><a href="ex_intro.html#les-catégories-de-données"><i class="fa fa-check"></i>Les catégories de données</a></li>
<li class="chapter" data-level="" data-path="ex_intro.html"><a href="ex_intro.html#les-structures-de-données"><i class="fa fa-check"></i>Les structures de données</a></li>
<li class="chapter" data-level="" data-path="ex_intro.html"><a href="ex_intro.html#importer-et-exporter-des-données"><i class="fa fa-check"></i>Importer et exporter des données</a></li>
<li class="chapter" data-level="" data-path="ex_intro.html"><a href="ex_intro.html#graphiques-de-base"><i class="fa fa-check"></i>Graphiques de base</a></li>
</ul></li>
<li class="chapter" data-level="1.2.3" data-path="ex_intro.html"><a href="ex_intro.html#exo1"><i class="fa fa-check"></i><b>1.2.3</b> À vous de jouer!</a>
<ul>
<li class="chapter" data-level="" data-path="ex_intro.html"><a href="ex_intro.html#question-1"><i class="fa fa-check"></i>Question 1</a></li>
<li class="chapter" data-level="" data-path="ex_intro.html"><a href="ex_intro.html#question-2"><i class="fa fa-check"></i>Question 2</a></li>
<li class="chapter" data-level="" data-path="ex_intro.html"><a href="ex_intro.html#question-3"><i class="fa fa-check"></i>Question 3</a></li>
</ul></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="base.html"><a href="base.html"><i class="fa fa-check"></i><b>2</b> Modèles de données spatiales</a>
<ul>
<li class="chapter" data-level="2.1" data-path="leçon.html"><a href="leçon.html"><i class="fa fa-check"></i><b>2.1</b> Leçon</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="leçon.html"><a href="leçon.html#les-données-vectorielles"><i class="fa fa-check"></i><b>2.1.1</b> Les données vectorielles</a></li>
<li class="chapter" data-level="2.1.2" data-path="leçon.html"><a href="leçon.html#les-données-matricielles"><i class="fa fa-check"></i><b>2.1.2</b> Les données matricielles</a></li>
<li class="chapter" data-level="2.1.3" data-path="leçon.html"><a href="leçon.html#structure-en-couches"><i class="fa fa-check"></i><b>2.1.3</b> Structure en couches</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="ex_markdown1.html"><a href="ex_markdown1.html"><i class="fa fa-check"></i><b>2.2</b> Exercices</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="ex_markdown1.html"><a href="ex_markdown1.html#introduction-à-r-markdown"><i class="fa fa-check"></i><b>2.2.1</b> Introduction à R Markdown</a>
<ul>
<li class="chapter" data-level="" data-path="ex_markdown1.html"><a href="ex_markdown1.html#bénéfices-de-r-markdown"><i class="fa fa-check"></i>Bénéfices de R Markdown</a></li>
<li class="chapter" data-level="" data-path="ex_markdown1.html"><a href="ex_markdown1.html#quest-ce-que-markdown"><i class="fa fa-check"></i>Qu’est-ce que Markdown?</a></li>
<li class="chapter" data-level="" data-path="ex_markdown1.html"><a href="ex_markdown1.html#quest-ce-que-pandoc"><i class="fa fa-check"></i>Qu’est-ce que Pandoc?</a></li>
</ul></li>
<li class="chapter" data-level="2.2.2" data-path="ex_markdown1.html"><a href="ex_markdown1.html#utiliser-un-fichier-rmarkdown"><i class="fa fa-check"></i><b>2.2.2</b> Utiliser un fichier RMarkdown</a>
<ul>
<li class="chapter" data-level="" data-path="ex_markdown1.html"><a href="ex_markdown1.html#organisation-générale"><i class="fa fa-check"></i>Organisation générale</a></li>
<li class="chapter" data-level="" data-path="ex_markdown1.html"><a href="ex_markdown1.html#installer-r-markdown"><i class="fa fa-check"></i>Installer R Markdown</a></li>
<li class="chapter" data-level="" data-path="ex_markdown1.html"><a href="ex_markdown1.html#createmarkdownfile"><i class="fa fa-check"></i>Créer un fichier R Markdown</a></li>
<li class="chapter" data-level="" data-path="ex_markdown1.html"><a href="ex_markdown1.html#spécifier-les-options-yaml"><i class="fa fa-check"></i>Spécifier les options YAML</a></li>
<li class="chapter" data-level="" data-path="ex_markdown1.html"><a href="ex_markdown1.html#éditer-le-contenu-du-fichier-r-markdown"><i class="fa fa-check"></i>Éditer le contenu du fichier R Markdown</a></li>
<li class="chapter" data-level="" data-path="ex_markdown1.html"><a href="ex_markdown1.html#obtenir-le-document-final"><i class="fa fa-check"></i>Obtenir le document final</a></li>
</ul></li>
<li class="chapter" data-level="2.2.3" data-path="ex_markdown1.html"><a href="ex_markdown1.html#exo2"><i class="fa fa-check"></i><b>2.2.3</b> À vous de jouer !</a>
<ul>
<li class="chapter" data-level="" data-path="ex_markdown1.html"><a href="ex_markdown1.html#question-1-1"><i class="fa fa-check"></i>Question 1</a></li>
<li class="chapter" data-level="" data-path="ex_markdown1.html"><a href="ex_markdown1.html#question-2-1"><i class="fa fa-check"></i>Question 2</a></li>
</ul></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="SRC.html"><a href="SRC.html"><i class="fa fa-check"></i><b>3</b> Systèmes de coordonnées de référence</a>
<ul>
<li class="chapter" data-level="3.1" data-path="leçon-1.html"><a href="leçon-1.html"><i class="fa fa-check"></i><b>3.1</b> Leçon</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="leçon-1.html"><a href="leçon-1.html#les-systèmes-géodésiques"><i class="fa fa-check"></i><b>3.1.1</b> Les systèmes géodésiques</a></li>
<li class="chapter" data-level="3.1.2" data-path="leçon-1.html"><a href="leçon-1.html#les-systèmes-de-coordonnées"><i class="fa fa-check"></i><b>3.1.2</b> Les systèmes de coordonnées</a></li>
<li class="chapter" data-level="3.1.3" data-path="leçon-1.html"><a href="leçon-1.html#les-projections"><i class="fa fa-check"></i><b>3.1.3</b> Les projections</a></li>
<li class="chapter" data-level="3.1.4" data-path="leçon-1.html"><a href="leçon-1.html#projections-couramment-utilisées"><i class="fa fa-check"></i><b>3.1.4</b> Projections couramment utilisées</a></li>
<li class="chapter" data-level="3.1.5" data-path="leçon-1.html"><a href="leçon-1.html#représentation-dun-scr"><i class="fa fa-check"></i><b>3.1.5</b> Représentation d’un SCR</a>
<ul>
<li class="chapter" data-level="" data-path="leçon-1.html"><a href="leçon-1.html#le-well-known-text"><i class="fa fa-check"></i>Le Well-known text</a></li>
<li class="chapter" data-level="" data-path="leçon-1.html"><a href="leçon-1.html#la-syntaxe-proj4"><i class="fa fa-check"></i>La syntaxe PROJ4</a></li>
<li class="chapter" data-level="" data-path="leçon-1.html"><a href="leçon-1.html#code_epsg"><i class="fa fa-check"></i>Les codes EPSG</a></li>
</ul></li>
<li class="chapter" data-level="3.1.6" data-path="leçon-1.html"><a href="leçon-1.html#résumé"><i class="fa fa-check"></i><b>3.1.6</b> Résumé</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="ex_markdown2.html"><a href="ex_markdown2.html"><i class="fa fa-check"></i><b>3.2</b> Exercices</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="ex_markdown2.html"><a href="ex_markdown2.html#pandocmarkdown"><i class="fa fa-check"></i><b>3.2.1</b> Le variante Pandoc de Markdown</a>
<ul>
<li class="chapter" data-level="" data-path="ex_markdown2.html"><a href="ex_markdown2.html#informations-de-départ"><i class="fa fa-check"></i>Informations de départ</a></li>
<li class="chapter" data-level="" data-path="ex_markdown2.html"><a href="ex_markdown2.html#décoration-du-texte"><i class="fa fa-check"></i>Décoration du texte</a></li>
<li class="chapter" data-level="" data-path="ex_markdown2.html"><a href="ex_markdown2.html#les-titres"><i class="fa fa-check"></i>Les titres</a></li>
<li class="chapter" data-level="" data-path="ex_markdown2.html"><a href="ex_markdown2.html#les-listes-1"><i class="fa fa-check"></i>Les listes</a></li>
<li class="chapter" data-level="" data-path="ex_markdown2.html"><a href="ex_markdown2.html#blocs-de-citation"><i class="fa fa-check"></i>Blocs de citation</a></li>
<li class="chapter" data-level="" data-path="ex_markdown2.html"><a href="ex_markdown2.html#les-symboles-matématiques"><i class="fa fa-check"></i>Les symboles matématiques</a></li>
<li class="chapter" data-level="" data-path="ex_markdown2.html"><a href="ex_markdown2.html#exo3_images"><i class="fa fa-check"></i>Les images</a></li>
<li class="chapter" data-level="" data-path="ex_markdown2.html"><a href="ex_markdown2.html#les-tableaux"><i class="fa fa-check"></i>Les tableaux</a></li>
<li class="chapter" data-level="" data-path="ex_markdown2.html"><a href="ex_markdown2.html#les-références"><i class="fa fa-check"></i>Les références</a></li>
</ul></li>
<li class="chapter" data-level="3.2.2" data-path="ex_markdown2.html"><a href="ex_markdown2.html#blocsR"><i class="fa fa-check"></i><b>3.2.2</b> Intégration de R dans le document</a>
<ul>
<li class="chapter" data-level="" data-path="ex_markdown2.html"><a href="ex_markdown2.html#les-commentaires-1"><i class="fa fa-check"></i>Les commentaires</a></li>
<li class="chapter" data-level="" data-path="ex_markdown2.html"><a href="ex_markdown2.html#affichage-du-code-source"><i class="fa fa-check"></i>Affichage du code source</a></li>
<li class="chapter" data-level="" data-path="ex_markdown2.html"><a href="ex_markdown2.html#affichage-des-sorties"><i class="fa fa-check"></i>Affichage des sorties</a></li>
<li class="chapter" data-level="" data-path="ex_markdown2.html"><a href="ex_markdown2.html#mode-dévaluation-du-code"><i class="fa fa-check"></i>Mode d’évaluation du code</a></li>
<li class="chapter" data-level="" data-path="ex_markdown2.html"><a href="ex_markdown2.html#les-tableaux-1"><i class="fa fa-check"></i>Les tableaux</a></li>
<li class="chapter" data-level="" data-path="ex_markdown2.html"><a href="ex_markdown2.html#les-figures"><i class="fa fa-check"></i>Les figures</a></li>
<li class="chapter" data-level="" data-path="ex_markdown2.html"><a href="ex_markdown2.html#les-graphiques-non-générés-par-r"><i class="fa fa-check"></i>Les graphiques non-générés par R</a></li>
</ul></li>
<li class="chapter" data-level="3.2.3" data-path="ex_markdown2.html"><a href="ex_markdown2.html#exo3"><i class="fa fa-check"></i><b>3.2.3</b> À vous de jouer !</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="vec.html"><a href="vec.html"><i class="fa fa-check"></i><b>4</b> Données vectorielles</a>
<ul>
<li class="chapter" data-level="4.1" data-path="lecon_vec.html"><a href="lecon_vec.html"><i class="fa fa-check"></i><b>4.1</b> Leçon</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="lecon_vec.html"><a href="lecon_vec.html#data_mod4"><i class="fa fa-check"></i><b>4.1.1</b> Télécharger les données</a></li>
<li class="chapter" data-level="4.1.2" data-path="lecon_vec.html"><a href="lecon_vec.html#create_vec"><i class="fa fa-check"></i><b>4.1.2</b> Créer des données vectorielles</a>
<ul>
<li class="chapter" data-level="" data-path="lecon_vec.html"><a href="lecon_vec.html#créer-des-géométries-simples"><i class="fa fa-check"></i>Créer des géométries simples</a></li>
<li class="chapter" data-level="" data-path="lecon_vec.html"><a href="lecon_vec.html#attribuer-un-scr"><i class="fa fa-check"></i>Attribuer un SCR</a></li>
<li class="chapter" data-level="" data-path="lecon_vec.html"><a href="lecon_vec.html#définir-des-attributs"><i class="fa fa-check"></i>Définir des attributs</a></li>
<li class="chapter" data-level="" data-path="lecon_vec.html"><a href="lecon_vec.html#fct_st_as_sf"><i class="fa fa-check"></i>La fonction <code>st_as_sf()</code></a></li>
</ul></li>
<li class="chapter" data-level="4.1.3" data-path="lecon_vec.html"><a href="lecon_vec.html#read_vec"><i class="fa fa-check"></i><b>4.1.3</b> Lire un shapefile et interpréter sa géométrie</a>
<ul>
<li class="chapter" data-level="" data-path="lecon_vec.html"><a href="lecon_vec.html#lire-shp"><i class="fa fa-check"></i>Lire les données</a></li>
<li class="chapter" data-level="" data-path="lecon_vec.html"><a href="lecon_vec.html#explorer-les-métadonnées-dun-shapefile"><i class="fa fa-check"></i>Explorer les métadonnées d’un shapefile</a></li>
</ul></li>
<li class="chapter" data-level="4.1.4" data-path="lecon_vec.html"><a href="lecon_vec.html#visualisation-de-shapefiles-sous-r"><i class="fa fa-check"></i><b>4.1.4</b> Visualisation de shapefiles sous R</a>
<ul>
<li class="chapter" data-level="" data-path="lecon_vec.html"><a href="lecon_vec.html#visualisation-avec-la-librairie-mapview"><i class="fa fa-check"></i>Visualisation avec la librairie Mapview</a></li>
<li class="chapter" data-level="" data-path="lecon_vec.html"><a href="lecon_vec.html#visualiser-des-données-vectorielles-par-attribut"><i class="fa fa-check"></i>Visualiser des données vectorielles par attribut</a></li>
<li class="chapter" data-level="" data-path="lecon_vec.html"><a href="lecon_vec.html#visualiser-plusieurs-shapefiles"><i class="fa fa-check"></i>Visualiser plusieurs shapefiles</a></li>
</ul></li>
<li class="chapter" data-level="4.1.5" data-path="lecon_vec.html"><a href="lecon_vec.html#reprojection-de-données-vectorielles-sous-r"><i class="fa fa-check"></i><b>4.1.5</b> Reprojection de données vectorielles sous R</a></li>
<li class="chapter" data-level="4.1.6" data-path="lecon_vec.html"><a href="lecon_vec.html#gdt"><i class="fa fa-check"></i><b>4.1.6</b> Lire une géodatabase et explorer ses couches</a>
<ul>
<li class="chapter" data-level="" data-path="lecon_vec.html"><a href="lecon_vec.html#lire-les-données"><i class="fa fa-check"></i>Lire les données</a></li>
<li class="chapter" data-level="" data-path="lecon_vec.html"><a href="lecon_vec.html#explorer-les-attributs-dune-couche"><i class="fa fa-check"></i>Explorer les attributs d’une couche</a></li>
<li class="chapter" data-level="" data-path="lecon_vec.html"><a href="lecon_vec.html#sélection-dun-sous-ensemble-de-données"><i class="fa fa-check"></i>Sélection d’un sous-ensemble de données</a></li>
<li class="chapter" data-level="" data-path="lecon_vec.html"><a href="lecon_vec.html#visualisation-de-plusieurs-couches-dune-géodatabse"><i class="fa fa-check"></i>Visualisation de plusieurs couches d’une géodatabse</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="ex_vec.html"><a href="ex_vec.html"><i class="fa fa-check"></i><b>4.2</b> Exercices</a>
<ul>
<li class="chapter" data-level="" data-path="ex_vec.html"><a href="ex_vec.html#question-1-2"><i class="fa fa-check"></i>Question 1</a></li>
<li class="chapter" data-level="" data-path="ex_vec.html"><a href="ex_vec.html#question-2-2"><i class="fa fa-check"></i>Question 2</a></li>
<li class="chapter" data-level="" data-path="ex_vec.html"><a href="ex_vec.html#question-3-1"><i class="fa fa-check"></i>Question 3</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="mat.html"><a href="mat.html"><i class="fa fa-check"></i><b>5</b> Données matricielles</a>
<ul>
<li class="chapter" data-level="5.1" data-path="lecon_mat.html"><a href="lecon_mat.html"><i class="fa fa-check"></i><b>5.1</b> Leçon</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="lecon_mat.html"><a href="lecon_mat.html#data_mod5"><i class="fa fa-check"></i><b>5.1.1</b> Télécharger les données</a></li>
<li class="chapter" data-level="5.1.2" data-path="lecon_mat.html"><a href="lecon_mat.html#create_mat"><i class="fa fa-check"></i><b>5.1.2</b> Créer des données matricielles</a>
<ul>
<li class="chapter" data-level="" data-path="lecon_mat.html"><a href="lecon_mat.html#créer-un-raster-simple-et-le-visualiser"><i class="fa fa-check"></i>Créer un raster simple et le visualiser</a></li>
<li class="chapter" data-level="" data-path="lecon_mat.html"><a href="lecon_mat.html#raster-de-différents-types-de-données"><i class="fa fa-check"></i>Raster de différents types de données</a></li>
</ul></li>
<li class="chapter" data-level="5.1.3" data-path="lecon_mat.html"><a href="lecon_mat.html#comprendre-la-structure-dun-raster"><i class="fa fa-check"></i><b>5.1.3</b> Comprendre la structure d’un raster</a></li>
<li class="chapter" data-level="5.1.4" data-path="lecon_mat.html"><a href="lecon_mat.html#statistiques-de-base-sur-un-raster"><i class="fa fa-check"></i><b>5.1.4</b> Statistiques de base sur un raster</a></li>
<li class="chapter" data-level="5.1.5" data-path="lecon_mat.html"><a href="lecon_mat.html#read_mat"><i class="fa fa-check"></i><b>5.1.5</b> Lire un raster et explorer son contenu</a>
<ul>
<li class="chapter" data-level="" data-path="lecon_mat.html"><a href="lecon_mat.html#lire-les-données-1"><i class="fa fa-check"></i>Lire les données</a></li>
<li class="chapter" data-level="" data-path="lecon_mat.html"><a href="lecon_mat.html#explorer-les-statistiques-de-base"><i class="fa fa-check"></i>Explorer les statistiques de base</a></li>
</ul></li>
<li class="chapter" data-level="5.1.6" data-path="lecon_mat.html"><a href="lecon_mat.html#visualiser-les-données-matricielles-avec-mapview"><i class="fa fa-check"></i><b>5.1.6</b> Visualiser les données matricielles avec mapview()</a>
<ul>
<li class="chapter" data-level="" data-path="lecon_mat.html"><a href="lecon_mat.html#visualiser-une-section-dun-raster"><i class="fa fa-check"></i>Visualiser une section d’un raster</a></li>
</ul></li>
<li class="chapter" data-level="5.1.7" data-path="lecon_mat.html"><a href="lecon_mat.html#changer-la-résolution-dun-raster"><i class="fa fa-check"></i><b>5.1.7</b> Changer la résolution d’un raster</a></li>
<li class="chapter" data-level="5.1.8" data-path="lecon_mat.html"><a href="lecon_mat.html#changer-la-projection-dun-raster"><i class="fa fa-check"></i><b>5.1.8</b> Changer la projection d’un <em>raster</em></a></li>
<li class="chapter" data-level="5.1.9" data-path="lecon_mat.html"><a href="lecon_mat.html#sauvegarder-un-raster"><i class="fa fa-check"></i><b>5.1.9</b> Sauvegarder un raster</a></li>
<li class="chapter" data-level="5.1.10" data-path="lecon_mat.html"><a href="lecon_mat.html#read_mult"><i class="fa fa-check"></i><b>5.1.10</b> Lire et visualiser des données matricielles multi-bande</a>
<ul>
<li class="chapter" data-level="" data-path="lecon_mat.html"><a href="lecon_mat.html#lire-des-données-multi-bande"><i class="fa fa-check"></i>Lire des données multi-bande</a></li>
<li class="chapter" data-level="" data-path="lecon_mat.html"><a href="lecon_mat.html#rasterbrick-et-rasterstack"><i class="fa fa-check"></i>RasterBrick et RasterStack</a></li>
<li class="chapter" data-level="" data-path="lecon_mat.html"><a href="lecon_mat.html#visualiser-un-raster-multi-bande"><i class="fa fa-check"></i>Visualiser un raster multi-bande</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="ex_mat.html"><a href="ex_mat.html"><i class="fa fa-check"></i><b>5.2</b> Exercices</a>
<ul>
<li class="chapter" data-level="" data-path="ex_mat.html"><a href="ex_mat.html#question-1-3"><i class="fa fa-check"></i>Question 1</a></li>
<li class="chapter" data-level="" data-path="ex_mat.html"><a href="ex_mat.html#question-2-3"><i class="fa fa-check"></i>Question 2</a></li>
<li class="chapter" data-level="" data-path="ex_mat.html"><a href="ex_mat.html#question-3-2"><i class="fa fa-check"></i>Question 3</a></li>
<li class="chapter" data-level="" data-path="ex_mat.html"><a href="ex_mat.html#question-4"><i class="fa fa-check"></i>Question 4</a></li>
<li class="chapter" data-level="" data-path="ex_mat.html"><a href="ex_mat.html#question-5"><i class="fa fa-check"></i>Question 5</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="carto.html"><a href="carto.html"><i class="fa fa-check"></i><b>6</b> Cartographie</a>
<ul>
<li class="chapter" data-level="6.1" data-path="lecon_carto.html"><a href="lecon_carto.html"><i class="fa fa-check"></i><b>6.1</b> Leçon</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="lecon_carto.html"><a href="lecon_carto.html#data_mod6"><i class="fa fa-check"></i><b>6.1.1</b> Télécharger les données</a></li>
<li class="chapter" data-level="6.1.2" data-path="lecon_carto.html"><a href="lecon_carto.html#éléments-de-base-en-cartographie"><i class="fa fa-check"></i><b>6.1.2</b> Éléments de base en cartographie</a>
<ul>
<li class="chapter" data-level="" data-path="lecon_carto.html"><a href="lecon_carto.html#principes-fondamentaux"><i class="fa fa-check"></i>Principes fondamentaux</a></li>
<li class="chapter" data-level="" data-path="lecon_carto.html"><a href="lecon_carto.html#informations-indispensables-et-optionnelles"><i class="fa fa-check"></i>Informations indispensables et optionnelles</a></li>
<li class="chapter" data-level="" data-path="lecon_carto.html"><a href="lecon_carto.html#le-texte"><i class="fa fa-check"></i>Le texte</a></li>
<li class="chapter" data-level="" data-path="lecon_carto.html"><a href="lecon_carto.html#les-types-de-carte"><i class="fa fa-check"></i>Les types de carte</a></li>
<li class="chapter" data-level="" data-path="lecon_carto.html"><a href="lecon_carto.html#la-symbologie"><i class="fa fa-check"></i>La symbologie</a></li>
<li class="chapter" data-level="" data-path="lecon_carto.html"><a href="lecon_carto.html#les-couleurs"><i class="fa fa-check"></i>Les couleurs</a></li>
<li class="chapter" data-level="" data-path="lecon_carto.html"><a href="lecon_carto.html#les-palettes-de-couleurs"><i class="fa fa-check"></i>Les palettes de couleurs</a></li>
</ul></li>
<li class="chapter" data-level="6.1.3" data-path="lecon_carto.html"><a href="lecon_carto.html#basetmap"><i class="fa fa-check"></i><b>6.1.3</b> Cartes statiques avec tmap</a></li>
<li class="chapter" data-level="6.1.4" data-path="lecon_carto.html"><a href="lecon_carto.html#les-polygones"><i class="fa fa-check"></i><b>6.1.4</b> Les polygones</a>
<ul>
<li class="chapter" data-level="" data-path="lecon_carto.html"><a href="lecon_carto.html#intérieur-des-polygones"><i class="fa fa-check"></i>Intérieur des polygones</a></li>
<li class="chapter" data-level="" data-path="lecon_carto.html"><a href="lecon_carto.html#objet-tmap"><i class="fa fa-check"></i>Objet tmap</a></li>
<li class="chapter" data-level="" data-path="lecon_carto.html"><a href="lecon_carto.html#frontières-des-polygones"><i class="fa fa-check"></i>Frontières des polygones</a></li>
<li class="chapter" data-level="" data-path="lecon_carto.html"><a href="lecon_carto.html#attributs-des-polygones"><i class="fa fa-check"></i>Attributs des polygones</a></li>
</ul></li>
<li class="chapter" data-level="6.1.5" data-path="lecon_carto.html"><a href="lecon_carto.html#spécificités-cartographiques"><i class="fa fa-check"></i><b>6.1.5</b> Spécificités cartographiques</a>
<ul>
<li class="chapter" data-level="" data-path="lecon_carto.html"><a href="lecon_carto.html#barre-déchelle-et-rose-des-vents"><i class="fa fa-check"></i>Barre d’échelle et rose des vents</a></li>
<li class="chapter" data-level="" data-path="lecon_carto.html"><a href="lecon_carto.html#grille-et-graticules"><i class="fa fa-check"></i>Grille et graticules</a></li>
<li class="chapter" data-level="" data-path="lecon_carto.html"><a href="lecon_carto.html#attribuer-les-crédits-ou-la-source-des-données"><i class="fa fa-check"></i>Attribuer les crédits ou la source des données</a></li>
</ul></li>
<li class="chapter" data-level="6.1.6" data-path="lecon_carto.html"><a href="lecon_carto.html#mise-en-page"><i class="fa fa-check"></i><b>6.1.6</b> Mise en page</a>
<ul>
<li class="chapter" data-level="" data-path="lecon_carto.html"><a href="lecon_carto.html#titre-cadre-et-couleur-du-fond"><i class="fa fa-check"></i>Titre, cadre et couleur du fond</a></li>
<li class="chapter" data-level="" data-path="lecon_carto.html"><a href="lecon_carto.html#légende"><i class="fa fa-check"></i>Légende</a></li>
<li class="chapter" data-level="" data-path="lecon_carto.html"><a href="lecon_carto.html#ajustement-des-couleurs"><i class="fa fa-check"></i>Ajustement des couleurs</a></li>
<li class="chapter" data-level="" data-path="lecon_carto.html"><a href="lecon_carto.html#styles-prédéfinis"><i class="fa fa-check"></i>Styles prédéfinis</a></li>
</ul></li>
<li class="chapter" data-level="6.1.7" data-path="lecon_carto.html"><a href="lecon_carto.html#écriture-sur-une-carte"><i class="fa fa-check"></i><b>6.1.7</b> Écriture sur une carte</a></li>
<li class="chapter" data-level="6.1.8" data-path="lecon_carto.html"><a href="lecon_carto.html#les-lignes"><i class="fa fa-check"></i><b>6.1.8</b> Les lignes</a></li>
<li class="chapter" data-level="6.1.9" data-path="lecon_carto.html"><a href="lecon_carto.html#les-points"><i class="fa fa-check"></i><b>6.1.9</b> Les points</a></li>
<li class="chapter" data-level="6.1.10" data-path="lecon_carto.html"><a href="lecon_carto.html#données-matricielles"><i class="fa fa-check"></i><b>6.1.10</b> Données matricielles</a></li>
<li class="chapter" data-level="6.1.11" data-path="lecon_carto.html"><a href="lecon_carto.html#carte-avec-symboles-proportionnels"><i class="fa fa-check"></i><b>6.1.11</b> Carte avec symboles proportionnels</a></li>
<li class="chapter" data-level="6.1.12" data-path="lecon_carto.html"><a href="lecon_carto.html#cartes-choroplèthes"><i class="fa fa-check"></i><b>6.1.12</b> Cartes Choroplèthes</a></li>
<li class="chapter" data-level="6.1.13" data-path="lecon_carto.html"><a href="lecon_carto.html#cartes-à-panneaux-multiples"><i class="fa fa-check"></i><b>6.1.13</b> Cartes à panneaux multiples</a></li>
<li class="chapter" data-level="6.1.14" data-path="lecon_carto.html"><a href="lecon_carto.html#cartes-avec-encadré"><i class="fa fa-check"></i><b>6.1.14</b> Cartes avec encadré</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="ex_carto.html"><a href="ex_carto.html"><i class="fa fa-check"></i><b>6.2</b> Exercices</a>
<ul>
<li class="chapter" data-level="" data-path="ex_carto.html"><a href="ex_carto.html#question-1-4"><i class="fa fa-check"></i>Question 1</a></li>
<li class="chapter" data-level="" data-path="ex_carto.html"><a href="ex_carto.html#question-2-4"><i class="fa fa-check"></i>Question 2</a></li>
<li class="chapter" data-level="" data-path="ex_carto.html"><a href="ex_carto.html#question-3-3"><i class="fa fa-check"></i>Question 3</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="manip_vec.html"><a href="manip_vec.html"><i class="fa fa-check"></i><b>7</b> Manipulation de données vectorielles</a>
<ul>
<li class="chapter" data-level="7.1" data-path="lecon_manip_vec.html"><a href="lecon_manip_vec.html"><i class="fa fa-check"></i><b>7.1</b> Leçon</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="lecon_manip_vec.html"><a href="lecon_manip_vec.html#data_mod7"><i class="fa fa-check"></i><b>7.1.1</b> Télécharger les données</a></li>
<li class="chapter" data-level="7.1.2" data-path="lecon_manip_vec.html"><a href="lecon_manip_vec.html#opérations-de-base"><i class="fa fa-check"></i><b>7.1.2</b> Opérations de base</a>
<ul>
<li class="chapter" data-level="7.1.2.1" data-path="lecon_manip_vec.html"><a href="lecon_manip_vec.html#importer-et-visualiser-les-données"><i class="fa fa-check"></i><b>7.1.2.1</b> Importer et visualiser les données</a></li>
<li class="chapter" data-level="7.1.2.2" data-path="lecon_manip_vec.html"><a href="lecon_manip_vec.html#opérations-sur-les-attributs-des-données-vectorielles"><i class="fa fa-check"></i><b>7.1.2.2</b> Opérations sur les attributs des données vectorielles</a></li>
<li class="chapter" data-level="7.1.2.3" data-path="lecon_manip_vec.html"><a href="lecon_manip_vec.html#opérations-spatiales-sur-les-données-vectorielles"><i class="fa fa-check"></i><b>7.1.2.3</b> Opérations spatiales sur les données vectorielles</a></li>
</ul></li>
<li class="chapter" data-level="7.1.3" data-path="lecon_manip_vec.html"><a href="lecon_manip_vec.html#prob_mod7"><i class="fa fa-check"></i><b>7.1.3</b> Problématique à résoudre</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="ex_map_vec.html"><a href="ex_map_vec.html"><i class="fa fa-check"></i><b>7.2</b> Exercices</a>
<ul>
<li class="chapter" data-level="" data-path="ex_map_vec.html"><a href="ex_map_vec.html#question-1-5"><i class="fa fa-check"></i>Question 1</a></li>
<li class="chapter" data-level="" data-path="ex_map_vec.html"><a href="ex_map_vec.html#question-2-5"><i class="fa fa-check"></i>Question 2</a></li>
<li class="chapter" data-level="" data-path="ex_map_vec.html"><a href="ex_map_vec.html#question-3-4"><i class="fa fa-check"></i>Question 3</a></li>
<li class="chapter" data-level="" data-path="ex_map_vec.html"><a href="ex_map_vec.html#question-4-1"><i class="fa fa-check"></i>Question 4</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="manip_mat.html"><a href="manip_mat.html"><i class="fa fa-check"></i><b>8</b> Manipulation de données matricielles</a>
<ul>
<li class="chapter" data-level="8.1" data-path="lecon_mat_mani.html"><a href="lecon_mat_mani.html"><i class="fa fa-check"></i><b>8.1</b> Leçon</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="lecon_mat_mani.html"><a href="lecon_mat_mani.html#data_mod8"><i class="fa fa-check"></i><b>8.1.1</b> Télécharger les données</a></li>
<li class="chapter" data-level="8.1.2" data-path="lecon_mat_mani.html"><a href="lecon_mat_mani.html#opération-de-bases"><i class="fa fa-check"></i><b>8.1.2</b> Opération de bases</a>
<ul>
<li class="chapter" data-level="8.1.2.1" data-path="lecon_mat_mani.html"><a href="lecon_mat_mani.html#importer-et-visualiser-les-données-1"><i class="fa fa-check"></i><b>8.1.2.1</b> Importer et visualiser les données</a></li>
<li class="chapter" data-level="8.1.2.2" data-path="lecon_mat_mani.html"><a href="lecon_mat_mani.html#filtrer-les-cellules-dun-raster"><i class="fa fa-check"></i><b>8.1.2.2</b> Filtrer les cellules d’un <em>raster</em></a></li>
<li class="chapter" data-level="8.1.2.3" data-path="lecon_mat_mani.html"><a href="lecon_mat_mani.html#combiner-des-rasters"><i class="fa fa-check"></i><b>8.1.2.3</b> Combiner des <em>rasters</em></a></li>
</ul></li>
<li class="chapter" data-level="8.1.3" data-path="lecon_mat_mani.html"><a href="lecon_mat_mani.html#prob_mod8"><i class="fa fa-check"></i><b>8.1.3</b> Problématique à résoudre</a>
<ul>
<li class="chapter" data-level="" data-path="lecon_mat_mani.html"><a href="lecon_mat_mani.html#résolution-de-la-question-1"><i class="fa fa-check"></i>Résolution de la question 1</a></li>
<li class="chapter" data-level="" data-path="lecon_mat_mani.html"><a href="lecon_mat_mani.html#résolution-de-la-question-2"><i class="fa fa-check"></i>Résolution de la question 2</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="ex_mat_manip.html"><a href="ex_mat_manip.html"><i class="fa fa-check"></i><b>8.2</b> Exercices</a>
<ul>
<li class="chapter" data-level="" data-path="ex_mat_manip.html"><a href="ex_mat_manip.html#question-1-6"><i class="fa fa-check"></i>Question 1</a></li>
<li class="chapter" data-level="" data-path="ex_mat_manip.html"><a href="ex_mat_manip.html#question-2-6"><i class="fa fa-check"></i>Question 2</a></li>
<li class="chapter" data-level="" data-path="ex_mat_manip.html"><a href="ex_mat_manip.html#question-3-5"><i class="fa fa-check"></i>Question 3</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="spatiotemp.html"><a href="spatiotemp.html"><i class="fa fa-check"></i><b>9</b> Données spatiotemporelles</a>
<ul>
<li class="chapter" data-level="9.1" data-path="lecon_spatiotemp.html"><a href="lecon_spatiotemp.html"><i class="fa fa-check"></i><b>9.1</b> Leçon</a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="lecon_spatiotemp.html"><a href="lecon_spatiotemp.html#data_mod9"><i class="fa fa-check"></i><b>9.1.1</b> Télécharger les données</a></li>
<li class="chapter" data-level="9.1.2" data-path="lecon_spatiotemp.html"><a href="lecon_spatiotemp.html#données-spatiotemporelles-vectorielles"><i class="fa fa-check"></i><b>9.1.2</b> Données spatiotemporelles vectorielles</a>
<ul>
<li class="chapter" data-level="9.1.2.1" data-path="lecon_spatiotemp.html"><a href="lecon_spatiotemp.html#importer-les-données-1"><i class="fa fa-check"></i><b>9.1.2.1</b> Importer les données</a></li>
<li class="chapter" data-level="9.1.2.2" data-path="lecon_spatiotemp.html"><a href="lecon_spatiotemp.html#vitesse-moyenne-des-trajets"><i class="fa fa-check"></i><b>9.1.2.2</b> Vitesse moyenne des trajets</a></li>
<li class="chapter" data-level="9.1.2.3" data-path="lecon_spatiotemp.html"><a href="lecon_spatiotemp.html#période-de-lannée-préférée"><i class="fa fa-check"></i><b>9.1.2.3</b> Période de l’année préférée</a></li>
<li class="chapter" data-level="9.1.2.4" data-path="lecon_spatiotemp.html"><a href="lecon_spatiotemp.html#animation-du-trajet-le-plus-long"><i class="fa fa-check"></i><b>9.1.2.4</b> Animation du trajet le plus long</a></li>
</ul></li>
<li class="chapter" data-level="9.1.3" data-path="lecon_spatiotemp.html"><a href="lecon_spatiotemp.html#données-spatiotemporelles-matricielles"><i class="fa fa-check"></i><b>9.1.3</b> Données spatiotemporelles matricielles</a>
<ul>
<li class="chapter" data-level="9.1.3.1" data-path="lecon_spatiotemp.html"><a href="lecon_spatiotemp.html#importer-les-données-2"><i class="fa fa-check"></i><b>9.1.3.1</b> Importer les données</a></li>
<li class="chapter" data-level="9.1.3.2" data-path="lecon_spatiotemp.html"><a href="lecon_spatiotemp.html#les-objets-rasterstack"><i class="fa fa-check"></i><b>9.1.3.2</b> Les objets rasterStack</a></li>
<li class="chapter" data-level="9.1.3.3" data-path="lecon_spatiotemp.html"><a href="lecon_spatiotemp.html#mois-de-plus-faible-pluviométrie"><i class="fa fa-check"></i><b>9.1.3.3</b> Mois de plus faible pluviométrie</a></li>
<li class="chapter" data-level="9.1.3.4" data-path="lecon_spatiotemp.html"><a href="lecon_spatiotemp.html#points-les-plus-chauds"><i class="fa fa-check"></i><b>9.1.3.4</b> Points les plus chauds</a></li>
<li class="chapter" data-level="9.1.3.5" data-path="lecon_spatiotemp.html"><a href="lecon_spatiotemp.html#profils-de-temperatures-et-de-precipitations"><i class="fa fa-check"></i><b>9.1.3.5</b> Profils de temperatures et de precipitations</a></li>
<li class="chapter" data-level="9.1.3.6" data-path="lecon_spatiotemp.html"><a href="lecon_spatiotemp.html#animations"><i class="fa fa-check"></i><b>9.1.3.6</b> Animations</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="ex_spatiotemp.html"><a href="ex_spatiotemp.html"><i class="fa fa-check"></i><b>9.2</b> Exercice</a>
<ul>
<li class="chapter" data-level="" data-path="ex_spatiotemp.html"><a href="ex_spatiotemp.html#question-1-7"><i class="fa fa-check"></i>Question 1</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">SCI 1031 Visualisation et analyse de données spatiales sous R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="lecon_spatiotemp" class="section level2 hasAnchor" number="9.1">
<h2><span class="header-section-number">9.1</span> Leçon<a href="lecon_spatiotemp.html#lecon_spatiotemp" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Cette leçon est divisée en deux parties. Dans la première partie, vous apprendrez à manipuler des données spatiotemporelles de type vectoriel, et dans la seconde partie, des données spatiotemporelles de type matriciel.</p>
<p>Chacune des parties est structurée autour d’une problématique à résoudre. Dans la première partie, vous analyser un jeu de données de 400 trajets de cyclistes à Montréal. Cette analyse vous amènera à manipuler des objets
vectoriels à des échelles de temps fines (de l’ordre de quelques heures).</p>
<p>Dans la seconde partie, vous étudierez l’évolution des températures et des précipitations dans la région du Parc national du Mont-Mégantic de 2007 à 2016. Vous manipulerez alors des données climatiques mensuelles sous forme d’une série de <em>rasters</em>.</p>
<div id="data_mod9" class="section level3 hasAnchor" number="9.1.1">
<h3><span class="header-section-number">9.1.1</span> Télécharger les données<a href="lecon_spatiotemp.html#data_mod9" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="les-données-7" class="section level6 unnumbered hasAnchor boite ico donnees gauche">
<h6>Les données<a href="lecon_spatiotemp.html#les-données-7" class="anchor-section" aria-label="Anchor link to header"></a></h6>
<p><br></p>
</div>
<p>Les données vectorielles et matricielles utilisées dans ce module peuvent être téléchargées en cliquant sur un seul lien: <a href="https://github.com/sci1031/data/raw/main/Module9_donnees.zip">données pour le module 9</a>. Sauvegardez le dossier compressé (<code>zip</code>) dans votre répertoire de travail <code>Module9_donnees</code> pour ce module, et dézippez-le. Le dossier comprend quatre fichiers:</p>
<ul>
<li><code>maxt.nc</code></li>
<li><code>mint.nc</code></li>
<li><code>pcp.nc</code></li>
<li><code>trip400.geojson</code>.
<!-- Fonction R? Si oui remplacer quatre par cinq fichiers  --></li>
</ul>
</div>
<div id="données-spatiotemporelles-vectorielles" class="section level3 hasAnchor" number="9.1.2">
<h3><span class="header-section-number">9.1.2</span> Données spatiotemporelles vectorielles<a href="lecon_spatiotemp.html#données-spatiotemporelles-vectorielles" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Dans cette première partie, nous allons manipuler le temps et l’espace dans un ensemble de données vectorielles. Plus précisément, nous utiliserons un ensemble de données comptabilisant 400 trajets en vélo dans la ville de Montréal, et répondrons aux questions suivantes :</p>
<blockquote>
<p><strong>Quel trajet présente la vitesse moyenne la plus élevée?</strong></p>
</blockquote>
<blockquote>
<p><strong>Quelle est la période de l’année préférée des cyclistes du jeu de données?</strong></p>
</blockquote>
<p><br></p>
<p>Nous finirons cette partie avec un exercice de visualisation du trajet le plus long, que nous animerons.</p>
<div id="importer-les-données-1" class="section level4 hasAnchor" number="9.1.2.1">
<h4><span class="header-section-number">9.1.2.1</span> Importer les données<a href="lecon_spatiotemp.html#importer-les-données-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Le site de la ville de Montréal et le site <a href="https://www.donneesquebec.ca/">Données Québec</a>, mettent à disposition un jeu de données incluant près de <a href="https://www.donneesquebec.ca/recherche/dataset/vmtl-trajets-individuels-velo-enregistre-mon-resovelo#">5000 trajets individuels à vélo</a>. Ces trajets ont été obtenus avec l’application <a href="https://apps.apple.com/ca/app/mon-r%C3%A9sov%C3%A9lo/id664766113">“Mon RésoVélo”</a> qui enregistre les positions de cyclistes à intervalle régulier. Les données de trajets brutes ont ensuite été traitées avant d’être rendues disponibles en ligne sous licence <a href="https://creativecommons.org/licenses/by/4.0/deed.fr"><em>creative common</em> (CC-BY)</a>. Les trajets ont notamment été anonymisés - reportez-vous au lien précédent pour plus d’informations relatives au traitement de ces données.</p>
<p>Ce jeu de données de 500 trajets est contenu dans un fichier zippé d’extension
<a href="https://fr.wikipedia.org/wiki/GeoJSON">GeoJSON</a> <code>trip5000.json</code> que nous avons préalablement téléchargé.
Ces données étant un peu volumineuses (&gt;150MB), nous avons seulement
conservé les 400 premiers trajets. Aussi, nous avons enlevé la colonne <code>liste_segments_jsonb</code> qui permet d’identifier les pistes cyclables et les portions du réseau routier emprunter par les cyclistes. Nous avons fait ce pré-traitement en utilisant des manipulations vues dans
les modules précédents et que nous décrivons ci-dessous :</p>
<p><br></p>
<div class="sourceCode" id="cb1192"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1192-1"><a href="lecon_spatiotemp.html#cb1192-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb1192-2"><a href="lecon_spatiotemp.html#cb1192-2" aria-hidden="true" tabindex="-1"></a>tmp <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">&quot;trip5000.json&quot;</span>) </span>
<span id="cb1192-3"><a href="lecon_spatiotemp.html#cb1192-3" aria-hidden="true" tabindex="-1"></a><span class="fu">st_write</span>(tmp[<span class="dv">1</span><span class="sc">:</span><span class="dv">400</span>, <span class="fu">names</span>(tmp) <span class="sc">!=</span> <span class="st">&quot;liste_segments_jsonb&quot;</span>], <span class="st">&quot;trip400.geojson&quot;</span>) </span></code></pre></div>
<p><br></p>
<p>Nous pouvons maintenant utiliser la fonction <code>st_read()</code> de la bibliothèque <code>sf</code> pour lire le fichier simplifié <code>trip400.geojson</code> disponible dans le répertoire <code>Module9_donnees</code> :</p>
<div class="sourceCode" id="cb1193"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1193-1"><a href="lecon_spatiotemp.html#cb1193-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb1193-2"><a href="lecon_spatiotemp.html#cb1193-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1193-3"><a href="lecon_spatiotemp.html#cb1193-3" aria-hidden="true" tabindex="-1"></a>trajets <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">&quot;Module9/Module9_donnees/trip400.geojson&quot;</span>)</span></code></pre></div>
<pre class="codeout"><code>Reading layer `trip400&#39; from data source 
  `E:\ELF\Dropbox\Teluq\Enseignement\Cours\SCI1031\Developpement\Structure_test\sci1031\Module9\Module9_donnees\trip400.geojson&#39; 
  using driver `GeoJSON&#39;
Simple feature collection with 400 features and 7 fields
Geometry type: LINESTRING
Dimension:     XY
Bounding box:  xmin: -73.84 ymin: 45.43 xmax: -73.4 ymax: 45.7
Geodetic CRS:  WGS 84</code></pre>
<p><br></p>
<p>L’objet <code>trajets</code> est de classe <code>sf</code> et contient un ensemble de 400 lignes décrivant les trajets à vélo et pour lesquels nous avons les informations suivantes :</p>
<div class="sourceCode" id="cb1195"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1195-1"><a href="lecon_spatiotemp.html#cb1195-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(trajets)</span></code></pre></div>
<pre class="codeout"><code>[1] &quot;stop&quot;       &quot;id_origine&quot; &quot;start&quot;      &quot;length&quot;    
[5] &quot;purpose&quot;    &quot;n_coord&quot;    &quot;id&quot;         &quot;geometry&quot;  </code></pre>
<p><br></p>
<p>Afin de résoudre notre problématique, nous utiliserons les colonnes suivantes:</p>
<ul>
<li><code>start</code> : date et heure associées au début du trajet,</li>
<li><code>stop</code> : date et heure associées à la fin du trajet,</li>
<li><code>length</code>: longueur du trajet en mètres.</li>
</ul>
<p><br></p>
</div>
<div id="vitesse-moyenne-des-trajets" class="section level4 hasAnchor" number="9.1.2.2">
<h4><span class="header-section-number">9.1.2.2</span> Vitesse moyenne des trajets<a href="lecon_spatiotemp.html#vitesse-moyenne-des-trajets" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Commençons par résoudre la première question:</p>
<blockquote>
<p><strong>Quel trajet présente la vitesse moyenne la plus élevée?</strong></p>
</blockquote>
<p>Nous avons importé 400 trajets à vélo et nous cherchons celui qui présente la vitesse moyenne la plus élevée. Pour calculer une vitesse pour un trajet en particulier, nous devons diviser sa longueur par le temps de parcours. Nous avons donc besoin de trouver d’abord la distance des trajets. Dans la table des attributs de <code>trajets</code>, il y a une colonne <code>length</code> qui nous donne cette distance.</p>
<p>Par exemple, nous pouvons obtenir la longueur des 10 premiers trajets :</p>
<div class="sourceCode" id="cb1197"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1197-1"><a href="lecon_spatiotemp.html#cb1197-1" aria-hidden="true" tabindex="-1"></a>trajets<span class="sc">$</span>length[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>] </span></code></pre></div>
<pre class="codeout"><code> [1]  3163  1066  5619  3115  5376  1153 11845  8033
 [9] 21146  8315</code></pre>
<p><br></p>
<p>Notons qu’en l’absence de cette colonne <code>length</code>, nous pourrions estimer ces distances en utilisant la fonction <a href="lecon_manip_vec.html#fct_length"><code>st_length()</code></a> vue au module 7 et qui calcule la longueur de chaque ligne de <code>trajets</code>.</p>
<div class="sourceCode" id="cb1199"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1199-1"><a href="lecon_spatiotemp.html#cb1199-1" aria-hidden="true" tabindex="-1"></a>len <span class="ot">&lt;-</span> <span class="fu">st_length</span>(trajets)</span>
<span id="cb1199-2"><a href="lecon_spatiotemp.html#cb1199-2" aria-hidden="true" tabindex="-1"></a>len[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>]</span></code></pre></div>
<pre class="codeout"><code>Units: [m]
 [1]  3157  1065  5614  3110  5367  1152 11828  8021
 [9] 21126  8303</code></pre>
<p><br></p>
<p>Comment nous assurer que les distances répertoriées dans la colonne <code>length</code> sont identiques à celles calculées avec la fonction <code>st_length()</code>? Un moyen simple de le vérifier est de visualiser une distance en fonction de l’autre.</p>
<div class="sourceCode" id="cb1201"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1201-1"><a href="lecon_spatiotemp.html#cb1201-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tracer une distance en x, et l&#39;autre en y</span></span>
<span id="cb1201-2"><a href="lecon_spatiotemp.html#cb1201-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(trajets<span class="sc">$</span>length, <span class="fu">st_length</span>(trajets), </span>
<span id="cb1201-3"><a href="lecon_spatiotemp.html#cb1201-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">xlab =</span> <span class="st">&quot;distance - colonne &#39;length&#39; (m)&quot;</span>, <span class="co"># </span></span>
<span id="cb1201-4"><a href="lecon_spatiotemp.html#cb1201-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">ylab =</span> <span class="st">&quot;distance - fonction &#39;st_length()&#39; (m)&quot;</span>, </span>
<span id="cb1201-5"><a href="lecon_spatiotemp.html#cb1201-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">pch =</span> <span class="dv">19</span>) <span class="co"># la forme des points est un cercle plein</span></span>
<span id="cb1201-6"><a href="lecon_spatiotemp.html#cb1201-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Tracer une ligne droite de pente 1 passant par l&#39;origine.</span></span>
<span id="cb1201-7"><a href="lecon_spatiotemp.html#cb1201-7" aria-hidden="true" tabindex="-1"></a><span class="co"># La fonction abline(a,b) permet de créer facilement une ligne en spécifiant </span></span>
<span id="cb1201-8"><a href="lecon_spatiotemp.html#cb1201-8" aria-hidden="true" tabindex="-1"></a><span class="co"># le point d&#39;interception sur l&#39;axe des y (paramètre a) et la pente (paramètre b)</span></span>
<span id="cb1201-9"><a href="lecon_spatiotemp.html#cb1201-9" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">a =</span> <span class="dv">0</span>, <span class="at">b =</span> <span class="dv">1</span>, <span class="at">lty =</span> <span class="dv">2</span>) <span class="co"># lty = 2 donne une ligne discontinue</span></span></code></pre></div>
<p><img src="Cours_SpatialR_files/figure-html/len_vs_len-1.svg" width="720" style="display: block; margin: auto;" />
<br></p>
<p>Nous voyons ainsi rapidement que tous les points sont sur la ligne 1:1. Ceci nous permet de conclure que les valeurs sont identiques ou très proches - car nous n’avons pas fait de tests formels, et ils se pourraient donc qu’il y ait de minimes différences entre les deux distances.</p>
<p>Nous devons ensuite quantifier la durée des trajets pour obtenir les vitesses moyennes. Pour cela, nous avons besoin des colonnes <code>start</code> et <code>stop</code> de l’objet <code>trajets</code> qui donnent la date et l’heure associées au début et à la fin de chaque trajet. Par exemple, pour les 20 premiers trajets ces colonnes nous donnent :</p>
<div class="sourceCode" id="cb1202"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1202-1"><a href="lecon_spatiotemp.html#cb1202-1" aria-hidden="true" tabindex="-1"></a>trajets<span class="sc">$</span>start[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>]</span></code></pre></div>
<pre class="codeout"><code> [1] &quot;2013-06-25 17:21:21 EDT&quot;
 [2] &quot;2013-07-25 15:37:42 EDT&quot;
 [3] &quot;2013-07-25 15:19:15 EDT&quot;
 [4] &quot;2013-06-25 17:21:20 EDT&quot;
 [5] &quot;2013-06-26 13:46:01 EDT&quot;
 [6] &quot;2013-07-02 13:21:56 EDT&quot;
 [7] &quot;2013-07-02 13:05:48 EDT&quot;
 [8] &quot;2013-07-25 17:45:52 EDT&quot;
 [9] &quot;2013-07-30 10:38:23 EDT&quot;
[10] &quot;2013-07-30 10:19:08 EDT&quot;</code></pre>
<div class="sourceCode" id="cb1204"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1204-1"><a href="lecon_spatiotemp.html#cb1204-1" aria-hidden="true" tabindex="-1"></a>trajets<span class="sc">$</span>stop[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>]</span></code></pre></div>
<pre class="codeout"><code> [1] &quot;2013-06-25 17:34:16 EDT&quot;
 [2] &quot;2013-07-25 15:40:06 EDT&quot;
 [3] &quot;2013-07-25 15:43:12 EDT&quot;
 [4] &quot;2013-06-25 17:34:16 EDT&quot;
 [5] &quot;2013-06-26 14:00:05 EDT&quot;
 [6] &quot;2013-07-02 13:25:26 EDT&quot;
 [7] &quot;2013-07-02 13:45:14 EDT&quot;
 [8] &quot;2013-07-25 18:21:40 EDT&quot;
 [9] &quot;2013-07-30 11:55:12 EDT&quot;
[10] &quot;2013-07-30 11:00:15 EDT&quot;</code></pre>
<p><br></p>
<p>Nous remarquons que la date et l’heure sont exprimées dans un format particulier. Regardons la classe des colonnes <code>start</code> et <code>stop</code>  :</p>
<div class="sourceCode" id="cb1206"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1206-1"><a href="lecon_spatiotemp.html#cb1206-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(trajets<span class="sc">$</span>start)</span></code></pre></div>
<pre class="codeout"><code>[1] &quot;POSIXct&quot; &quot;POSIXt&quot; </code></pre>
<div class="sourceCode" id="cb1208"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1208-1"><a href="lecon_spatiotemp.html#cb1208-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(trajets<span class="sc">$</span>stop)</span></code></pre></div>
<pre class="codeout"><code>[1] &quot;POSIXct&quot; &quot;POSIXt&quot; </code></pre>
<p><br></p>
<p>Les classes obtenues signifient que <code>start</code> et <code>stop</code> sont exprimés par des chaînes de caractères qui suivent une norme <a href="https://fr.wikipedia.org/wiki/POSIX">POSIX</a> (<em>Portable Operating System Interface</em>). En l’occurrence <code>POSIXct</code> (<em>calendar time</em>) est une variété de <code>POSIXt</code> (<em>time</em>) qui contient le nombre de secondes écoulées depuis l’<a href="https://fr.wikipedia.org/wiki/Heure_Unix">Heure Unix</a> (<em>Epoch time</em>), le 1<sup>er</sup> janvier 1970 00:00:00 UTC (<a href="https://fr.wikipedia.org/wiki/Temps_universel_coordonn%C3%A9">Temps Universel Coordonné</a>). Ainsi, il est possible de convertir des objets de classe <code>POSIXct</code> en objet de classe <code>numeric</code> pour obtenir le temps écoulé en secondes, par exemple :</p>
<div class="sourceCode" id="cb1210"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1210-1"><a href="lecon_spatiotemp.html#cb1210-1" aria-hidden="true" tabindex="-1"></a>nb_sec <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(trajets<span class="sc">$</span>start)</span>
<span id="cb1210-2"><a href="lecon_spatiotemp.html#cb1210-2" aria-hidden="true" tabindex="-1"></a>nb_sec[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>]</span></code></pre></div>
<pre class="codeout"><code> [1] 1.372e+09 1.375e+09 1.375e+09 1.372e+09 1.372e+09
 [6] 1.373e+09 1.373e+09 1.375e+09 1.375e+09 1.375e+09</code></pre>
<p><br></p>
<p>Aussi, la soustraction de deux objets <code>POSIXct</code> nous donne un objet de classe <code>difftime</code> qui exprime une durée:</p>
<div class="sourceCode" id="cb1212"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1212-1"><a href="lecon_spatiotemp.html#cb1212-1" aria-hidden="true" tabindex="-1"></a>duree <span class="ot">&lt;-</span> trajets<span class="sc">$</span>stop[<span class="dv">1</span>] <span class="sc">-</span> trajets<span class="sc">$</span>start[<span class="dv">1</span>]</span>
<span id="cb1212-2"><a href="lecon_spatiotemp.html#cb1212-2" aria-hidden="true" tabindex="-1"></a>duree</span></code></pre></div>
<pre class="codeout"><code>Time difference of 12.92 mins</code></pre>
<div class="sourceCode" id="cb1214"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1214-1"><a href="lecon_spatiotemp.html#cb1214-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(duree)</span></code></pre></div>
<pre class="codeout"><code>[1] &quot;difftime&quot;</code></pre>
<p><br></p>
<p>Nous pouvons aussi spécifier l’unité de temps dans laquelle nous voulons obtenir la durée entre deux évènements en utilisant la fonction <code>R</code> <code>difftime()</code>. Cette dernière est composée de trois arguments <code>difftime(end, start, units)</code> : la date et l’heure de l’évènement final, la date et l’heure de l’évènement initial, et l’unité désirée.</p>
<div class="sourceCode" id="cb1216"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1216-1"><a href="lecon_spatiotemp.html#cb1216-1" aria-hidden="true" tabindex="-1"></a>duree <span class="ot">&lt;-</span> <span class="fu">difftime</span>(trajets<span class="sc">$</span>stop[<span class="dv">1</span>], trajets<span class="sc">$</span>start[<span class="dv">1</span>], <span class="at">units =</span> <span class="st">&#39;secs&#39;</span>)</span>
<span id="cb1216-2"><a href="lecon_spatiotemp.html#cb1216-2" aria-hidden="true" tabindex="-1"></a>duree</span></code></pre></div>
<pre class="codeout"><code>Time difference of 775 secs</code></pre>
<p><br></p>
<p>Ainsi, nous pouvons calculer la durée de chaque trajet en seconde en utilisant la fonction <code>difftime()</code>. Ajoutons une colonne à l’objet <code>trajets</code> pour conserver le résultat de ce calcul.</p>
<div class="sourceCode" id="cb1218"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1218-1"><a href="lecon_spatiotemp.html#cb1218-1" aria-hidden="true" tabindex="-1"></a>trajets<span class="sc">$</span>duree_s <span class="ot">&lt;-</span> <span class="fu">difftime</span>(trajets<span class="sc">$</span>stop, trajets<span class="sc">$</span>start, <span class="at">units =</span> <span class="st">&#39;secs&#39;</span>)</span>
<span id="cb1218-2"><a href="lecon_spatiotemp.html#cb1218-2" aria-hidden="true" tabindex="-1"></a>trajets<span class="sc">$</span>duree_s[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>]</span></code></pre></div>
<pre class="codeout"><code>Time differences in secs
 [1]  775  144 1437  776  844  210 2366 2148 4609 2467</code></pre>
<p><br></p>
<p>Regardons maintenant les distributions de longueurs et de durées de trajets en dessinant un histogramme avec la fonction <code>hist()</code>.</p>
<div class="sourceCode" id="cb1220"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1220-1"><a href="lecon_spatiotemp.html#cb1220-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>)) <span class="co"># figure à deux panneaux côte à côte</span></span>
<span id="cb1220-2"><a href="lecon_spatiotemp.html#cb1220-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1220-3"><a href="lecon_spatiotemp.html#cb1220-3" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(trajets<span class="sc">$</span>length, </span>
<span id="cb1220-4"><a href="lecon_spatiotemp.html#cb1220-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">44000</span>, <span class="dv">2000</span>), <span class="co"># spécifie les catégories de longueur</span></span>
<span id="cb1220-5"><a href="lecon_spatiotemp.html#cb1220-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">xlab =</span> <span class="st">&quot;Longueur (m)&quot;</span>,</span>
<span id="cb1220-6"><a href="lecon_spatiotemp.html#cb1220-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">ylab =</span> <span class="st">&quot;Fréquence&quot;</span>,</span>
<span id="cb1220-7"><a href="lecon_spatiotemp.html#cb1220-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">main =</span> <span class="st">&quot;&quot;</span> <span class="co"># pas de titre</span></span>
<span id="cb1220-8"><a href="lecon_spatiotemp.html#cb1220-8" aria-hidden="true" tabindex="-1"></a>) </span>
<span id="cb1220-9"><a href="lecon_spatiotemp.html#cb1220-9" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(<span class="fu">as.numeric</span>(trajets<span class="sc">$</span>duree_s), </span>
<span id="cb1220-10"><a href="lecon_spatiotemp.html#cb1220-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">20000</span>, <span class="dv">1000</span>), <span class="co"># spécifie les catégories de durée</span></span>
<span id="cb1220-11"><a href="lecon_spatiotemp.html#cb1220-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">xlab =</span> <span class="st">&quot;Durée (s)&quot;</span>,</span>
<span id="cb1220-12"><a href="lecon_spatiotemp.html#cb1220-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">ylab =</span> <span class="st">&quot;Fréquence&quot;</span>,</span>
<span id="cb1220-13"><a href="lecon_spatiotemp.html#cb1220-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">main =</span> <span class="st">&quot;&quot;</span> <span class="co"># pas de titre</span></span>
<span id="cb1220-14"><a href="lecon_spatiotemp.html#cb1220-14" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="Cours_SpatialR_files/figure-html/histo-1.png" width="912" style="display: block; margin: auto;" /></p>
<p><br></p>
<p>Nous rajoutons maintenant une colonne <code>vitesse_m_s</code> à <code>trajets</code> qui est la vitesse moyenne de chaque trajet, exprimée en mètre par seconde.</p>
<div class="sourceCode" id="cb1221"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1221-1"><a href="lecon_spatiotemp.html#cb1221-1" aria-hidden="true" tabindex="-1"></a>trajets<span class="sc">$</span>vitesse_m_s <span class="ot">&lt;-</span> trajets<span class="sc">$</span>length<span class="sc">/</span><span class="fu">as.numeric</span>(trajets<span class="sc">$</span>duree_s)</span>
<span id="cb1221-2"><a href="lecon_spatiotemp.html#cb1221-2" aria-hidden="true" tabindex="-1"></a>trajets<span class="sc">$</span>vitesse_m_s[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>]</span></code></pre></div>
<pre class="codeout"><code> [1] 4.081 7.403 3.910 4.014 6.370 5.490 5.006 3.740
 [9] 4.588 3.370</code></pre>
<p><br></p>
<p>Notez que nous avons converti l’objet <code>trajets$duree_s</code> qui est de classe <code>difftime</code> en format numérique pour réaliser cette division.</p>
<p>Il peut être plus intuitif d’exprimer ces vitesses en kilomètre par heure, plutôt qu’en mètre par seconde, pour cela il nous suffit de diviser par 1000 [m/km] pour convertir les mètres en kilomètres et de multiplier les secondes par 3600 [s/h] pour les convertir en heures, ce qui revient à multiplier par 3.6 :</p>
<div class="sourceCode" id="cb1223"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1223-1"><a href="lecon_spatiotemp.html#cb1223-1" aria-hidden="true" tabindex="-1"></a>trajets<span class="sc">$</span>vitesse_km_h <span class="ot">&lt;-</span> trajets<span class="sc">$</span>vitesse_m_s <span class="sc">*</span> <span class="fl">3.6</span></span>
<span id="cb1223-2"><a href="lecon_spatiotemp.html#cb1223-2" aria-hidden="true" tabindex="-1"></a>trajets<span class="sc">$</span>vitesse_km_h[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>]</span></code></pre></div>
<pre class="codeout"><code> [1] 14.69 26.65 14.08 14.45 22.93 19.77 18.02 13.46
 [9] 16.52 12.13</code></pre>
<p><br></p>
<p>Afin de déterminer le trajet le plus rapide, nous allons maintenant ordonner les vitesses par ordre décroissant, avec la fonction <code>sort()</code>, et regarder les 10 premières valeurs :</p>
<div class="sourceCode" id="cb1225"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1225-1"><a href="lecon_spatiotemp.html#cb1225-1" aria-hidden="true" tabindex="-1"></a>vit_dec <span class="ot">&lt;-</span> <span class="fu">sort</span>(trajets<span class="sc">$</span>vitesse_km_h, <span class="at">decreasing =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1225-2"><a href="lecon_spatiotemp.html#cb1225-2" aria-hidden="true" tabindex="-1"></a>vit_dec[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>]</span></code></pre></div>
<pre class="codeout"><code> [1] 365.08  39.60  38.89  34.30  34.12  33.20  30.67
 [8]  30.46  29.99  29.51</code></pre>
<p><br></p>
<p>Le ou la plus rapide des cyclistes circule à une vitesse moyenne de 365 km/h, ce qui ne semble pas réaliste! Nous supposons qu’un problème d’enregistrement de ce trajet est à l’origine de cette valeur abberante. Nous excluons donc ce trajet et retenons le second comme étant le plus rapide. Pour extraire le second trajet, nous utilisons la fonction <code>order()</code>.</p>
<div class="sourceCode" id="cb1227"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1227-1"><a href="lecon_spatiotemp.html#cb1227-1" aria-hidden="true" tabindex="-1"></a>traj_rapide <span class="ot">&lt;-</span> trajets[<span class="fu">order</span>(trajets<span class="sc">$</span>vitesse_km_h, <span class="at">decreasing =</span> <span class="cn">TRUE</span>)[<span class="dv">2</span>], ]</span>
<span id="cb1227-2"><a href="lecon_spatiotemp.html#cb1227-2" aria-hidden="true" tabindex="-1"></a>traj_rapide </span></code></pre></div>
<pre class="codeout"><code>Simple feature collection with 1 feature and 10 fields
Geometry type: LINESTRING
Dimension:     XY
Bounding box:  xmin: -73.59 ymin: 45.53 xmax: -73.58 ymax: 45.53
Geodetic CRS:  WGS 84
                   stop id_origine               start
207 2013-08-05 22:00:02       3943 2013-08-05 21:58:45
    length purpose n_coord   id
207    847  Social     145 3943
                          geometry duree_s vitesse_m_s
207 LINESTRING (-73.58 45.53, -... 77 secs          11
    vitesse_km_h
207         39.6</code></pre>
<p><br></p>
<p>Notez que la fonction <code>order()</code> retourne l’indice de l’élément désiré, alors que la fonction <code>sort()</code> retourne la valeur de l’élément.</p>
<p>Nous pouvons visualiser ce trajet en utilisant la fonction <code>mapview()</code> de la bibliothèque <code>mapview()</code>.</p>
<div class="sourceCode" id="cb1229"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1229-1"><a href="lecon_spatiotemp.html#cb1229-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mapview)</span>
<span id="cb1229-2"><a href="lecon_spatiotemp.html#cb1229-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mapview</span>(traj_rapide)</span></code></pre></div>
<pre><code>Warning in clean_columns(as.data.frame(obj),
factorsAsCharacter): Dropping column(s) duree_s of
class(es) difftime</code></pre>
<div class="leaflet html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-42ff53d8ff5731c64fbc" style="width:720px;height:720px;"></div>
<script type="application/json" data-for="htmlwidget-42ff53d8ff5731c64fbc">{"x":{"options":{"minZoom":1,"maxZoom":52,"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}},"preferCanvas":false,"bounceAtZoomLimits":false,"maxBounds":[[[-90,-370]],[[90,370]]]},"calls":[{"method":"addProviderTiles","args":["OpenStreetMap","OpenStreetMap","OpenStreetMap",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"createMapPane","args":["line",430]},{"method":"addFlatGeoBuf","args":["traj_rapide","traj_rapide",null,true,"mvFeatureId",{"radius":6,"stroke":true,"color":"#6666FF","weight":2,"opacity":0.9,"fill":false,"fillColor":null,"fillOpacity":1},{"className":"","pane":"line"},"mapview-popup",{"radius":{"to":[3,15],"from":[3,15]},"weight":{"to":[1,10],"from":[1,10]},"opacity":{"to":[0,1],"from":[0,1]},"fillOpacity":{"to":[0,1],"from":[0,1]}}]},{"method":"addScaleBar","args":[{"maxWidth":100,"metric":true,"imperial":true,"updateWhenIdle":true,"position":"bottomleft"}]},{"method":"addHomeButton","args":[-73.5852583491462,45.5318534268499,-73.583280899835,45.5340974266019,true,"traj_rapide","Zoom to traj_rapide","<strong> traj_rapide <\/strong>","bottomright"]},{"method":"addLayersControl","args":["OpenStreetMap","traj_rapide",{"collapsed":true,"autoZIndex":true,"position":"topleft"}]},{"method":"addLegend","args":[{"colors":["#6666FF"],"labels":["traj_rapide"],"na_color":null,"na_label":"NA","opacity":0.3,"position":"bottomleft","type":"factor","title":"","extra":null,"layerId":null,"className":"info legend","group":"traj_rapide"}]}],"fitBounds":[45.5318534268499,-73.5852583491462,45.5340974266019,-73.583280899835,[]]},"evals":[],"jsHooks":{"render":[{"code":"function(el, x, data) {\n  return (\n      function(el, x, data) {\n      // get the leaflet map\n      var map = this; //HTMLWidgets.find('#' + el.id);\n      // we need a new div element because we have to handle\n      // the mouseover output separately\n      // debugger;\n      function addElement () {\n      // generate new div Element\n      var newDiv = $(document.createElement('div'));\n      // append at end of leaflet htmlwidget container\n      $(el).append(newDiv);\n      //provide ID and style\n      newDiv.addClass('lnlt');\n      newDiv.css({\n      'position': 'relative',\n      'bottomleft':  '0px',\n      'background-color': 'rgba(255, 255, 255, 0.7)',\n      'box-shadow': '0 0 2px #bbb',\n      'background-clip': 'padding-box',\n      'margin': '0',\n      'padding-left': '5px',\n      'color': '#333',\n      'font': '9px/1.5 \"Helvetica Neue\", Arial, Helvetica, sans-serif',\n      'z-index': '700',\n      });\n      return newDiv;\n      }\n\n\n      // check for already existing lnlt class to not duplicate\n      var lnlt = $(el).find('.lnlt');\n\n      if(!lnlt.length) {\n      lnlt = addElement();\n\n      // grab the special div we generated in the beginning\n      // and put the mousmove output there\n\n      map.on('mousemove', function (e) {\n      if (e.originalEvent.ctrlKey) {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                           ' lon: ' + (e.latlng.lng).toFixed(5) +\n                           ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                           ' | zoom: ' + map.getZoom() +\n                           ' | x: ' + L.CRS.EPSG3857.project(e.latlng).x.toFixed(0) +\n                           ' | y: ' + L.CRS.EPSG3857.project(e.latlng).y.toFixed(0) +\n                           ' | epsg: 3857 ' +\n                           ' | proj4: +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs ');\n      } else {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                      ' lon: ' + (e.latlng.lng).toFixed(5) +\n                      ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                      ' | zoom: ' + map.getZoom() + ' ');\n      }\n      });\n\n      // remove the lnlt div when mouse leaves map\n      map.on('mouseout', function (e) {\n      var strip = document.querySelector('.lnlt');\n      if( strip !==null) strip.remove();\n      });\n\n      };\n\n      //$(el).keypress(67, function(e) {\n      map.on('preclick', function(e) {\n      if (e.originalEvent.ctrlKey) {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                      ' lon: ' + (e.latlng.lng).toFixed(5) +\n                      ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                      ' | zoom: ' + map.getZoom() + ' ');\n      var txt = document.querySelector('.lnlt').textContent;\n      console.log(txt);\n      //txt.innerText.focus();\n      //txt.select();\n      setClipboardText('\"' + txt + '\"');\n      }\n      });\n\n      }\n      ).call(this.getMap(), el, x, data);\n}","data":null},{"code":"function(el, x, data) {\n  return (function(el,x,data){\n           var map = this;\n\n           map.on('keypress', function(e) {\n               console.log(e.originalEvent.code);\n               var key = e.originalEvent.code;\n               if (key === 'KeyE') {\n                   var bb = this.getBounds();\n                   var txt = JSON.stringify(bb);\n                   console.log(txt);\n\n                   setClipboardText('\\'' + txt + '\\'');\n               }\n           })\n        }).call(this.getMap(), el, x, data);\n}","data":null}]}}</script>
<p><br></p>
<p>Un trajet bien singulier, à 22h près du parc Laurier.</p>
<p>Nous remarquons que l’enregistrement du trajet manque probablement de précision, ce qui expliquerait son allure quelque peu tordue…</p>
<p><br></p>
</div>
<div id="période-de-lannée-préférée" class="section level4 hasAnchor" number="9.1.2.3">
<h4><span class="header-section-number">9.1.2.3</span> Période de l’année préférée<a href="lecon_spatiotemp.html#période-de-lannée-préférée" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Penchons-nous maintenant sur la deuxième question.</p>
<blockquote>
<p><strong>Quelle est la période de l’année préférée des cyclistes du jeu de données?</strong></p>
</blockquote>
<p><br></p>
<!-- Ajouter icone biblio  -->
<p>Pour répondre à cette deuxième question, nous allons utiliser certaines fonctions de la bibliothèque <a href="https://CRAN.R-project.org/package=lubridate"><code>lubridate</code></a>. Bien que <code>R</code> dispose, de base, de toutes les fonctionnalités nécessaires à la manipulation des dates et du temps, <code>lubridate</code> rend ces manipulations plus intuitives (l’aide mémoire (<a href="https://github.com/rstudio/cheatsheets/raw/master/lubridate.pdf" class="uri">https://github.com/rstudio/cheatsheets/raw/master/lubridate.pdf</a> fait un tour d’horizon complet des fonctionnalités de <code>lubridate</code>).</p>
<p>Installons donc la bibliothèque <code>lubridate</code> :</p>
<div class="sourceCode" id="cb1231"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1231-1"><a href="lecon_spatiotemp.html#cb1231-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;lubridate&quot;</span>)</span></code></pre></div>
<p><br></p>
<p>Chargeons la bibliothèque <code>lubridate</code> dans notre session de travail <code>R</code> afin de manipuler les données de classes <code>POSIXct</code> des colonnes <code>start</code> et <code>stop</code>. Par exemple nous pouvons extraire l’année avec la fonction <code>year()</code> :</p>
<div class="sourceCode" id="cb1232"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1232-1"><a href="lecon_spatiotemp.html#cb1232-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span></code></pre></div>
<pre><code>Warning: package &#39;lubridate&#39; was built under R version
4.2.2</code></pre>
<div class="sourceCode" id="cb1234"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1234-1"><a href="lecon_spatiotemp.html#cb1234-1" aria-hidden="true" tabindex="-1"></a><span class="fu">year</span>(trajets<span class="sc">$</span>start)[<span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>]</span></code></pre></div>
<pre class="codeout"><code> [1] 2013 2013 2013 2013 2013 2013 2013 2013 2013 2013
[11] 2013 2013 2013 2013 2013 2013 2013 2013 2013 2013</code></pre>
<p><br></p>
<p>Afin de répondre à la question, nous commençons par identifier le mois de l’année qui compte le plus de trajets à vélo. Pour cela, nous allons utiliser la fonction <code>month()</code> de la bibliothèque <code>lubridate</code>. Cette fonction nous retourne le mois associé à un objet de classe <code>POSIXct</code></p>
<div class="sourceCode" id="cb1236"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1236-1"><a href="lecon_spatiotemp.html#cb1236-1" aria-hidden="true" tabindex="-1"></a><span class="fu">month</span>(trajets<span class="sc">$</span>start[<span class="dv">1</span>])</span></code></pre></div>
<pre class="codeout"><code>[1] 6</code></pre>
<p><br></p>
<p>La fonction <code>month()</code> nous offre aussi la possibilité d’utiliser les noms de mois (en anglais) sous forme de facteurs, de manière abrégée  :</p>
<div class="sourceCode" id="cb1238"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1238-1"><a href="lecon_spatiotemp.html#cb1238-1" aria-hidden="true" tabindex="-1"></a><span class="fu">month</span>(trajets<span class="sc">$</span>start[<span class="dv">1</span>], <span class="at">label =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre class="codeout"><code>[1] Jun
12 Levels: Jan &lt; Feb &lt; Mar &lt; Apr &lt; May &lt; ... &lt; Dec</code></pre>
<p><br></p>
<p>ou intégrale :</p>
<div class="sourceCode" id="cb1240"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1240-1"><a href="lecon_spatiotemp.html#cb1240-1" aria-hidden="true" tabindex="-1"></a><span class="fu">month</span>(trajets<span class="sc">$</span>start[<span class="dv">1</span>], <span class="at">label =</span> <span class="cn">TRUE</span>, <span class="at">abbr =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<pre class="codeout"><code>[1] June
12 Levels: January &lt; February &lt; March &lt; ... &lt; December</code></pre>
<p><br></p>
<p>Pour la tâche à réaliser, utilisons seulement le numéro des mois et créons une colonne <code>mois</code> dans la table d’attributs de l’objet <code>trajets</code> pour les conserver :</p>
<div class="sourceCode" id="cb1242"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1242-1"><a href="lecon_spatiotemp.html#cb1242-1" aria-hidden="true" tabindex="-1"></a>trajets<span class="sc">$</span>mois <span class="ot">&lt;-</span> <span class="fu">month</span>(trajets<span class="sc">$</span>start)</span>
<span id="cb1242-2"><a href="lecon_spatiotemp.html#cb1242-2" aria-hidden="true" tabindex="-1"></a>trajets<span class="sc">$</span>mois[<span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>]</span></code></pre></div>
<pre class="codeout"><code> [1] 6 7 7 6 6 7 7 7 7 7 6 6 7 7 6 6 6 6 7 7</code></pre>
<p><br></p>
<p>Une manière efficace de compter le nombre d’occurrence est d’appliquer la fonction <code>table()</code> sur la colonne nouvellement créée :</p>
<div class="sourceCode" id="cb1244"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1244-1"><a href="lecon_spatiotemp.html#cb1244-1" aria-hidden="true" tabindex="-1"></a>nb_mois <span class="ot">&lt;-</span> <span class="fu">table</span>(trajets<span class="sc">$</span>mois)</span>
<span id="cb1244-2"><a href="lecon_spatiotemp.html#cb1244-2" aria-hidden="true" tabindex="-1"></a>nb_mois </span></code></pre></div>
<pre class="codeout"><code>
  1   5   6   7   8 
  6   1  11 376   6 </code></pre>
<p><br></p>
<p>Juillet (le 7<sup>ième</sup> mois de l’année) est donc le mois qui concentre le plus de trajets à vélo dans le jeu de données étudié. Nous allons maintenant regarder le jour qui concentre le plus de trajets avec la fonction <code>day()</code> de la bibliothèque <code>lubridate</code>. Nous commençons par ajouter une colonne <code>jour</code> à l’objet <code>trajets</code>.</p>
<div class="sourceCode" id="cb1246"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1246-1"><a href="lecon_spatiotemp.html#cb1246-1" aria-hidden="true" tabindex="-1"></a>trajets<span class="sc">$</span>jour <span class="ot">&lt;-</span> <span class="fu">day</span>(trajets<span class="sc">$</span>start)</span>
<span id="cb1246-2"><a href="lecon_spatiotemp.html#cb1246-2" aria-hidden="true" tabindex="-1"></a>trajets<span class="sc">$</span>jour[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>]</span></code></pre></div>
<pre class="codeout"><code> [1] 25 25 25 25 26  2  2 25 30 30</code></pre>
<p><br></p>
<p>Isolons ensuite les trajets effectués au mois de juillet.</p>
<div class="sourceCode" id="cb1248"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1248-1"><a href="lecon_spatiotemp.html#cb1248-1" aria-hidden="true" tabindex="-1"></a>traj_juillet <span class="ot">&lt;-</span> trajets[trajets<span class="sc">$</span>mois <span class="sc">==</span> <span class="dv">7</span>, ]</span></code></pre></div>
<p><br></p>
<p>Enfin, visualisons le nombre de trajets par jour avec les fonctions <code>table()</code> et <code>barplot()</code> cette fois-ci.</p>
<div class="sourceCode" id="cb1249"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1249-1"><a href="lecon_spatiotemp.html#cb1249-1" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(</span>
<span id="cb1249-2"><a href="lecon_spatiotemp.html#cb1249-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">table</span>(traj_juillet<span class="sc">$</span>jour),</span>
<span id="cb1249-3"><a href="lecon_spatiotemp.html#cb1249-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">xlab =</span> <span class="st">&quot;Jour de juillet&quot;</span>,</span>
<span id="cb1249-4"><a href="lecon_spatiotemp.html#cb1249-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">ylab =</span> <span class="st">&quot;Nombre de trajets&quot;</span></span>
<span id="cb1249-5"><a href="lecon_spatiotemp.html#cb1249-5" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="Cours_SpatialR_files/figure-html/barplot_day-1.png" width="912" style="display: block; margin: auto;" /></p>
<p>C’est donc le 10 juillet que nous recensons le plus grand nombre de trajets.
Nous allons même aller à l’échelle de l’heure et nous recommençons les étapes précédentes avec la fonction <code>hour()</code>. Au passage, mentionnons la bibliothèque <a href="https://CRAN.R-project.org/package=hms"><code>hms</code></a> pour manipuler les heures, minutes et secondes (nous ne l’utiliserons pas ici, mais elles pourraient vous être utile dans vos projets futurs).</p>
<div class="sourceCode" id="cb1250"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1250-1"><a href="lecon_spatiotemp.html#cb1250-1" aria-hidden="true" tabindex="-1"></a>trajets<span class="sc">$</span>heure <span class="ot">&lt;-</span> <span class="fu">hour</span>(trajets<span class="sc">$</span>start)</span>
<span id="cb1250-2"><a href="lecon_spatiotemp.html#cb1250-2" aria-hidden="true" tabindex="-1"></a>traj_10juillet <span class="ot">&lt;-</span> trajets[trajets<span class="sc">$</span>mois <span class="sc">==</span> <span class="dv">7</span> <span class="sc">&amp;</span> trajets<span class="sc">$</span>jour <span class="sc">==</span> <span class="dv">10</span>, ]</span>
<span id="cb1250-3"><a href="lecon_spatiotemp.html#cb1250-3" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(</span>
<span id="cb1250-4"><a href="lecon_spatiotemp.html#cb1250-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">table</span>(traj_10juillet<span class="sc">$</span>heure),</span>
<span id="cb1250-5"><a href="lecon_spatiotemp.html#cb1250-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">xlab =</span> <span class="st">&quot;Jours de juillet&quot;</span>,</span>
<span id="cb1250-6"><a href="lecon_spatiotemp.html#cb1250-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">ylab =</span> <span class="st">&quot;Nombre de trajets&quot;</span></span>
<span id="cb1250-7"><a href="lecon_spatiotemp.html#cb1250-7" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="Cours_SpatialR_files/figure-html/traj_10juillet-1.png" width="912" style="display: block; margin: auto;" /></p>
<p>C’est donc à 17h le 10 juillet que les trajets sont les plus nombreux.</p>
<p><br></p>
</div>
<div id="animation-du-trajet-le-plus-long" class="section level4 hasAnchor" number="9.1.2.4">
<h4><span class="header-section-number">9.1.2.4</span> Animation du trajet le plus long<a href="lecon_spatiotemp.html#animation-du-trajet-le-plus-long" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Nous allons à présent animer le trajet de vélo le plus long. Nous voulons, en effet, créer un fichier <a href="https://fr.wikipedia.org/wiki/Graphics_Interchange_Format">GIF</a> qui illustrera le parcours de la ou du cycliste. Pour y arriver nous devrons faire les étapes suivantes :</p>
<blockquote>
<ol style="list-style-type: decimal">
<li>Trouver le trajet le plus long.</li>
<li>Associer un temps à chaque segment du parcours.</li>
<li>Créer une carte pour différents états d’avancement du parcours.</li>
<li>Rassembler les cartes ainsi créées et en faire un fichier GIF.</li>
</ol>
</blockquote>
<p><br></p>
<p>Commençons!</p>
<div id="trajet-le-plus-long" class="section level6 unnumbered hasAnchor">
<h6>1. Trajet le plus long<a href="lecon_spatiotemp.html#trajet-le-plus-long" class="anchor-section" aria-label="Anchor link to header"></a></h6>
<p>La première étape est une manipulation de filtres que nous avons fait à maintes reprises. Cette fois-ci appliquons <code>which.max()</code> sur la colonne <code>length()</code> et nous filtrons avec <code>[</code>.</p>
<div class="sourceCode" id="cb1251"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1251-1"><a href="lecon_spatiotemp.html#cb1251-1" aria-hidden="true" tabindex="-1"></a>traj_long <span class="ot">&lt;-</span> trajets[<span class="fu">which.max</span>(trajets<span class="sc">$</span>length), ]</span>
<span id="cb1251-2"><a href="lecon_spatiotemp.html#cb1251-2" aria-hidden="true" tabindex="-1"></a>traj_long</span></code></pre></div>
<pre class="codeout"><code>Simple feature collection with 1 feature and 13 fields
Geometry type: LINESTRING
Dimension:     XY
Bounding box:  xmin: -73.69 ymin: 45.43 xmax: -73.55 ymax: 45.53
Geodetic CRS:  WGS 84
                  stop id_origine               start
69 2013-07-30 15:52:09       3082 2013-07-30 11:38:30
   length purpose n_coord   id
69  42503  Social   14511 3082
                         geometry    duree_s
69 LINESTRING (-73.57 45.52, -... 15219 secs
   vitesse_m_s vitesse_km_h mois jour heure
69       2.793        10.05    7   30    11</code></pre>
<p><br></p>
<p>Regardons ce trajet :</p>
<div class="sourceCode" id="cb1253"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1253-1"><a href="lecon_spatiotemp.html#cb1253-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mapview</span>(traj_long)</span></code></pre></div>
<pre><code>Warning in clean_columns(as.data.frame(obj),
factorsAsCharacter): Dropping column(s) duree_s of
class(es) difftime</code></pre>
<div class="leaflet html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-896231fde0185b926686" style="width:720px;height:720px;"></div>
<script type="application/json" data-for="htmlwidget-896231fde0185b926686">{"x":{"options":{"minZoom":1,"maxZoom":52,"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}},"preferCanvas":false,"bounceAtZoomLimits":false,"maxBounds":[[[-90,-370]],[[90,370]]]},"calls":[{"method":"addProviderTiles","args":["OpenStreetMap","OpenStreetMap","OpenStreetMap",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"createMapPane","args":["line",430]},{"method":"addFlatGeoBuf","args":["traj_long","traj_long",null,true,"mvFeatureId",{"radius":6,"stroke":true,"color":"#6666FF","weight":2,"opacity":0.9,"fill":false,"fillColor":null,"fillOpacity":1},{"className":"","pane":"line"},"mapview-popup",{"radius":{"to":[3,15],"from":[3,15]},"weight":{"to":[1,10],"from":[1,10]},"opacity":{"to":[0,1],"from":[0,1]},"fillOpacity":{"to":[0,1],"from":[0,1]}}]},{"method":"addScaleBar","args":[{"maxWidth":100,"metric":true,"imperial":true,"updateWhenIdle":true,"position":"bottomleft"}]},{"method":"addHomeButton","args":[-73.6881344437,45.4282272897018,-73.5498288786,45.5324647899019,true,"traj_long","Zoom to traj_long","<strong> traj_long <\/strong>","bottomright"]},{"method":"addLayersControl","args":["OpenStreetMap","traj_long",{"collapsed":true,"autoZIndex":true,"position":"topleft"}]},{"method":"addLegend","args":[{"colors":["#6666FF"],"labels":["traj_long"],"na_color":null,"na_label":"NA","opacity":0.3,"position":"bottomleft","type":"factor","title":"","extra":null,"layerId":null,"className":"info legend","group":"traj_long"}]}],"fitBounds":[45.4282272897018,-73.6881344437,45.5324647899019,-73.5498288786,[]]},"evals":[],"jsHooks":{"render":[{"code":"function(el, x, data) {\n  return (\n      function(el, x, data) {\n      // get the leaflet map\n      var map = this; //HTMLWidgets.find('#' + el.id);\n      // we need a new div element because we have to handle\n      // the mouseover output separately\n      // debugger;\n      function addElement () {\n      // generate new div Element\n      var newDiv = $(document.createElement('div'));\n      // append at end of leaflet htmlwidget container\n      $(el).append(newDiv);\n      //provide ID and style\n      newDiv.addClass('lnlt');\n      newDiv.css({\n      'position': 'relative',\n      'bottomleft':  '0px',\n      'background-color': 'rgba(255, 255, 255, 0.7)',\n      'box-shadow': '0 0 2px #bbb',\n      'background-clip': 'padding-box',\n      'margin': '0',\n      'padding-left': '5px',\n      'color': '#333',\n      'font': '9px/1.5 \"Helvetica Neue\", Arial, Helvetica, sans-serif',\n      'z-index': '700',\n      });\n      return newDiv;\n      }\n\n\n      // check for already existing lnlt class to not duplicate\n      var lnlt = $(el).find('.lnlt');\n\n      if(!lnlt.length) {\n      lnlt = addElement();\n\n      // grab the special div we generated in the beginning\n      // and put the mousmove output there\n\n      map.on('mousemove', function (e) {\n      if (e.originalEvent.ctrlKey) {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                           ' lon: ' + (e.latlng.lng).toFixed(5) +\n                           ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                           ' | zoom: ' + map.getZoom() +\n                           ' | x: ' + L.CRS.EPSG3857.project(e.latlng).x.toFixed(0) +\n                           ' | y: ' + L.CRS.EPSG3857.project(e.latlng).y.toFixed(0) +\n                           ' | epsg: 3857 ' +\n                           ' | proj4: +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs ');\n      } else {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                      ' lon: ' + (e.latlng.lng).toFixed(5) +\n                      ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                      ' | zoom: ' + map.getZoom() + ' ');\n      }\n      });\n\n      // remove the lnlt div when mouse leaves map\n      map.on('mouseout', function (e) {\n      var strip = document.querySelector('.lnlt');\n      if( strip !==null) strip.remove();\n      });\n\n      };\n\n      //$(el).keypress(67, function(e) {\n      map.on('preclick', function(e) {\n      if (e.originalEvent.ctrlKey) {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                      ' lon: ' + (e.latlng.lng).toFixed(5) +\n                      ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                      ' | zoom: ' + map.getZoom() + ' ');\n      var txt = document.querySelector('.lnlt').textContent;\n      console.log(txt);\n      //txt.innerText.focus();\n      //txt.select();\n      setClipboardText('\"' + txt + '\"');\n      }\n      });\n\n      }\n      ).call(this.getMap(), el, x, data);\n}","data":null},{"code":"function(el, x, data) {\n  return (function(el,x,data){\n           var map = this;\n\n           map.on('keypress', function(e) {\n               console.log(e.originalEvent.code);\n               var key = e.originalEvent.code;\n               if (key === 'KeyE') {\n                   var bb = this.getBounds();\n                   var txt = JSON.stringify(bb);\n                   console.log(txt);\n\n                   setClipboardText('\\'' + txt + '\\'');\n               }\n           })\n        }).call(this.getMap(), el, x, data);\n}","data":null}]}}</script>
<p><br></p>
</div>
<div id="segmentation-du-trajet" class="section level6 unnumbered hasAnchor">
<h6>2. Segmentation du trajet<a href="lecon_spatiotemp.html#segmentation-du-trajet" class="anchor-section" aria-label="Anchor link to header"></a></h6>
<p>Nous allons segmenter le trajet le plus long en une série de points successifs. Chaque point marquera ainsi une portion du trajet total. Nous allons ensuite associer un temps à chacune de ces portions. Pour ce faire, nous commencons par convertir la géométrie de <code>traj_long</code> de <code>LINESTRING</code> à <code>POINT</code> avec la fonction <a href="lecon_manip_vec.html#fct_cast"><code>st_cast()</code></a> vue au module 7.</p>
<div class="sourceCode" id="cb1255"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1255-1"><a href="lecon_spatiotemp.html#cb1255-1" aria-hidden="true" tabindex="-1"></a>traj_long_pts <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(<span class="fu">st_cast</span>(<span class="fu">st_geometry</span>(traj_long), <span class="at">to =</span> <span class="st">&quot;POINT&quot;</span>))</span>
<span id="cb1255-2"><a href="lecon_spatiotemp.html#cb1255-2" aria-hidden="true" tabindex="-1"></a>traj_long_pts</span></code></pre></div>
<pre class="codeout"><code>Simple feature collection with 10818 features and 0 fields
Geometry type: POINT
Dimension:     XY
Bounding box:  xmin: -73.69 ymin: 45.43 xmax: -73.55 ymax: 45.53
Geodetic CRS:  WGS 84
First 10 features:
                      x
1  POINT (-73.57 45.52)
2  POINT (-73.57 45.52)
3  POINT (-73.57 45.52)
4  POINT (-73.57 45.52)
5  POINT (-73.57 45.52)
6  POINT (-73.57 45.52)
7  POINT (-73.57 45.52)
8  POINT (-73.57 45.52)
9  POINT (-73.57 45.52)
10 POINT (-73.57 45.52)</code></pre>
<p><br></p>
<p>Décortiquons cette ligne:</p>
<ol style="list-style-type: lower-roman">
<li><p>Nous isolons d’abord la géométrie de <code>traj_long</code> avec la fonction <code>st_geometry()</code>.</p></li>
<li><p>Nous faisons ensuite la conversion point/ligne avec la fonction <code>st_cast()</code>.</p></li>
<li><p>Finalement, nous convertissons l’objet de classe <code>sfc</code> ainsi obtenu en objet de classe <code>sf</code> avec <code>st_as_sf()</code>.</p></li>
</ol>
<p><br></p>
<p>L’objet <code>traj_long_pts</code> ainsi créé contient 10818 points</p>
<div class="sourceCode" id="cb1257"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1257-1"><a href="lecon_spatiotemp.html#cb1257-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(traj_long_pts)</span></code></pre></div>
<pre class="codeout"><code>[1] 10818</code></pre>
<p><br></p>
<p>Maintenant, nous allons associer un temps à chaque point du trajet. D’emblée, il nous est possible de déterminer le temps de départ et le temps d’arrivée de ce trajet puisque ceux-ci sont donnés par les valeurs de <code>traj_long$start</code> et de <code>traj_long$stop</code> respectivement. De plus, l’application “Mon RésoVélo” enregistre les coordonnées spatiales le long d’un trajet à intervalle régulier. Ainsi, le temps associé à chaque point d’un trajet est réparti de façon régulière entre son temps de départ et son temps d’arrivée. Nous créons donc une séquence régulière avec la fonction <code>R</code> <code>seq()</code> en spécifiant le temps de départ, le temps d’arrivé et le nombre de points que doit inclure la séquence (argument <code>length.out</code>) qui est le nombre de lignes (<code>nrow()</code>) de la table d’attributs de <code>traj_long_pts</code>. Finalement, nous ajoutons cette séquence au nouvel objet <code>traj_long_pts</code> dans une colonne <code>temps</code>.</p>
<div class="sourceCode" id="cb1259"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1259-1"><a href="lecon_spatiotemp.html#cb1259-1" aria-hidden="true" tabindex="-1"></a>traj_long_pts<span class="sc">$</span>temps <span class="ot">&lt;-</span> <span class="fu">seq</span>(</span>
<span id="cb1259-2"><a href="lecon_spatiotemp.html#cb1259-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">from =</span> traj_long<span class="sc">$</span>start, </span>
<span id="cb1259-3"><a href="lecon_spatiotemp.html#cb1259-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">to =</span> traj_long<span class="sc">$</span>stop, </span>
<span id="cb1259-4"><a href="lecon_spatiotemp.html#cb1259-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">length.out =</span> <span class="fu">nrow</span>(traj_long_pts)</span>
<span id="cb1259-5"><a href="lecon_spatiotemp.html#cb1259-5" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p><br></p>
</div>
<div id="visualisation-du-trajet-pour-différentes-périodes" class="section level6 unnumbered hasAnchor">
<h6>3. Visualisation du trajet pour différentes périodes<a href="lecon_spatiotemp.html#visualisation-du-trajet-pour-différentes-périodes" class="anchor-section" aria-label="Anchor link to header"></a></h6>
<p>À présent, nous allons visualiser le trajet parcouru sur différentes périodes de temps. Pour chaque période, nous sauvegarderons la visualisation obtenue. À la prochaine étape, nous combinerons ces images pour obtenir une animation.</p>
<p>Dans un premier temps, visualisons le trajet parcouru pour une période de temps arbitraire, autrement dit pour une période allant du premier point jusqu’à n’importe quel points <span class="math inline">\(n\)</span> le long du trajet <code>traj_long_pts</code>. À titre d’exemple, choisissons les 2000 premiers points.</p>
<div class="sourceCode" id="cb1260"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1260-1"><a href="lecon_spatiotemp.html#cb1260-1" aria-hidden="true" tabindex="-1"></a>lin <span class="ot">&lt;-</span> <span class="fu">st_cast</span>(<span class="fu">st_combine</span>(traj_long_pts[<span class="dv">1</span><span class="sc">:</span><span class="dv">2000</span>, ]), <span class="st">&quot;LINESTRING&quot;</span>)</span></code></pre></div>
<p><br></p>
<p>Cette ligne contient les étapes suivantes:</p>
<ol style="list-style-type: lower-roman">
<li>Nous extrayons les 2000 premiers points avec <code>[</code>.</li>
<li>Nous les combinons en <code>MULTIPOINT</code> avec <code>st_combine()</code>.</li>
<li>Nous transformons le <code>MULTIPOINT</code> en <code>LINESTRING</code> avec <code>st_cast()</code>.</li>
</ol>
<p><br></p>
<p>Notons que sans l’étape (ii), <code>st_cast()</code> transformera chaque point en ligne ce qui donnera un ensemble de lignes de 1 seul point.</p>
<p>Regardons cette section du trajet avec <code>mapview()</code>.</p>
<div class="sourceCode" id="cb1261"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1261-1"><a href="lecon_spatiotemp.html#cb1261-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mapview</span>(lin) </span></code></pre></div>
<div class="leaflet html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-e8d7c6ea82033af74cf3" style="width:720px;height:720px;"></div>
<script type="application/json" data-for="htmlwidget-e8d7c6ea82033af74cf3">{"x":{"options":{"minZoom":1,"maxZoom":52,"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}},"preferCanvas":false,"bounceAtZoomLimits":false,"maxBounds":[[[-90,-370]],[[90,370]]]},"calls":[{"method":"addProviderTiles","args":["OpenStreetMap","OpenStreetMap","OpenStreetMap",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"createMapPane","args":["line",430]},{"method":"addFlatGeoBuf","args":["lin","lin",null,null,null,{"radius":6,"stroke":true,"color":"#6666ff","weight":2,"opacity":0.9,"fill":false,"fillColor":"#6666ff","fillOpacity":1},{"pane":"line"},null,{"radius":{"to":[3,15],"from":[3,15]},"weight":{"to":[1,10],"from":[1,10]},"opacity":{"to":[0,1],"from":[0,1]},"fillOpacity":{"to":[0,1],"from":[0,1]}}]},{"method":"addScaleBar","args":[{"maxWidth":100,"metric":true,"imperial":true,"updateWhenIdle":true,"position":"bottomleft"}]},{"method":"addHomeButton","args":[-73.5801996502,45.4728542733019,-73.549896643,45.5190419225193,true,"lin","Zoom to lin","<strong> lin <\/strong>","bottomright"]},{"method":"addLayersControl","args":["OpenStreetMap","lin",{"collapsed":true,"autoZIndex":true,"position":"topleft"}]}],"fitBounds":[45.4728542733019,-73.5801996502,45.5190419225193,-73.549896643,[]]},"evals":[],"jsHooks":{"render":[{"code":"function(el, x, data) {\n  return (\n      function(el, x, data) {\n      // get the leaflet map\n      var map = this; //HTMLWidgets.find('#' + el.id);\n      // we need a new div element because we have to handle\n      // the mouseover output separately\n      // debugger;\n      function addElement () {\n      // generate new div Element\n      var newDiv = $(document.createElement('div'));\n      // append at end of leaflet htmlwidget container\n      $(el).append(newDiv);\n      //provide ID and style\n      newDiv.addClass('lnlt');\n      newDiv.css({\n      'position': 'relative',\n      'bottomleft':  '0px',\n      'background-color': 'rgba(255, 255, 255, 0.7)',\n      'box-shadow': '0 0 2px #bbb',\n      'background-clip': 'padding-box',\n      'margin': '0',\n      'padding-left': '5px',\n      'color': '#333',\n      'font': '9px/1.5 \"Helvetica Neue\", Arial, Helvetica, sans-serif',\n      'z-index': '700',\n      });\n      return newDiv;\n      }\n\n\n      // check for already existing lnlt class to not duplicate\n      var lnlt = $(el).find('.lnlt');\n\n      if(!lnlt.length) {\n      lnlt = addElement();\n\n      // grab the special div we generated in the beginning\n      // and put the mousmove output there\n\n      map.on('mousemove', function (e) {\n      if (e.originalEvent.ctrlKey) {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                           ' lon: ' + (e.latlng.lng).toFixed(5) +\n                           ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                           ' | zoom: ' + map.getZoom() +\n                           ' | x: ' + L.CRS.EPSG3857.project(e.latlng).x.toFixed(0) +\n                           ' | y: ' + L.CRS.EPSG3857.project(e.latlng).y.toFixed(0) +\n                           ' | epsg: 3857 ' +\n                           ' | proj4: +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs ');\n      } else {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                      ' lon: ' + (e.latlng.lng).toFixed(5) +\n                      ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                      ' | zoom: ' + map.getZoom() + ' ');\n      }\n      });\n\n      // remove the lnlt div when mouse leaves map\n      map.on('mouseout', function (e) {\n      var strip = document.querySelector('.lnlt');\n      if( strip !==null) strip.remove();\n      });\n\n      };\n\n      //$(el).keypress(67, function(e) {\n      map.on('preclick', function(e) {\n      if (e.originalEvent.ctrlKey) {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                      ' lon: ' + (e.latlng.lng).toFixed(5) +\n                      ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                      ' | zoom: ' + map.getZoom() + ' ');\n      var txt = document.querySelector('.lnlt').textContent;\n      console.log(txt);\n      //txt.innerText.focus();\n      //txt.select();\n      setClipboardText('\"' + txt + '\"');\n      }\n      });\n\n      }\n      ).call(this.getMap(), el, x, data);\n}","data":null},{"code":"function(el, x, data) {\n  return (function(el,x,data){\n           var map = this;\n\n           map.on('keypress', function(e) {\n               console.log(e.originalEvent.code);\n               var key = e.originalEvent.code;\n               if (key === 'KeyE') {\n                   var bb = this.getBounds();\n                   var txt = JSON.stringify(bb);\n                   console.log(txt);\n\n                   setClipboardText('\\'' + txt + '\\'');\n               }\n           })\n        }).call(this.getMap(), el, x, data);\n}","data":null}]}}</script>
<p><br></p>
<p>Grâce à l’étape précédente, nous pouvons facilement avoir accès à l’heure correspondant au dernier point de cette section du trajet.</p>
<div class="sourceCode" id="cb1262"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1262-1"><a href="lecon_spatiotemp.html#cb1262-1" aria-hidden="true" tabindex="-1"></a>traj_long_pts<span class="sc">$</span>temps[<span class="dv">2000</span>]</span></code></pre></div>
<pre class="codeout"><code>[1] &quot;2013-07-30 12:25:22 EDT&quot;</code></pre>
<p><br></p>
<p>Avec la fonction <code>st_length()</code> de la bibliothèque <code>sf</code> nous pouvons connaître la distance parcourue pour cette section du trajet :</p>
<div class="sourceCode" id="cb1264"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1264-1"><a href="lecon_spatiotemp.html#cb1264-1" aria-hidden="true" tabindex="-1"></a><span class="fu">st_length</span>(lin)</span></code></pre></div>
<pre class="codeout"><code>7866 [m]</code></pre>
<p><br></p>
<p>Visualisons maintenant cette section du trajet en utilisant la bibliothèque <code>tmap</code>. Dans le titre de la carte, indiquons la distance parcourue ainsi que le temps associé. Des objets de classe caractère peuvent être combinés (c’est-à-dire écrits l’un à la suite des autres sans espacement) en utilisant la fonction <code>R</code> <code>paste0()</code>.</p>
<div class="sourceCode" id="cb1266"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1266-1"><a href="lecon_spatiotemp.html#cb1266-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tmap)</span>
<span id="cb1266-2"><a href="lecon_spatiotemp.html#cb1266-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(lin, <span class="at">bbox =</span> <span class="fu">st_bbox</span>(traj_long_pts)) <span class="sc">+</span> </span>
<span id="cb1266-3"><a href="lecon_spatiotemp.html#cb1266-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_lines</span>(<span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">&quot;#62852eaa&quot;</span>) <span class="sc">+</span> </span>
<span id="cb1266-4"><a href="lecon_spatiotemp.html#cb1266-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">main.title =</span> <span class="fu">paste0</span>(</span>
<span id="cb1266-5"><a href="lecon_spatiotemp.html#cb1266-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;temps: &quot;</span>,</span>
<span id="cb1266-6"><a href="lecon_spatiotemp.html#cb1266-6" aria-hidden="true" tabindex="-1"></a>    traj_long_pts<span class="sc">$</span>temps[<span class="dv">2000</span>], </span>
<span id="cb1266-7"><a href="lecon_spatiotemp.html#cb1266-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot; / distance&quot;</span>, <span class="fu">st_length</span>(lin)</span>
<span id="cb1266-8"><a href="lecon_spatiotemp.html#cb1266-8" aria-hidden="true" tabindex="-1"></a>  ),  <span class="at">main.title.size =</span> <span class="fl">0.9</span>)</span></code></pre></div>
<p><img src="Cours_SpatialR_files/figure-html/simple_map-1.png" width="720" style="display: block; margin: auto;" />
<br></p>
<p>Pour obtenir une animation pour la totalité du trajet <code>traj_long</code>, nous devons alors faire cette même carte pour un nombre croissant de points et combiner toutes ces cartes en un seul fichier GIF. Puisque le trajet total compte 10818 points, cette tâche est répétitive.</p>
<p>Dans ce qui suit nous allons structurer notre code avec quelques fonctions. Cela nous permet d’isoler les différentes étapes à réaliser et d’éviter de répétées du code. De manière générales, structurer son code en différentes fonctions permet d’augmenter la clarté du code et de diminuer les erreurs qui arrivent rapidement quand le code se complexifie.</p>
<p>Nous devons donc prendre un peu de temps pour expliquer comment créer une fonction. Jusqu’ici nous avons utilisé de nombreuses fonctions déjà définies dans <code>R</code> ou dans les bibliothèques employées sans que nous n’ayons eu besoin de créer nos propres fonctions. Pour comprendre comment est structurée une fonction, nous allons détailler un exemple simple.</p>
<div class="sourceCode" id="cb1267"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1267-1"><a href="lecon_spatiotemp.html#cb1267-1" aria-hidden="true" tabindex="-1"></a>ma_fonction <span class="ot">&lt;-</span> <span class="cf">function</span>(a, <span class="at">b =</span> <span class="dv">1</span>) {</span>
<span id="cb1267-2"><a href="lecon_spatiotemp.html#cb1267-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (b <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb1267-3"><a href="lecon_spatiotemp.html#cb1267-3" aria-hidden="true" tabindex="-1"></a>    c <span class="ot">&lt;-</span> a <span class="sc">+</span> b</span>
<span id="cb1267-4"><a href="lecon_spatiotemp.html#cb1267-4" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb1267-5"><a href="lecon_spatiotemp.html#cb1267-5" aria-hidden="true" tabindex="-1"></a>    c <span class="ot">&lt;-</span> a <span class="sc">-</span> <span class="dv">2</span><span class="sc">*</span>b</span>
<span id="cb1267-6"><a href="lecon_spatiotemp.html#cb1267-6" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1267-7"><a href="lecon_spatiotemp.html#cb1267-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(c) <span class="co"># ou simplement c</span></span>
<span id="cb1267-8"><a href="lecon_spatiotemp.html#cb1267-8" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><br></p>
<p>Dans <code>R</code>, une fonction est un objet créé avec <code>function()</code>. Comme tout objet nous pouvons l’assigner à une variable et dans notre exemple, nous l’assignons à <code>ma_fonction</code> qui sera le nom de la fonction. Dans la parenthèse qui suit <code>function</code>, nous écrivons les arguments de la fonction, en l’occurrence pour <code>ma_fonction</code>, nous avons <code>a</code> et <code>b</code>. Dans notre exemple, <code>b</code> a une valeur par défaut qui est 1, donc si nous ne spécifions pas <code>b</code>, alors <code>b</code> aura automatiquement une valeur de 1.</p>
<p>Le corps de la fonction est l’expression juste après cette parenthèse, dans notre cas cela inclut tout ce qui est entre accolades (<code>{ }</code>). Une fonction peut comprendre autant de ligne de code que souhaité et peut contenir n’importe quelle expression <code>R</code> valide. À titre d’exemple, nous avons utilisé un test logique <code>if</code>/<code>else</code> pour que la valeur retournée <code>c</code> change selon les valeurs de <code>b</code>.</p>
<p>Avec <code>R</code>, une fonction retourne la dernière ligne de code (l’utilisation de <code>return()</code> à la dernière ligne est ainsi optionnelle, mais elle permet de clarifier ce que retourne la fonction). Une fois la fonction créée, nous l’appelons comme toute autre fonction.</p>
<div class="sourceCode" id="cb1268"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1268-1"><a href="lecon_spatiotemp.html#cb1268-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ma_fonction</span>(<span class="dv">1</span>) <span class="co"># utlise b = 1</span></span></code></pre></div>
<pre class="codeout"><code>[1] 2</code></pre>
<div class="sourceCode" id="cb1270"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1270-1"><a href="lecon_spatiotemp.html#cb1270-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ma_fonction</span>(<span class="dv">1</span>, <span class="dv">2</span>)</span></code></pre></div>
<pre class="codeout"><code>[1] 3</code></pre>
<div class="sourceCode" id="cb1272"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1272-1"><a href="lecon_spatiotemp.html#cb1272-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ma_fonction</span>(<span class="dv">1</span>, <span class="sc">-</span><span class="dv">2</span>)</span></code></pre></div>
<pre class="codeout"><code>[1] 5</code></pre>
<p><br></p>
<p>Nous sommes maintenant outillés pour créer différentes fonctions pour structurer notre code. Notre fonction principale, <code>visual()</code>, a pour argument les points du trajet, <code>traj_pts</code>, et le nombre de points à combiner, que nous appellerons <code>n</code>. Cette fonction reprend les étapes précédentes.</p>
<div class="sourceCode" id="cb1274"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1274-1"><a href="lecon_spatiotemp.html#cb1274-1" aria-hidden="true" tabindex="-1"></a>visual <span class="ot">&lt;-</span> <span class="cf">function</span>(traj_pts, <span class="at">n =</span> <span class="dv">100</span>) {</span>
<span id="cb1274-2"><a href="lecon_spatiotemp.html#cb1274-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1274-3"><a href="lecon_spatiotemp.html#cb1274-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># extraction des n premiers points</span></span>
<span id="cb1274-4"><a href="lecon_spatiotemp.html#cb1274-4" aria-hidden="true" tabindex="-1"></a>  pts <span class="ot">&lt;-</span> traj_pts[<span class="dv">1</span><span class="sc">:</span>n, ] </span>
<span id="cb1274-5"><a href="lecon_spatiotemp.html#cb1274-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1274-6"><a href="lecon_spatiotemp.html#cb1274-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># conversion des points en ligne</span></span>
<span id="cb1274-7"><a href="lecon_spatiotemp.html#cb1274-7" aria-hidden="true" tabindex="-1"></a>  lin <span class="ot">&lt;-</span> <span class="fu">st_cast</span>(<span class="fu">st_combine</span>(pts), <span class="st">&quot;LINESTRING&quot;</span>)</span>
<span id="cb1274-8"><a href="lecon_spatiotemp.html#cb1274-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1274-9"><a href="lecon_spatiotemp.html#cb1274-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># carte de la ligne</span></span>
<span id="cb1274-10"><a href="lecon_spatiotemp.html#cb1274-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(lin, <span class="at">bbox =</span> <span class="fu">st_bbox</span>(traj_long_pts)) <span class="sc">+</span> </span>
<span id="cb1274-11"><a href="lecon_spatiotemp.html#cb1274-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tm_lines</span>(<span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">&quot;#62852eaa&quot;</span>) <span class="sc">+</span> </span>
<span id="cb1274-12"><a href="lecon_spatiotemp.html#cb1274-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tm_layout</span>(<span class="at">main.title =</span> <span class="fu">paste0</span>(</span>
<span id="cb1274-13"><a href="lecon_spatiotemp.html#cb1274-13" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;temps: &quot;</span>,</span>
<span id="cb1274-14"><a href="lecon_spatiotemp.html#cb1274-14" aria-hidden="true" tabindex="-1"></a>      traj_long_pts<span class="sc">$</span>temps[n], </span>
<span id="cb1274-15"><a href="lecon_spatiotemp.html#cb1274-15" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot; / distance&quot;</span>, <span class="fu">st_length</span>(lin)</span>
<span id="cb1274-16"><a href="lecon_spatiotemp.html#cb1274-16" aria-hidden="true" tabindex="-1"></a>    ), <span class="at">main.title.size =</span> <span class="fl">0.9</span>)</span>
<span id="cb1274-17"><a href="lecon_spatiotemp.html#cb1274-17" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><br></p>
<p>Nous allons faire quelques améliorations sur le texte accompagnant les cartes en créant deux autres fonctions. La première, <code>txt_temps()</code>, a pour argument un temps (nous utiliserons le temps du point <code>n</code>) et retourne un texte formaté grâce aux fonctionnalités de la bibliothèque <code>lubridate</code>.</p>
<div class="sourceCode" id="cb1275"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1275-1"><a href="lecon_spatiotemp.html#cb1275-1" aria-hidden="true" tabindex="-1"></a>txt_temps <span class="ot">&lt;-</span> <span class="cf">function</span>(temps) {</span>
<span id="cb1275-2"><a href="lecon_spatiotemp.html#cb1275-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste0</span>(<span class="fu">hour</span>(temps), <span class="st">&quot;h &quot;</span>, <span class="fu">minute</span>(temps), <span class="st">&quot;m &quot;</span>, <span class="fu">floor</span>(<span class="fu">second</span>(temps)), <span class="st">&quot;s&quot;</span>)</span>
<span id="cb1275-3"><a href="lecon_spatiotemp.html#cb1275-3" aria-hidden="true" tabindex="-1"></a>} </span></code></pre></div>
<p><br></p>
<p>La seconde, <code>txt_distance()</code>, prend pour argument une ligne et retourne un texte formaté comprenant la distance en kilomètre.</p>
<div class="sourceCode" id="cb1276"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1276-1"><a href="lecon_spatiotemp.html#cb1276-1" aria-hidden="true" tabindex="-1"></a>txt_distance <span class="ot">&lt;-</span> <span class="cf">function</span>(lin) {</span>
<span id="cb1276-2"><a href="lecon_spatiotemp.html#cb1276-2" aria-hidden="true" tabindex="-1"></a>  len <span class="ot">&lt;-</span> <span class="fu">st_length</span>(lin)</span>
<span id="cb1276-3"><a href="lecon_spatiotemp.html#cb1276-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste0</span>(<span class="st">&quot;Distance parcourue: &quot;</span>, <span class="fu">format</span>(<span class="fu">as.numeric</span>(len)<span class="sc">/</span><span class="dv">1000</span>, <span class="at">digits =</span> <span class="dv">4</span>), <span class="st">&quot;km&quot;</span>)</span>
<span id="cb1276-4"><a href="lecon_spatiotemp.html#cb1276-4" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><br></p>
<p>Notons que la fonction <code>R</code> <code>format()</code> nous permet de contrôler le nombre de chiffres (<code>digits</code>) affiché. Nous allons reformuler notre fonction <code>visual()</code> pour qu’elle appelle ces deux fonctions.</p>
<p>De plus, nous y ajoutons un argument, <code>basemap</code>, de la bibliothèque <code>tmap</code>, qui nous permet d’ajouter un fond de carte. Cet argument a pour valeur <code>NULL</code> par défaut, ce qui nous permet d’avoir, par défaut, une carte sans fond.</p>
<p>Enfin, nous allons nous assurer que le nombre <code>n</code> de points à combiner soit supérieur à 1 car nous avons besoin d’un minimum de 2 points pour créer une ligne. Cette condition est assurée par la fonction <code>R</code> <code>stopifnot()</code>.</p>
<div class="sourceCode" id="cb1277"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1277-1"><a href="lecon_spatiotemp.html#cb1277-1" aria-hidden="true" tabindex="-1"></a>visual <span class="ot">&lt;-</span> <span class="cf">function</span>(traj_pts, <span class="at">n =</span> <span class="dv">100</span>, <span class="at">basemap =</span> <span class="cn">NULL</span>) {</span>
<span id="cb1277-2"><a href="lecon_spatiotemp.html#cb1277-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stopifnot</span>(n <span class="sc">&gt;</span> <span class="dv">1</span>)</span>
<span id="cb1277-3"><a href="lecon_spatiotemp.html#cb1277-3" aria-hidden="true" tabindex="-1"></a>  tps <span class="ot">&lt;-</span> traj_pts<span class="sc">$</span>temps[n]</span>
<span id="cb1277-4"><a href="lecon_spatiotemp.html#cb1277-4" aria-hidden="true" tabindex="-1"></a>  pts <span class="ot">&lt;-</span> traj_pts[<span class="dv">1</span><span class="sc">:</span>n, drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb1277-5"><a href="lecon_spatiotemp.html#cb1277-5" aria-hidden="true" tabindex="-1"></a>  lin <span class="ot">&lt;-</span> <span class="fu">st_cast</span>(<span class="fu">st_combine</span>(pts), <span class="st">&quot;LINESTRING&quot;</span>)</span>
<span id="cb1277-6"><a href="lecon_spatiotemp.html#cb1277-6" aria-hidden="true" tabindex="-1"></a>  basemap <span class="sc">+</span> </span>
<span id="cb1277-7"><a href="lecon_spatiotemp.html#cb1277-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(lin, <span class="at">bbox =</span> <span class="fu">st_bbox</span>(traj_long_pts)) <span class="sc">+</span> </span>
<span id="cb1277-8"><a href="lecon_spatiotemp.html#cb1277-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tm_lines</span>(<span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">&quot;#62852eaa&quot;</span>) <span class="sc">+</span></span>
<span id="cb1277-9"><a href="lecon_spatiotemp.html#cb1277-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tm_layout</span>(<span class="at">main.title =</span> <span class="fu">paste0</span>(<span class="fu">txt_temps</span>(tps), <span class="st">&quot;  -  &quot;</span>, <span class="fu">txt_distance</span>(lin)), </span>
<span id="cb1277-10"><a href="lecon_spatiotemp.html#cb1277-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">main.title.size =</span> <span class="fl">0.9</span>)</span>
<span id="cb1277-11"><a href="lecon_spatiotemp.html#cb1277-11" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><br></p>
<p>Nous pouvons maintenant faire la carte pour le nombre de points désirés, avec un minimum de 2 et un maximum de 10818 points. Pour faire la figure précédente nous utilisons le code suivant :</p>
<div class="sourceCode" id="cb1278"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1278-1"><a href="lecon_spatiotemp.html#cb1278-1" aria-hidden="true" tabindex="-1"></a><span class="fu">visual</span>(traj_long_pts, <span class="dv">2000</span>)</span></code></pre></div>
<p><img src="Cours_SpatialR_files/figure-html/unnamed-chunk-505-1.png" width="720" style="display: block; margin: auto;" />
<br></p>
<p>L’avantage du travail précédent est que nous pouvons maintenant très facilement faire la même carte en appelant notre fonction et en changeant simplement la valeur de <code>n</code>, par exemple, nous pouvons faire la même carte avec les 4000 premiers points.</p>
<div class="sourceCode" id="cb1279"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1279-1"><a href="lecon_spatiotemp.html#cb1279-1" aria-hidden="true" tabindex="-1"></a><span class="fu">visual</span>(traj_long_pts, <span class="dv">4000</span>)</span></code></pre></div>
<p><img src="Cours_SpatialR_files/figure-html/unnamed-chunk-506-1.png" width="720" style="display: block; margin: auto;" />
<br></p>
</div>
<div id="créer-une-animation" class="section level6 unnumbered hasAnchor">
<h6>4. Créer une animation<a href="lecon_spatiotemp.html#créer-une-animation" class="anchor-section" aria-label="Anchor link to header"></a></h6>
<p>Nous allons maintenant créer une nouvelle fonction, <code>anim()</code>, qui nous permettra de générer une série de <code>n_img</code> images de notre trajet en appelant notre fonction <code>visual()</code> créée à l’étape précédente.</p>
<div class="sourceCode" id="cb1280"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1280-1"><a href="lecon_spatiotemp.html#cb1280-1" aria-hidden="true" tabindex="-1"></a>anim <span class="ot">&lt;-</span> <span class="cf">function</span>(traj_pts, n_img, <span class="at">basemap =</span> <span class="cn">NULL</span>) {</span>
<span id="cb1280-2"><a href="lecon_spatiotemp.html#cb1280-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">floor</span>(<span class="fu">seq</span>(<span class="dv">2</span>, <span class="fu">nrow</span>(traj_pts), <span class="at">length.out =</span> n_img))) {</span>
<span id="cb1280-3"><a href="lecon_spatiotemp.html#cb1280-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(<span class="fu">visual</span>(traj_pts, i, basemap))</span>
<span id="cb1280-4"><a href="lecon_spatiotemp.html#cb1280-4" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1280-5"><a href="lecon_spatiotemp.html#cb1280-5" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><br></p>
<p>Quelques remarques:</p>
<ol style="list-style-type: lower-roman">
<li><p>La fonction <code>for()</code> constitue ce qu’on appelle une <strong>boucle</strong> en programmation informatique. La boucle vient répéter une action, donnée par les lignes de codes entre les accolades <code>{ }</code>, pour chaque élément contenu dans une séquence.</p></li>
<li><p>Nous utilisons <code>seq()</code> pour générer une séquence de <code>n_img</code> images entre 2 et le maximum de points (10818).</p></li>
<li><p>La séquence peut générer des nombres décimaux, mais <code>visual()</code> demande des nombre entiers, nous utilisons alors <code>floor()</code> pour la conversion.</p></li>
<li><p>Nous reprenons l’argument <code>basemap</code> pour qu’il puisse être passé à <code>visual()</code>.</p></li>
</ol>
<p><br></p>
<p>Observons, par exemple, la succession de cartes créées par la fonction <code>anim()</code> lorsque <code>n_img = 5</code> :
<!-- Moyen de ne pas les afficher une a la suite des autres?? c<est laid sur la page web  --></p>
<div class="sourceCode" id="cb1281"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1281-1"><a href="lecon_spatiotemp.html#cb1281-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anim</span>(traj_long_pts, <span class="at">n_img =</span> <span class="dv">5</span>, <span class="cn">NULL</span>)</span></code></pre></div>
<p><img src="Cours_SpatialR_files/figure-html/unnamed-chunk-508-1.svg" width="720" style="display: block; margin: auto;" /><img src="Cours_SpatialR_files/figure-html/unnamed-chunk-508-2.svg" width="720" style="display: block; margin: auto;" /><img src="Cours_SpatialR_files/figure-html/unnamed-chunk-508-3.svg" width="720" style="display: block; margin: auto;" /><img src="Cours_SpatialR_files/figure-html/unnamed-chunk-508-4.svg" width="720" style="display: block; margin: auto;" /><img src="Cours_SpatialR_files/figure-html/unnamed-chunk-508-5.svg" width="720" style="display: block; margin: auto;" /></p>
<p><br></p>
<p>Une fois l’animation créée, pour un nombre d’images donné, nous voulons la sauvegarder en format GIF. Pour générer un fichier GIF, nous utilisons la fonction <code>saveGIF()</code> de la bibliothèque <code>animation</code>. Cette fonction prend en premier argument une expression (du code <code>R</code>) qui permet de générer une série de figures qui seront ensuite combinées en GIF.</p>
<!-- Ajouter icone biblio  -->
<p>Installons la bibliothèque <code>animation</code>.</p>
<div class="sourceCode" id="cb1282"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1282-1"><a href="lecon_spatiotemp.html#cb1282-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;animation&quot;</span>)</span></code></pre></div>
<p><br></p>
<p>Nous pouvons maintenant utiliser <code>saveGIF()</code>.
<!--
```R
library(animation)
saveGIF(anim(traj_long_pts, 20, NULL), movie.name = "anim1.gif", ani.height = 500, ani.width = 500)
```
--></p>
<div class="sourceCode" id="cb1283"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1283-1"><a href="lecon_spatiotemp.html#cb1283-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(animation)</span>
<span id="cb1283-2"><a href="lecon_spatiotemp.html#cb1283-2" aria-hidden="true" tabindex="-1"></a><span class="fu">saveGIF</span>(<span class="fu">anim</span>(traj_long_pts, <span class="dv">20</span>, <span class="cn">NULL</span>), <span class="at">movie.name =</span> <span class="st">&quot;anim1.gif&quot;</span>, <span class="at">ani.height =</span> <span class="dv">500</span>, <span class="at">ani.width =</span> <span class="dv">500</span>)</span></code></pre></div>
<!-- ![](Module9/images/anim1.gif)-->
<p><img src="Module9/images/anim1.gif" style="display: block; margin: auto;" /></p>
<p><br></p>
<p>Pour finir, nous allons ajouter un fond de carte. Pour cela nous allons télécharger un fond de carte de <a href="https://www.openstreetmap.org">OpenStreetMap</a> grâce à fonction <code>osm.raster()</code> de la bibliothèque <a href="https://CRAN.R-project.org/package=rosm"><code>rosm</code></a>.</p>
<p>Installons la bibliothèque <code>rosm</code>.</p>
<div class="sourceCode" id="cb1284"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1284-1"><a href="lecon_spatiotemp.html#cb1284-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;rosm&quot;</span>)</span></code></pre></div>
<p><br></p>
<p>La fonction <code>osm.raster()</code> s’utilise avec la library <code>raster</code>. Nous devons donc charger également cette library dans notre session de travail <code>R</code>. Nous devons aussi spécifier à la fonction <code>osm.raster()</code> l’étendue de la carte de fond désirée.</p>
<div class="sourceCode" id="cb1285"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1285-1"><a href="lecon_spatiotemp.html#cb1285-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(raster)</span>
<span id="cb1285-2"><a href="lecon_spatiotemp.html#cb1285-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rosm)</span>
<span id="cb1285-3"><a href="lecon_spatiotemp.html#cb1285-3" aria-hidden="true" tabindex="-1"></a>carte_fond <span class="ot">&lt;-</span> <span class="fu">osm.raster</span>(<span class="fu">extent</span>(traj_long_pts), <span class="at">crop =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1285-4"><a href="lecon_spatiotemp.html#cb1285-4" aria-hidden="true" tabindex="-1"></a>carte_fond</span></code></pre></div>
<!--   

```r
library(raster)
library(rosm)
carte_fond <- osm.raster(extent(traj_long_pts), crop = TRUE)
carte_fond
```

```{.codeout}
class      : RasterBrick 
dimensions : 950, 890, 845500, 3  (nrow, ncol, ncell, nlayers)
resolution : 19.1, 19.1  (x, y)
extent     : -8203719, -8186720, 5688396, 5706541  (xmin, xmax, ymin, ymax)
crs        : +proj=merc +a=6378137 +b=6378137 +lat_ts=0 +lon_0=0 +x_0=0 +y_0=0 +k=1 +units=m +nadgrids=@null +wktext +no_defs 
source     : memory
names      : layer.1, layer.2, layer.3 
min values :   37.16,   22.43,   22.43 
max values :     255,     255,     255 
```
-->
<p><br></p>
<p>Visualisons cette carte de fond avec les fonctionnalités de la library <code>tmap</code>:</p>
<div class="sourceCode" id="cb1286"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1286-1"><a href="lecon_spatiotemp.html#cb1286-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(carte_fond) <span class="sc">+</span> <span class="fu">tm_rgb</span>()</span></code></pre></div>
<p><img src="Cours_SpatialR_files/figure-html/unnamed-chunk-513-1.png" width="720" style="display: block; margin: auto;" />
<br></p>
<p>Maintenant, répétons notre animation en remplaçant la valeur <code>NULL</code> de l’argument <code>basemap</code> par la carte de fond.
<!--
```R
saveGIF(anim(traj_long_pts, 20, tm_shape(carte_fond) + tm_rgb()), 
   movie.name = "anim2.gif", ani.height = 500, ani.width = 500)

```
--></p>
<div class="sourceCode" id="cb1287"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1287-1"><a href="lecon_spatiotemp.html#cb1287-1" aria-hidden="true" tabindex="-1"></a><span class="fu">saveGIF</span>(<span class="fu">anim</span>(traj_long_pts, <span class="dv">20</span>, <span class="fu">tm_shape</span>(carte_fond) <span class="sc">+</span> <span class="fu">tm_rgb</span>()), </span>
<span id="cb1287-2"><a href="lecon_spatiotemp.html#cb1287-2" aria-hidden="true" tabindex="-1"></a>   <span class="at">movie.name =</span> <span class="st">&quot;anim2.gif&quot;</span>, <span class="at">ani.height =</span> <span class="dv">500</span>, <span class="at">ani.width =</span> <span class="dv">500</span>)</span></code></pre></div>
<!--![](Module9/images/anim2.gif)-->
<p><img src="Module9/images/anim2.gif" style="display: block; margin: auto;" /></p>
<p><br></p>
</div>
</div>
</div>
<div id="données-spatiotemporelles-matricielles" class="section level3 hasAnchor" number="9.1.3">
<h3><span class="header-section-number">9.1.3</span> Données spatiotemporelles matricielles<a href="lecon_spatiotemp.html#données-spatiotemporelles-matricielles" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Dans cette deuxième partie de la leçon, nous allons manipuler le temps et l’espace dans un ensemble de données matricielles. Plus précisément, nous nous intéresserons aux précipitations et aux températures moyennes autour du Parc national du Mont-Mégantic entre 2007 et 2016. Nous chercherons à répondre aux deux questions suivantes :</p>
<blockquote>
<p><strong>Quel mois dispose du plus faible niveau de pluviométrie dans la région du Parc national du Mont-Mégantic?</strong></p>
</blockquote>
<blockquote>
<p><strong>Où se situe le (ou les) point(s) le(s) plus chaud(s) dans la région du Parc national du Mont-Mégantic? </strong></p>
</blockquote>
<p><br></p>
<p>De plus, nous terminerons cette partie par la réalisation de deux exercices de visualisation de données :</p>
<blockquote>
<p><strong>Nous dessinerons les profils de températures et de précipitations pour la période étudiée.</strong></p>
</blockquote>
<blockquote>
<p><strong>Nous animerons ces profils en ajoutant une carte, elle aussi animée.</strong></p>
</blockquote>
<p><br></p>
<p>Pour pouvoir répondre à ces questions et réaliser ces exercices, nous utiliserons différents <em>rasters</em> qui seront manipulés sous forme d’objets <code>rasterStack</code> (mentionnés au <a href="mat.html#mat">Module 5</a>).</p>
<p><br></p>
<div id="importer-les-données-2" class="section level4 hasAnchor" number="9.1.3.1">
<h4><span class="header-section-number">9.1.3.1</span> Importer les données<a href="lecon_spatiotemp.html#importer-les-données-2" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Les données que nous allons utiliser dans cette partie ont été préparées à partir de données climatiques historiques à haute résolution pour l’Amérique du Nord <span class="citation">(<a href="ressources.html#ref-macdonald_north_2020" role="doc-biblioref">MacDonald et al. 2020</a>)</span>. Ces données (issues d’un travail de modélisation) sont disponibles sur l’espace dédié à l’archivage de données du Centre allemand de calcul pour le climat, <a href="https://cera-www.dkrz.de/WDCC/ui/cerasearch/project?acronym=CanClim">DKRZ</a> (pour y accéder, il faut d’abord s’enregistrer sur le site). Les données sont disponibles dans le répertoire <code>Module9_donnees</code> et elles incluent, pour l’ensemble de l’Amérique du Nord et pour chaque mois de 1901 à 2016, les trois variables suivantes:</p>
<ul>
<li>la température minimale moyenne (<code>mint.nc</code>),</li>
<li>la température maximale moyenne (<code>maxt.nc</code>),<br />
</li>
<li>les précipitations cumulées (<code>pcp.nc</code>),</li>
</ul>
<p>et ce, à une résolution de 60 arc-secondes.</p>
<p><br></p>
<div class="figure" style="text-align: left"><span style="display:block;" id="fig:exdataclim"></span>
<img src="Module9/images/mmint_janv_2000.png" alt="Température minimale moyenne au mois de janvier 2000." width="80%" />
<p class="caption">
FIGURE 9.1: Température minimale moyenne au mois de janvier 2000.
</p>
</div>
<p><br></p>
<!--  Je ne comprends pas qu'il soit question des années 2007-2016 si on présente les températures minimales moyennes pour janvier 2000 -->
<p>Par exemple, sur la figure <a href="lecon_spatiotemp.html#fig:exdataclim">9.1</a>, nous présentons les températures minimales moyennes pour le mois de janvier 2000.
<!-- Pour l'exercice présente --></p>
<p>À partir des données brutes, nous avons sélectionné les données correspondantes aux années 2007 à 2016, puis nous avons fait une opération de rognage en utilisant l’étendue spatiale suivante (dans le système géodésique mondial WGS84):</p>
<ul>
<li>longitude : de 72°Ouest à 71°Ouest,</li>
<li>latitude : de 45°Nord à 46°Nord.</li>
</ul>
<p>Les données préparées sont en format <a href="https://fr.wikipedia.org/wiki/NetCDF">NetCDF (Network Common Data Form)</a>. Ces données peuvent être importées en utilisant la fonction <code>stack()</code> de la bibliothèque <code>raster</code> mais nécessitent l’utilisation de la bibliothèque <code>ncdf4</code>.</p>
<p>Commençons par installer cette bibliothèque :
<!--  icone biblio?e --></p>
<div class="sourceCode" id="cb1288"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1288-1"><a href="lecon_spatiotemp.html#cb1288-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;ncdf4&quot;</span>)</span></code></pre></div>
<p><br></p>
<!--  Ici ajouter false -->
<!-- requireNamespace("ncdf4")-->
<!--

-->
<p>Puis, chargeons les bibliothèques <code>raster</code> et <code>ncdf4</code> et importons les données en utilisant la fonction <code>stack()</code> :</p>
<div class="sourceCode" id="cb1289"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1289-1"><a href="lecon_spatiotemp.html#cb1289-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(raster)</span>
<span id="cb1289-2"><a href="lecon_spatiotemp.html#cb1289-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ncdf4)</span>
<span id="cb1289-3"><a href="lecon_spatiotemp.html#cb1289-3" aria-hidden="true" tabindex="-1"></a><span class="co"># temperature minimale par mois pour</span></span>
<span id="cb1289-4"><a href="lecon_spatiotemp.html#cb1289-4" aria-hidden="true" tabindex="-1"></a>mint <span class="ot">&lt;-</span> <span class="fu">stack</span>(<span class="st">&quot;Module9/Module9_donnees/mint.nc&quot;</span>)</span>
<span id="cb1289-5"><a href="lecon_spatiotemp.html#cb1289-5" aria-hidden="true" tabindex="-1"></a><span class="co"># temperature maximale par mois </span></span>
<span id="cb1289-6"><a href="lecon_spatiotemp.html#cb1289-6" aria-hidden="true" tabindex="-1"></a>maxt <span class="ot">&lt;-</span> <span class="fu">stack</span>(<span class="st">&quot;Module9/Module9_donnees/maxt.nc&quot;</span>)</span>
<span id="cb1289-7"><a href="lecon_spatiotemp.html#cb1289-7" aria-hidden="true" tabindex="-1"></a><span class="co"># total des precipitations par mois </span></span>
<span id="cb1289-8"><a href="lecon_spatiotemp.html#cb1289-8" aria-hidden="true" tabindex="-1"></a>pcp <span class="ot">&lt;-</span> <span class="fu">stack</span>(<span class="st">&quot;Module9/Module9_donnees/pcp.nc&quot;</span>)</span>
<span id="cb1289-9"><a href="lecon_spatiotemp.html#cb1289-9" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(mint)</span></code></pre></div>
<pre class="codeout"><code>[1] &quot;RasterStack&quot;
attr(,&quot;package&quot;)
[1] &quot;raster&quot;</code></pre>
<p><br></p>
<p>Il s’agit là d’objets de classe <code>rasterStack</code> que nous détaillons dans la section suivante.</p>
</div>
<div id="les-objets-rasterstack" class="section level4 hasAnchor" number="9.1.3.2">
<h4><span class="header-section-number">9.1.3.2</span> Les objets rasterStack<a href="lecon_spatiotemp.html#les-objets-rasterstack" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Pour cette section, nous nous concentrons sur l’objet <code>mint</code>, notons cependant que tout ce que nous voyons ici s’applique aux autres objets <code>rasterStack</code> que nous avons importés. Inspectons rapidement ce nouvel objet.</p>
<div class="sourceCode" id="cb1291"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1291-1"><a href="lecon_spatiotemp.html#cb1291-1" aria-hidden="true" tabindex="-1"></a>mint</span></code></pre></div>
<pre class="codeout"><code>class      : RasterStack 
dimensions : 60, 60, 3600, 120  (nrow, ncol, ncell, nlayers)
resolution : 0.01667, 0.01667  (x, y)
extent     : -71.99, -70.99, 45.01, 46.01  (xmin, xmax, ymin, ymax)
crs        : +proj=longlat +ellps=WGS84 +no_defs 
names      :    X1,    X2,    X3,    X4,    X5,    X6,    X7,    X8,    X9,   X10,   X11,   X12,   X13,   X14,   X15, ... 
min values : -16.2, -19.9, -12.8,  -4.5,   2.4,   8.2,   9.7,   9.2,   6.3,   2.7,  -7.1, -13.6, -13.9, -14.5, -13.9, ... 
max values : -13.9, -18.0,  -9.5,  -0.6,   5.5,  11.8,  13.0,  11.7,   8.7,   5.3,  -4.0, -10.6, -11.8, -12.7, -10.0, ... </code></pre>
<p><br></p>
<p>Nous obtenons des informations similaires à celles d’un objet de classe <code>rasterLayer</code>, cependant la ligne qui indique les dimensions possède un élément de plus indiquant le nombre de couches, et les valeurs affichées correspondent aux valeurs minimales et maximales pour chacune des différentes couches.</p>
<div id="extraire-les-informations-générales" class="section level5 unnumbered hasAnchor">
<h5>Extraire les informations générales<a href="lecon_spatiotemp.html#extraire-les-informations-générales" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>Un raster <code>rasterStack</code> est en fait une collection de<code>rasterLayer</code> qui
ont la même projection spatiale, la même résolution, la même étendue
spatiale et donc le même nombre de cellules. Pour obtenir ces informations individuellement, nous utilisons les mêmes fonctions que pour les <code>rasterLayer</code>.</p>
<div class="sourceCode" id="cb1293"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1293-1"><a href="lecon_spatiotemp.html#cb1293-1" aria-hidden="true" tabindex="-1"></a><span class="fu">extent</span>(mint)</span></code></pre></div>
<pre class="codeout"><code>class      : Extent 
xmin       : -71.99 
xmax       : -70.99 
ymin       : 45.01 
ymax       : 46.01 </code></pre>
<div class="sourceCode" id="cb1295"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1295-1"><a href="lecon_spatiotemp.html#cb1295-1" aria-hidden="true" tabindex="-1"></a><span class="fu">projection</span>(mint)</span></code></pre></div>
<pre class="codeout"><code>[1] &quot;+proj=longlat +ellps=WGS84 +no_defs&quot;</code></pre>
<div class="sourceCode" id="cb1297"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1297-1"><a href="lecon_spatiotemp.html#cb1297-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ncell</span>(mint)</span></code></pre></div>
<pre class="codeout"><code>[1] 3600</code></pre>
<p><br></p>
<p>Les dimensions du <code>rasterStack</code> peuvent être aussi être affichées avec la fonction <code>dim()</code></p>
<div class="sourceCode" id="cb1299"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1299-1"><a href="lecon_spatiotemp.html#cb1299-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(mint)</span></code></pre></div>
<pre class="codeout"><code>[1]  60  60 120</code></pre>
<p><br></p>
<p>Comme nous pouvons le constater, 3 nombres sont retournés, un de plus que pour les objets <code>rasterLayer</code>, le dernier chiffre est le nombre de couches que nous avons mentionné plus haut, ici 120. Ce nombre peut aussi être affiché en utilisant la fonction <code>nlayers()</code>.</p>
<!-- mint[[1]] changer pour mint   -->
<div class="sourceCode" id="cb1301"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1301-1"><a href="lecon_spatiotemp.html#cb1301-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nlayers</span>(mint)</span></code></pre></div>
<pre class="codeout"><code>[1] 120</code></pre>
<p><br></p>
<p>L’objet <code>mint</code> est une donc collection de 120 objets de classe <code>rasterLayer</code>, chaque couche représente des valeurs de températures minimales moyennes sur toutes la zone pour un mois donné. Ici, les couches sont ordonnées dans le temps (elles ont été combinées ainsi) et nous avons 1 couche par mois sur 10 ans.</p>
</div>
<div id="extraire-une-selection-de-couches" class="section level5 unnumbered hasAnchor">
<h5>Extraire une selection de couches<a href="lecon_spatiotemp.html#extraire-une-selection-de-couches" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>Il est possible d’accéder à n’importe quelle couche (<code>rasterLayer</code>) en utilisant <code>[[</code>:</p>
<div class="sourceCode" id="cb1303"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1303-1"><a href="lecon_spatiotemp.html#cb1303-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(mint[[<span class="dv">1</span>]])</span></code></pre></div>
<pre class="codeout"><code>[1] &quot;RasterLayer&quot;
attr(,&quot;package&quot;)
[1] &quot;raster&quot;</code></pre>
<div class="sourceCode" id="cb1305"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1305-1"><a href="lecon_spatiotemp.html#cb1305-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Raster de Température minimale du mois de janvier de la première année (2007)</span></span>
<span id="cb1305-2"><a href="lecon_spatiotemp.html#cb1305-2" aria-hidden="true" tabindex="-1"></a>mint[[<span class="dv">1</span>]]</span></code></pre></div>
<pre class="codeout"><code>class      : RasterLayer 
band       : 1  (of  120  bands)
dimensions : 60, 60, 3600  (nrow, ncol, ncell)
resolution : 0.01667, 0.01667  (x, y)
extent     : -71.99, -70.99, 45.01, 46.01  (xmin, xmax, ymin, ymax)
crs        : +proj=longlat +ellps=WGS84 +no_defs 
source     : mint.nc 
names      : X1 
values     : -16.2, -13.9  (min, max)
zvar       : variable </code></pre>
<div class="sourceCode" id="cb1307"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1307-1"><a href="lecon_spatiotemp.html#cb1307-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Raster de Température minimale du mois de décembre de la dernière année (2016)</span></span>
<span id="cb1307-2"><a href="lecon_spatiotemp.html#cb1307-2" aria-hidden="true" tabindex="-1"></a>mint[[<span class="dv">120</span>]]</span></code></pre></div>
<pre class="codeout"><code>class      : RasterLayer 
band       : 120  (of  120  bands)
dimensions : 60, 60, 3600  (nrow, ncol, ncell)
resolution : 0.01667, 0.01667  (x, y)
extent     : -71.99, -70.99, 45.01, 46.01  (xmin, xmax, ymin, ymax)
crs        : +proj=longlat +ellps=WGS84 +no_defs 
source     : mint.nc 
names      : X120 
values     : -13, -9.5  (min, max)
zvar       : variable </code></pre>
<p><br></p>
<p>Nous pouvons aussi prendre une séquence d’indices et obtenir un autre <code>rasterStack</code>. Par exemple, nous pouvons obtenir les données de la première année en utilisant les 12 premiers indices.</p>
<div class="sourceCode" id="cb1309"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1309-1"><a href="lecon_spatiotemp.html#cb1309-1" aria-hidden="true" tabindex="-1"></a>mint[[<span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>]]</span></code></pre></div>
<pre class="codeout"><code>class      : RasterStack 
dimensions : 60, 60, 3600, 12  (nrow, ncol, ncell, nlayers)
resolution : 0.01667, 0.01667  (x, y)
extent     : -71.99, -70.99, 45.01, 46.01  (xmin, xmax, ymin, ymax)
crs        : +proj=longlat +ellps=WGS84 +no_defs 
names      :    X1,    X2,    X3,    X4,    X5,    X6,    X7,    X8,    X9,   X10,   X11,   X12 
min values : -16.2, -19.9, -12.8,  -4.5,   2.4,   8.2,   9.7,   9.2,   6.3,   2.7,  -7.1, -13.6 
max values : -13.9, -18.0,  -9.5,  -0.6,   5.5,  11.8,  13.0,  11.7,   8.7,   5.3,  -4.0, -10.6 </code></pre>
<p><br></p>
<p>Nous pouvons aussi obtenir les températures minimales pour les 10 mois de septembre, nous utilisons pour cela la fonction <code>seq()</code>.</p>
<div class="sourceCode" id="cb1311"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1311-1"><a href="lecon_spatiotemp.html#cb1311-1" aria-hidden="true" tabindex="-1"></a>mint[[<span class="fu">seq</span>(<span class="dv">9</span>, <span class="at">by =</span> <span class="dv">12</span>, <span class="at">length.out =</span> <span class="dv">10</span>)]]</span></code></pre></div>
<pre class="codeout"><code>class      : RasterStack 
dimensions : 60, 60, 3600, 10  (nrow, ncol, ncell, nlayers)
resolution : 0.01667, 0.01667  (x, y)
extent     : -71.99, -70.99, 45.01, 46.01  (xmin, xmax, ymin, ymax)
crs        : +proj=longlat +ellps=WGS84 +no_defs 
names      :   X9,  X21,  X33,  X45,  X57,  X69,  X81,  X93, X105, X117 
min values :  6.3,  6.3,  4.7,  7.4,  8.1,  5.1,  5.8,  5.8,  8.6,  7.0 
max values :  8.7,  9.3,  7.3, 10.3, 10.7,  8.4,  9.1,  8.9, 11.5,  9.3 </code></pre>
<p><br></p>
<p>Il est aussi possible de combiner des couches du même <code>rasterStack</code> et de différents <code>rasterStack</code> (si les contraintes spatiales sont respectées) avec <code>stack()</code>.</p>
<div class="sourceCode" id="cb1313"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1313-1"><a href="lecon_spatiotemp.html#cb1313-1" aria-hidden="true" tabindex="-1"></a><span class="fu">stack</span>(mint[[<span class="dv">1</span>]], maxt[[<span class="dv">1</span>]], pcp[[<span class="dv">1</span>]])</span></code></pre></div>
<pre class="codeout"><code>class      : RasterStack 
dimensions : 60, 60, 3600, 3  (nrow, ncol, ncell, nlayers)
resolution : 0.01667, 0.01667  (x, y)
extent     : -71.99, -70.99, 45.01, 46.01  (xmin, xmax, ymin, ymax)
crs        : +proj=longlat +ellps=WGS84 +no_defs 
names      :  X1.1,  X1.2,  X1.3 
min values : -16.2,  -7.6,  66.8 
max values : -13.9,  -3.7, 107.0 </code></pre>
<p><br></p>
<p>Nous avons, ici, créé un <code>rasterStack</code> en combinant les températures minimales et maximales, et les précipitations cumulées du mois de janvier de la première année (2007).</p>
</div>
<div id="extraire-et-manipuler-les-valeurs" class="section level5 unnumbered hasAnchor">
<h5>Extraire et manipuler les valeurs<a href="lecon_spatiotemp.html#extraire-et-manipuler-les-valeurs" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>Nous pouvons extraire les valeurs en utilisant la double indexation : <code>[[</code> pour choisir les couches désirées, et puis <code>[</code> pour extraire les valeurs des couches sélectionnées. Ainsi, nous pouvons extraire les valeurs des 10 premières cellules pour la première année (c’est-à-dire les 12 premiers mois).</p>
<div class="sourceCode" id="cb1315"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1315-1"><a href="lecon_spatiotemp.html#cb1315-1" aria-hidden="true" tabindex="-1"></a>mint[[<span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>]][<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>]</span></code></pre></div>
<pre class="codeout"><code>         X1    X2    X3   X4  X5   X6   X7   X8  X9
 [1,] -15.0 -19.0  -9.7 -0.9 5.5 11.8 13.0 11.5 8.7
 [2,] -15.1 -19.1  -9.7 -1.0 5.5 11.7 12.9 11.4 8.7
 [3,] -15.2 -19.1  -9.9 -1.1 5.4 11.6 12.8 11.3 8.6
 [4,] -15.2 -19.1  -9.9 -1.1 5.4 11.6 12.7 11.3 8.6
 [5,] -15.2 -19.1  -9.9 -1.1 5.3 11.6 12.7 11.3 8.6
 [6,] -15.2 -19.1  -9.9 -1.1 5.3 11.6 12.7 11.3 8.6
 [7,] -15.2 -19.1  -9.8 -1.1 5.3 11.6 12.8 11.3 8.6
 [8,] -15.2 -19.1  -9.9 -1.2 5.3 11.5 12.7 11.2 8.5
 [9,] -15.2 -19.1 -10.0 -1.2 5.3 11.5 12.6 11.1 8.5
[10,] -15.3 -19.0 -10.0 -1.3 5.2 11.4 12.5 11.1 8.5
      X10  X11   X12
 [1,] 5.3 -4.0 -12.2
 [2,] 5.2 -4.1 -12.3
 [3,] 5.1 -4.3 -12.4
 [4,] 5.1 -4.4 -12.4
 [5,] 5.1 -4.3 -12.4
 [6,] 5.1 -4.3 -12.4
 [7,] 5.1 -4.2 -12.3
 [8,] 5.1 -4.4 -12.4
 [9,] 5.0 -4.5 -12.5
[10,] 4.9 -4.6 -12.5</code></pre>
<p><br></p>
<p>Nous obtenons ainsi une matrice de 12 colonnes (1 colonne par mois) et 10 lignes (1 par cellule). Il est aussi possible d’utiliser <code>getValues()</code> pour obtenir l’ensemble des valeurs d’un objet <code>rasterStack</code>. Dans ce cas, les valeurs sont alors retournées sous forme de matrice.</p>
<div class="sourceCode" id="cb1317"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1317-1"><a href="lecon_spatiotemp.html#cb1317-1" aria-hidden="true" tabindex="-1"></a>val <span class="ot">&lt;-</span> <span class="fu">getValues</span>(mint)</span>
<span id="cb1317-2"><a href="lecon_spatiotemp.html#cb1317-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(val)</span></code></pre></div>
<pre class="codeout"><code>[1] 3600  120</code></pre>
<p><br></p>
<p>Pour appliquer les mêmes opérations sur les différentes couches, il est possible d’utiliser la fonction <code>R</code> <code>apply()</code> après avoir utilisée la fonction <code>getValues()</code>. Par exemple, pour connaître la valeur minimale de chaque couche, nous pouvons utiliser la ligne suivante :</p>
<div class="sourceCode" id="cb1319"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1319-1"><a href="lecon_spatiotemp.html#cb1319-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(val, <span class="dv">2</span>, min)</span></code></pre></div>
<pre class="codeout"><code>   X1    X2    X3    X4    X5    X6    X7    X8    X9 
-16.2 -19.9 -12.8  -4.5   2.4   8.2   9.7   9.2   6.3 
  X10   X11   X12   X13   X14   X15   X16   X17   X18 
  2.7  -7.1 -13.6 -13.9 -14.5 -13.9  -2.6   0.7   9.7 
  X19   X20   X21   X22   X23   X24   X25   X26   X27 
 11.6   9.5   6.3  -0.4  -4.9 -14.3 -21.2 -14.9 -11.2 
  X28   X29   X30   X31   X32   X33   X34   X35   X36 
 -3.2   2.1   7.6  10.1  10.9   4.7  -1.1  -2.8 -13.0 
  X37   X38   X39   X40   X41   X42   X43   X44   X45 
-13.4 -11.2  -6.5  -1.1   3.8   8.2  12.8  10.2   7.4 
  X46   X47   X48   X49   X50   X51   X52   X53   X54 
  0.0  -5.1 -12.7 -16.2 -16.4 -11.6  -4.1   4.9   8.1 
  X55   X56   X57   X58   X59   X60   X61   X62   X63 
 11.3  10.6   8.1   1.9  -2.5 -10.3 -15.0 -12.8  -6.6 
  X64   X65   X66   X67   X68   X69   X70   X71   X72 
 -3.3   5.4   8.4  11.0  11.3   5.1   2.4  -6.8 -10.4 
  X73   X74   X75   X76   X77   X78   X79   X80   X81 
-16.8 -14.1  -9.4  -5.0   3.5   8.5  12.7   9.8   5.8 
  X82   X83   X84   X85   X86   X87   X88   X89   X90 
  1.4  -7.6 -14.2 -17.5 -16.0 -17.8  -5.0   3.4   8.3 
  X91   X92   X93   X94   X95   X96   X97   X98   X99 
 11.1   9.8   5.8   3.0  -6.7 -10.0 -20.4 -23.2 -15.5 
 X100  X101  X102  X103  X104  X105  X106  X107  X108 
 -5.6   4.8   6.9  10.6  11.5   8.6  -1.7  -4.0  -5.7 
 X109  X110  X111  X112  X113  X114  X115  X116  X117 
-14.0 -13.3  -9.3  -6.7   3.3   7.9  11.1  11.5   7.0 
 X118  X119  X120 
  1.5  -3.7 -13.0 </code></pre>
<p><br></p>
<p>Notez que l’argument 2 signifie que la fonction <code>min()</code> est appliquée sur la deuxième dimension de la matrice <code>val</code> (c’est-à-dire la dimension associée aux couches).</p>
<p>Nous pouvons aussi utiliser la fonction <code>summary()</code> qui nous donne un aperçu de la distribution des valeurs pour chaque couche. Par exemple, voici le résumé des cinq premières couches :</p>
<div class="sourceCode" id="cb1321"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1321-1"><a href="lecon_spatiotemp.html#cb1321-1" aria-hidden="true" tabindex="-1"></a>su_mint <span class="ot">&lt;-</span> <span class="fu">summary</span>(mint)</span>
<span id="cb1321-2"><a href="lecon_spatiotemp.html#cb1321-2" aria-hidden="true" tabindex="-1"></a>su_mint[,<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>]</span></code></pre></div>
<pre class="codeout"><code>           X1    X2    X3   X4  X5
Min.    -16.2 -19.9 -12.8 -4.5 2.4
1st Qu. -15.2 -19.1 -11.0 -2.2 4.1
Median  -15.0 -18.9 -10.4 -1.7 4.6
3rd Qu. -14.8 -18.7 -10.3 -1.4 4.9
Max.    -13.9 -18.0  -9.5 -0.6 5.5
NA&#39;s      0.0   0.0   0.0  0.0 0.0</code></pre>
<p><br></p>
<p>Aussi, certaines fonctions ont des comportements prédéfinies pour les objets <code>rasterStack</code>. Par exemple, la fonction <code>min()</code> retourne un objet de classe <code>rasterLayer</code> dont chaque cellule contient la valeur minimale des cellules des différentes couches ayant la même latitude et la même longitude (c’est-à-dire à la même position dans le <em>raster</em>).</p>
<div class="sourceCode" id="cb1323"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1323-1"><a href="lecon_spatiotemp.html#cb1323-1" aria-hidden="true" tabindex="-1"></a><span class="fu">min</span>(mint)</span></code></pre></div>
<pre class="codeout"><code>class      : RasterLayer 
dimensions : 60, 60, 3600  (nrow, ncol, ncell)
resolution : 0.01667, 0.01667  (x, y)
extent     : -71.99, -70.99, 45.01, 46.01  (xmin, xmax, ymin, ymax)
crs        : +proj=longlat +ellps=WGS84 +no_defs 
source     : memory
names      : layer 
values     : -23.2, -22  (min, max)</code></pre>
<p><br></p>
<p>La fonction <code>max()</code> a le même comportement, pour une combinaison (longitude, latitude) donnée, elle retourne la valeur maximale des différentes cellules. La fonction <code>quantile()</code> retourne les quantiles pour les différentes couches, par défaut, 5 quantiles sont retournées. Ci-dessous, nous présentons le résultat pour les 10 premières couches.</p>
<div class="sourceCode" id="cb1325"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1325-1"><a href="lecon_spatiotemp.html#cb1325-1" aria-hidden="true" tabindex="-1"></a><span class="fu">quantile</span>(mint)[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, ]</span></code></pre></div>
<pre class="codeout"><code>       0%   25%   50%   75%  100%
X1  -16.2 -15.2 -15.0 -14.8 -13.9
X2  -19.9 -19.1 -18.9 -18.7 -18.0
X3  -12.8 -11.0 -10.4 -10.3  -9.5
X4   -4.5  -2.2  -1.7  -1.4  -0.6
X5    2.4   4.1   4.6   4.9   5.5
X6    8.2  10.3  10.8  11.1  11.8
X7    9.7  11.3  12.0  12.2  13.0
X8    9.2  10.6  10.8  11.0  11.7
X9    6.3   7.6   8.1   8.3   8.7
X10   2.7   4.3   4.6   4.8   5.3</code></pre>
<p><br></p>
<p>Cette opération est équivalente à appliquer la fonction <code>apply()</code> et <code>quantile()</code> après avoir utilisé <code>getValues()</code>.</p>
<div class="sourceCode" id="cb1327"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1327-1"><a href="lecon_spatiotemp.html#cb1327-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(val, <span class="dv">2</span>, quantile)[, <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>]</span></code></pre></div>
<pre class="codeout"><code>        X1    X2    X3   X4  X5   X6   X7   X8  X9 X10
0%   -16.2 -19.9 -12.8 -4.5 2.4  8.2  9.7  9.2 6.3 2.7
25%  -15.2 -19.1 -11.0 -2.2 4.1 10.3 11.3 10.6 7.6 4.3
50%  -15.0 -18.9 -10.4 -1.7 4.6 10.8 12.0 10.8 8.1 4.6
75%  -14.8 -18.7 -10.3 -1.4 4.9 11.1 12.2 11.0 8.3 4.8
100% -13.9 -18.0  -9.5 -0.6 5.5 11.8 13.0 11.7 8.7 5.3</code></pre>
<p><br></p>
<p>Il est aussi possible de faire des calculs sur les différentes couches en utilisant la fonction <code>calc()</code>, par exemple nous pouvons obtenir le quantiles cellule par cellule de la manière suivante :</p>
<div class="sourceCode" id="cb1329"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1329-1"><a href="lecon_spatiotemp.html#cb1329-1" aria-hidden="true" tabindex="-1"></a><span class="fu">calc</span>(mint, quantile)</span></code></pre></div>
<pre class="codeout"><code>class      : RasterBrick 
dimensions : 60, 60, 3600, 5  (nrow, ncol, ncell, nlayers)
resolution : 0.01667, 0.01667  (x, y)
extent     : -71.99, -70.99, 45.01, 46.01  (xmin, xmax, ymin, ymax)
crs        : +proj=longlat +ellps=WGS84 +no_defs 
source     : memory
names      :     X0.,    X25.,    X50.,    X75.,   X100. 
min values : -23.200, -11.300,  -1.400,   7.675,  12.800 
max values : -22.000,  -8.325,   1.300,  10.625,  16.100 </code></pre>
<p><br></p>
<p>Ce qui nous donne un objet <code>rasterStack</code> qui loge, sur chacune de ses 5 couches, les valeurs des différents quantiles pour chacune des combinaisons (longitude, latitude). Nous noterons alors qu’utiliser <code>calc(mint, min)</code> revient à utiliser <code>min(mint)</code>.</p>
</div>
<div id="réaliser-des-opérations-spatiales" class="section level5 unnumbered hasAnchor">
<h5>Réaliser des opérations spatiales<a href="lecon_spatiotemp.html#réaliser-des-opérations-spatiales" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>Les principales opérations spatiales pour les objets de classe <code>rasterStack</code> utilisent les mêmes fonctions que pour les objets de classe <code>rasterLayer</code>. Les opérations spatiales à réaliser seront alors, au besoin, répétées sur les différentes couches (cela étant dit, pour des raisons d’optimisation algorithmiques, il se peut que les opérations soient plus rapides sur un <code>rasterStack</code> de <span class="math inline">\(n\)</span> couches plutôt que d’appliquer <span class="math inline">\(n\)</span> fois les mêmes opérations sur <span class="math inline">\(n\)</span> objets <code>rasterLayer</code>).</p>
<p>En guise de démonstration, nous allons utiliser les fonctions <code>projectRaster()</code>, <code>crop()</code>, <code>mask()</code> et <code>extract()</code> sur le <code>rasterStack</code> <code>mint</code> (voir le <a href="mat.html#mat">Module 5</a> et le <a href="manip_mat.html#manip_mat">Module 8</a> pour plus de détails sur ces fonctions).</p>
<p>Pour illustrer le changement de projections des <code>rasterStack</code>, projetons <code>mint</code> en utilisant la projection de Mercator.</p>
<div class="sourceCode" id="cb1331"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1331-1"><a href="lecon_spatiotemp.html#cb1331-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb1331-2"><a href="lecon_spatiotemp.html#cb1331-2" aria-hidden="true" tabindex="-1"></a>mint_merc <span class="ot">&lt;-</span> <span class="fu">projectRaster</span>(mint, <span class="at">crs =</span> <span class="fu">st_crs</span>(<span class="dv">3857</span>)<span class="sc">$</span>proj4string)</span>
<span id="cb1331-3"><a href="lecon_spatiotemp.html#cb1331-3" aria-hidden="true" tabindex="-1"></a>mint_merc</span></code></pre></div>
<pre class="codeout"><code>class      : RasterBrick 
dimensions : 70, 74, 5180, 120  (nrow, ncol, ncell, nlayers)
resolution : 1860, 2650  (x, y)
extent     : -8027100, -7889460, 5609433, 5794933  (xmin, xmax, ymin, ymax)
crs        : +proj=merc +a=6378137 +b=6378137 +lat_ts=0 +lon_0=0 +x_0=0 +y_0=0 +k=1 +units=m +nadgrids=@null +wktext +no_defs 
source     : memory
names      :         X1,         X2,         X3,         X4,         X5,         X6,         X7,         X8,         X9,        X10,        X11,        X12,        X13,        X14,        X15, ... 
min values : -1.616e+01, -1.986e+01, -1.276e+01, -4.459e+00,  2.427e+00,  8.241e+00,  9.727e+00,  9.227e+00,  6.285e+00,  2.741e+00, -7.032e+00, -1.355e+01, -1.390e+01, -1.451e+01, -1.386e+01, ... 
max values : -1.390e+01, -1.801e+01, -9.526e+00, -6.056e-01,  5.500e+00,  1.180e+01,  1.300e+01,  1.170e+01,  8.700e+00,  5.300e+00, -4.000e+00, -1.060e+01, -1.180e+01, -1.270e+01, -1.000e+01, ... </code></pre>
<p><br></p>
<p>Notons que la fonction <code>st_crs()</code> nécessite la bibliothèque <code>sf</code>.</p>
<p>Nous allons maintenant faire une opération de rognage sur <code>mint</code> en utilisant
l’étendue spatiale suivante (dans le système géodésique mondial WGS84):</p>
<ul>
<li>longitude : de 71.5°Ouest à 71°Ouest,</li>
<li>latitude : de 45°Nord à 45.5°Nord.</li>
</ul>
<div class="sourceCode" id="cb1333"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1333-1"><a href="lecon_spatiotemp.html#cb1333-1" aria-hidden="true" tabindex="-1"></a>mint_crop <span class="ot">&lt;-</span> <span class="fu">crop</span>(mint, <span class="fu">extent</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="fl">71.5</span>, <span class="sc">-</span><span class="dv">71</span>, <span class="dv">45</span>, <span class="fl">45.5</span>)))</span></code></pre></div>
<p><br></p>
<p>Pour les deux opérations suivantes nous allons utiliser les contours du Parc national de Frontenac qui est le premier élément de l’objet <code>parcs_sherbrooke</code> manipulé au <a href="manip_mat.html#manip_mat">Module 8</a> et disponible dans le répertoire <code>Module8_donnees</code>.</p>
<div class="sourceCode" id="cb1334"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1334-1"><a href="lecon_spatiotemp.html#cb1334-1" aria-hidden="true" tabindex="-1"></a><span class="co"># importer le raster parcs</span></span>
<span id="cb1334-2"><a href="lecon_spatiotemp.html#cb1334-2" aria-hidden="true" tabindex="-1"></a>parcs <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">&quot;Module8/Module8_donnees/parcs_sherbrooke&quot;</span>) </span></code></pre></div>
<pre class="codeout"><code>Reading layer `parcs_sherbrooke&#39; from data source 
  `E:\ELF\Dropbox\Teluq\Enseignement\Cours\SCI1031\Developpement\Structure_test\sci1031\Module8\Module8_donnees\parcs_sherbrooke&#39; 
  using driver `ESRI Shapefile&#39;
Simple feature collection with 4 features and 18 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: -323500 ymin: 151800 xmax: -201900 ymax: 226200
Projected CRS: NAD83 / Quebec Lambert</code></pre>
<p><br></p>
<p>Nous isolons d’abord les contours du Parc national de Frontenac (<code>parcs[1, ]</code>) puis nous créons le shapefile <code>frontenac</code> en utilisant la projection de <code>mint</code>. Ensuite, nous utilisons la fonction <code>mask()</code> pour isoler les cellules de <code>mint</code> qui sont dans les limites du parc <code>frontenac</code>, et cela, pour toutes les couches de <code>mint</code>.</p>
<div class="sourceCode" id="cb1336"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1336-1"><a href="lecon_spatiotemp.html#cb1336-1" aria-hidden="true" tabindex="-1"></a><span class="co"># isoler le premier élément de `parcs`, et le convertir dans le CRS de `mint`</span></span>
<span id="cb1336-2"><a href="lecon_spatiotemp.html#cb1336-2" aria-hidden="true" tabindex="-1"></a>frontenac <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(parcs[<span class="dv">1</span>, ], <span class="fu">st_crs</span>(mint))</span>
<span id="cb1336-3"><a href="lecon_spatiotemp.html#cb1336-3" aria-hidden="true" tabindex="-1"></a><span class="co"># appliquer un mask à `mint`</span></span>
<span id="cb1336-4"><a href="lecon_spatiotemp.html#cb1336-4" aria-hidden="true" tabindex="-1"></a>mint_mask <span class="ot">&lt;-</span> <span class="fu">mask</span>(mint, frontenac)</span></code></pre></div>
<p><br></p>
<p>Enfin nous pouvons extraire les valeurs des cellules de <code>mint</code> qui sont à l’intérieur des limites de <code>frontenac</code> en utilisant la fonction <code>extract()</code>.</p>
<div class="sourceCode" id="cb1337"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1337-1"><a href="lecon_spatiotemp.html#cb1337-1" aria-hidden="true" tabindex="-1"></a>val_frontenac <span class="ot">&lt;-</span> <span class="fu">extract</span>(mint, frontenac)</span>
<span id="cb1337-2"><a href="lecon_spatiotemp.html#cb1337-2" aria-hidden="true" tabindex="-1"></a><span class="co"># la fonction extract retourne une liste, qui associe la valeur de mint à chaque cellule de chaque couche.</span></span>
<span id="cb1337-3"><a href="lecon_spatiotemp.html#cb1337-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Par exemple, retournons les 10 premières lignes et les 5 premiers éléments de cette liste</span></span>
<span id="cb1337-4"><a href="lecon_spatiotemp.html#cb1337-4" aria-hidden="true" tabindex="-1"></a>val_frontenac[[<span class="dv">1</span>]][<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>] </span></code></pre></div>
<pre class="codeout"><code>         X1    X2    X3   X4  X5
 [1,] -15.2 -19.1 -10.3 -1.8 4.7
 [2,] -15.2 -19.1 -10.3 -1.9 4.6
 [3,] -15.2 -19.1 -10.3 -1.9 4.6
 [4,] -15.2 -19.0 -10.3 -1.8 4.7
 [5,] -15.2 -19.1 -10.3 -1.9 4.7
 [6,] -15.2 -19.1 -10.3 -1.9 4.6
 [7,] -15.2 -19.1 -10.4 -1.9 4.6
 [8,] -15.2 -19.1 -10.4 -1.9 4.6
 [9,] -15.2 -19.0 -10.3 -1.8 4.8
[10,] -15.2 -19.0 -10.3 -1.8 4.7</code></pre>
<p><br></p>
<p>Notons qu’ici, cette opération aurait aussi pu être réalisée en utilisant <code>getValues()</code> sur <code>mint_mask()</code>.</p>
</div>
<div id="visualiser-des-rasterstack" class="section level5 unnumbered hasAnchor">
<h5>Visualiser des rasterStack<a href="lecon_spatiotemp.html#visualiser-des-rasterstack" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>Comme pour les objets <code>rasters</code>, nous pouvons rapidement visualiser les objets <code>rasterStack</code> avec la fonction <code>plot()</code>.</p>
<div class="sourceCode" id="cb1339"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1339-1"><a href="lecon_spatiotemp.html#cb1339-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mint)</span></code></pre></div>
<p><img src="Cours_SpatialR_files/figure-html/plot_stack-1.png" width="720" style="display: block; margin: auto;" />
<br></p>
<p>Par défaut, 16 couches sont affichées au maximum. Toutefois, il est possible d’augmenter ce nombre en modifiant la valeur de l’argument <code>maxnl</code> :</p>
<div class="sourceCode" id="cb1340"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1340-1"><a href="lecon_spatiotemp.html#cb1340-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mint, <span class="at">maxnl =</span> <span class="dv">25</span>) </span></code></pre></div>
<p><img src="Cours_SpatialR_files/figure-html/unnamed-chunk-535-1.png" width="720" style="display: block; margin: auto;" />
<br></p>
<p>Avec un grand nombre de cartes (au-delà de 10), il peut s’avérer difficile de visualiser correctement les données et il est parfois souhaitable de sélectionner les couches à inspecter. Par exemple, il est possible de visualiser les données des 4 derniers mois en sélectionnant les 4 dernières couches de <code>mint</code>.</p>
<div class="sourceCode" id="cb1341"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1341-1"><a href="lecon_spatiotemp.html#cb1341-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mint[[<span class="dv">117</span><span class="sc">:</span><span class="dv">120</span>]]) </span></code></pre></div>
<p><img src="Cours_SpatialR_files/figure-html/unnamed-chunk-536-1.png" width="720" style="display: block; margin: auto;" />
<br></p>
<p>Par défaut, le titre utilisé pour chaque carte correspond au nom des couches. Pour modifier les titres, nous pouvons renommer les couches en utilisant la fonction <code>names()</code>. Cela dit, il y a des contraintes sur les noms des couches (par exemple, les espaces blancs sont à éviter). Pour avoir un titre libre de ces contraintes, nous pouvons utiliser l’argument <code>main</code> dans la fonction <code>plot()</code> auquel nous donnons un vecteur contenant les titres souhaités.</p>
<div class="sourceCode" id="cb1342"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1342-1"><a href="lecon_spatiotemp.html#cb1342-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mint[[<span class="dv">117</span><span class="sc">:</span><span class="dv">120</span>]], <span class="at">main =</span> <span class="fu">c</span>(<span class="st">&quot;09/2016&quot;</span>, <span class="st">&quot;10/2016&quot;</span>, <span class="st">&quot;11/2016&quot;</span>, <span class="st">&quot;12/2016&quot;</span>))</span></code></pre></div>
<p><img src="Cours_SpatialR_files/figure-html/unnamed-chunk-537-1.png" width="720" style="display: block; margin: auto;" />
<br></p>
<p>La fonction <code>mapview()</code> peut aussi être utilisée pour visualiser les <code>rasterStack</code> (voir [Module 8][#mat]). Les différentes couches seront alors mises les unes par dessus les autres dans l’ordre donné (la dernière étant sur le dessus de la pile). Un trop grand nombre de couches rendra la carte difficile à interpréter. Comme mentionner précédemment, mieux vaut sélectionner un nombre limité de couches à visualiser. Ci-dessous, nous visualisons les trois premières couches.</p>
<div class="sourceCode" id="cb1343"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1343-1"><a href="lecon_spatiotemp.html#cb1343-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mapview)</span>
<span id="cb1343-2"><a href="lecon_spatiotemp.html#cb1343-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mapview</span>(mint[[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>]])</span></code></pre></div>
<div class="leaflet html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-3190f891673e0f5f8b55" style="width:720px;height:720px;"></div>
<script type="application/json" data-for="htmlwidget-3190f891673e0f5f8b55">{"x":{"options":{"minZoom":1,"maxZoom":52,"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}},"preferCanvas":false,"bounceAtZoomLimits":false,"maxBounds":[[[-90,-370]],[[90,370]]]},"calls":[{"method":"addProviderTiles","args":["OpenStreetMap","OpenStreetMap","OpenStreetMap",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addRasterImage","args":["data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAKhklEQVRoga1bS2/TTBQ9jl9x0jZt6QJRhFS2/Hn+0CcWbKiQCkmdxM/4W4QzPb6ZSVLolarG9jzuue8Zj6OvX78ObduibVuEqGmag99Zlo3u8dreZ/uLi4uDcdM09c4buv8aUp6VJsc6pWl6cC/LMgfKglewvJ7P58iyzMtACNQpsD6+jvGpvCV2AE5G7WRZ5p5bRnRAtiGwpmlwcXGBKIrOZvIUqeZDPPn66O+JNR/LWNM0iKIIURQdZdqOMZ/PR9cE/i/EOexcoT8AI96jKNprmINYaai2gUOTtdQ0jRfcW4D9G/IpKLEPCVI1qsDtINakeB0Kav9KytNr3SRN033QCnWMosgLSP9C/TVC/43/2j5qpq8dU9smNmDRlENh3UfnpLS/1fA5wHxBV0mtYZSW3iKShug1AiSdy48viIXaTHydXjPZa8i6wltQCGCIEuuHoaDwFkwOw/DPYyi9xgLYNtEHSZK4/0mSoOu6UWAK+cdrJj+HTo117Dn5DhUmSVEUaNv2AKBNS7y2A1BrVjBvEZnPbUNFkW9i8fVJqqoaMX0gkT+DEbQl1sk6xlubrgLyka/QUdBJkiBNU3Rdh2QYBgdSNQzsJdP3vbf0DPn0OWB9Wjqm3b7vvaCPCYKg2UauEwzDgK7rMAzDyGxpmmmaYrPZjAZUE7ZVlfYNMXMO2GOAkiQ5WbLquF3X7UG7HwI8NIGavPVd0qkCw1dBhegYIA1M5O9YfxeQqQkC50Nr3nxmTdZeH1t5nQJxish013UHAK0AfPP+Cc4vqYjaVeBqmmmanqyYKACfpi1DOvcxUj/ktf4OtbfW2nXdfj0M7AODHYCmrtcEEgpaIZO2y0Zluu97t27VP22nfX3PfPc0aAHAdDp9WTxQMxrKVTJ28X3MfCxot/gO5MtQZD8VmOwz296u9rquQ6IFhgWr10xfdivHB1CBKjgL2lqVNU8foGPkE47GI5eWbKS25CvVzonGClBBk4ZhGN07pk2ftkO+Sj7VjZzAeREyKw1kdl/rWET2rWJOmeAxOrcvhaAFFfv/ie5jX1XztmnKSlQB+QJSKJLabHCKTuVYO7Z1n6qqkCQJ4jjeA6Yv+QbygbVCAsaVFQVn04m2PwcU758SDKNx3/fYbrejarEoCuR5/iJ8XzUC7E2CZm73g9u2PWDcBh4r5a7rjkbkEKhzApdaUxzHGIYBeZ67YDWqyOI49ko9tA+tpu5jIIoiFEUxAk0KzWXHOLUo8JF1k8lk4l9Ksqz01dE6ONudYspugtvx7FrVZ7Kh1RFwunS17TzVXeL1SRugfFq1bW2VY4Fp+lMhWKLwT62WfAB9hROfd12HpO/7g1UHO/mClfognzFA2eBn63OfYEN0CjT7l2WJ7XaLYRhQFMW+fJQ+bduiqiq3MZEw+StYWwHpxHYnQYFOJpMRMz7QPsGeAq28WMDcoGjbFt+/f8fDwwOurq5GgNu2RRzHe8UoAxwgjuPR4D7zJNAoikaatXROSgrV72pRVttt22K1WuG///7D4+MjsixD13WYz+cuaBLsyNUIEgAT8yia9n0/iswURhRF2O12I4H4zE9Bsq8Fzvn0Pn2SY1olxHGMvu9xc3ODp6cn5Hnu/iikOI5HY3ddt9+IZ85ldNztdk4iOhETuA+8DVhKWoD4nuvmAn2Nv1Xwtk+apiiKAh8/fsRiscCXL19wfX09akOTH4Zhr1AdhD6TZdlIs9S8L80QNBmy5klNkGyk9mlb+9t0qcKazWaYTqe4vLxE27a4vLx0bajRpmmcC/6Z12+GNO26rpEkyUEeJlkwNCdai1qKbatEJjmPlql2/4wAkmS/I0Mz1lUXwfKamk50Mo3QvJ/n+QiYMq5M27JRf+uY7pWHLP4J0C5GrFC03OXiXvfjbLzgHKvVCsC+rh5puO97+NKUkmpLwYfKRjJqhUOrUSHwmd2F0Wf8UyWp+VuBbTYb1HXtnic6kOwKjHzpWPXFdhyUDKggbbrRgKRM2msK0/c2pOs6b3RXKooCu90OVVXhx48fuLu72+9L05RpBqEoa7d8lCmrYWVW/ZF96WMhYQIYtSP5YokKxO69DcOA+XyO+/v7fVzRyWazGeI4dvk1VOUAGKUmFiAkn++RuBgncILabrcoiuLA/JumcW89Qi/SaDFt2+L3798A9hY3n8+xXq8BwP12gG1w0gF9pIsBAg8dK7J+Zt9Q8lWOmrmORQU0TTN6/cNrRuumabDdbgEANzc3WK/Xruqq6xrX19dIQkAtWLuQV9DaX02WDPtO/tiFCXOzvs5hwZBlGdbrtfcYI4U1DAPKskRd13j//j2iKMJ8PkcURaP0lNhiQkmLCh9IJRWELhp8AYdA7M6JFRIFwmuCapoGeZ4jTVPkeY6yLJGmKZ6fn3FzczPKxzxJOJvN9kIOosXxhbjNeUz+dmVEgJaSJEFVVc7HqKnZbObmzLIMy+XSZQBg7xI/f/7E/f09np+f8fT05NrwTeZyuRydB729vXUnA4/vbAsgCxIA1uv1KLJPp9NRrmQfXZyrGeuLdADY7XbYbDZYLBauz263c/7KA2406WEYsFgsMJlMUNe1G6/ve1RVhSzLUBQFFosFttvtS6WlzKkGQimDzyaTCbquQ1VVmE6nTlO2Lc2X2uaCXdsDL5F0uVw60PTfsiwdUHXDyWSCq6srlGWJq6sr5HmOuq7x+PiI6XSKz58/g5scRVHsAfvKRZuPqcmqqoKa0hxpd0f4TA+90QTpo8vlciRg4CVwsW1ZllitVm7RwCMXt7e3buw8z/Hw8OACVlmWAPbBbrQerusabdtiOp2iruvR0lAFYEs6ANhut14LCRX/Go2LosB2u3V+yK3gzWYzOsJMQO/evfOWnXrcsSgKpGmK9XqN5+dnXFxc7EtLNWfW0bwXqqZYKNBvqU1WTmrGzItJkjgNzmaz0V53FEVYr9dOi1mWYbPZYLfbubTUNA3quj44+A28HKzhb/oz/V0FMfLhUK5V4BTMMAwOjG4KsBjgM/Vf1SxfdBG49elhGLBer110pT+TCITPCGq1Wrl1MefRtu7ooUZX1Tp91vouwbFCIjGi6lJONaFkz32pdgG4zwe0ACFYEp81TYOqqkarI7ooxwLwsnhQkKHVBzBefBdF4S0uAGCz2biErwD1j+OtVqsDcKpRglVzpqXQfKuqArCv1b99+4YPHz64zME+aZq++DDBcjBlkkLgAPaYgT3Q1jQNfv365QCoz+o3FACwWq2cUCgkzkvyvYumT9Oa6rpGnuf49OkT6rrGdDp1PqybBonVqP3Nt3G8JmgFahml+ZRliWEYnNmrdnlvNpuhbVus12uXfhSU7wsatqVm8zzH3d2dS0lRFCHPc6+gHGD7LoZBh8CoIZogwSoQggeA6+tr76KB7bSktKavpH6uxxwpDNVuCKRaVWJLP26LHJtcNUvJz+dz77EIBclvJqzZqksocxrJlVTbWZY5oL4jVTaHu++WttutK97t+2Alal4rJgKzIFTzSjb/2i/YqD37+YC20yBWluXoYzH7UYkGwMRK+BTj+tz3oZYSLYXm6gtEViv6oZf97zvTybEuLi7c0lHBaw3eNA3+B6As/9XIS0znAAAAAElFTkSuQmCC",[[46.0083251581089,-71.991704348775],[45.0083255354449,-70.991704741263]],0.8,null,"X1","X1"]},{"method":"removeLayersControl","args":[]},{"method":"addLayersControl","args":["OpenStreetMap","X1",{"collapsed":true,"autoZIndex":true,"position":"topleft"}]},{"method":"addControl","args":["","topright","imageValues-X1","info legend "]},{"method":"addImageQuery","args":["X1",[-71.991704348775,45.0083255354449,-70.991704741263,46.0083251581089],"mousemove",4,"Layer"]},{"method":"addLegend","args":[{"colors":["#4D4D4D , #646464 7.87068696497812%, #909090 29.8062337029609%, #B0B0B0 51.7417804409437%, #CACACA 73.6773271789265%, #E1E1E1 95.6128739169093%, #E6E6E6 "],"labels":["-16.0","-15.5","-15.0","-14.5","-14.0"],"na_color":null,"na_label":"NA","opacity":0.3,"position":"bottomleft","type":"numeric","title":"X1","extra":{"p_1":0.0787068696497812,"p_n":0.956128739169093},"layerId":null,"className":"info legend","group":"X1"}]},{"method":"addScaleBar","args":[{"maxWidth":100,"metric":true,"imperial":true,"updateWhenIdle":true,"position":"bottomleft"}]},{"method":"addHomeButton","args":[-71.991704348775,45.0083255354449,-70.991704741263,46.0083251581089,true,"X1","Zoom to X1","<strong> X1 <\/strong>","bottomright"]},{"method":"addRasterImage","args":["data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAJO0lEQVRogaVbW28TzRKsXfZmQxyCQDyBxO/nF/HKAwKEFMexzV6M9zyEmtS0e8bLd1qKvDvXrunL9PRsis+fP8/DMCBHbdsCAF69egUAaJomqq/rGgAwTRPGcUTTNKjrGk3T4HA4RG0OhwPGcbyYg2N6dSxvmsat9/i3ZXyvroHNTW6pruvwVxQFxnHEer3GNE0AEH6BS4ApoNp+KdgclR7jnIB1HHQcx/CXIgXLZy4Cx2A7lumzbWPLPD49olba97IoiotOTdOgKApo3TAMeHx8DID3+31gRCVXFEUEHHiS7PF4DItQ1zWmaQr9iqIIzwrMK7OUq/NAV5xQVWYcx9BYQevgClrrpmkKgAicv/M8R0BYzjot17lU0toGSKt6iio+WGBU47Ztg6SapknaDCdW+7aao9In403TYJqmYAYesZ9Xz7oUtW0b8Vzp5Lazx7BnM/v9Pir3nJqWqZToxYF4IWzfHNm5LSnoyluhlISmaYqYpqoNw4BhGNC27YWjIQNW9Wwdx+R4ZHQJKYbU9saxKjjEATw1Uwl40lBVXUo6x3/ZJpXU/LzxXcDaMKdOqgnWftk/5fDsPJZJ2x94VnkNdFKUkroLWBmiZ73Wjm2XeExVe+3njafEPf2ao+Ic1jc1TYMy1Vi3kRTN83wRNNiAwgPIPZ57MRlKzadj5jy2zsfFsfNW2jDlrUlW9cZxvFAdxtsMSLjtpJjMkTozxud2f7d8qwbwXVW/0g4WmCVKgPXzPAcnQ2Db7RZN0wTpK6W2nRRQXUzLk9bpPFZYVtKuDXuqlbJruwgMThiephhObVe233q9BgDXWXnOy1tUHe8C8DXpeu0p0Vz/1HjjOIZnCxYATqdTFNvnpJmy3QuV1lW55qgs2UDDnrC8/VDLdD4NPTnu6XSK5rHRnkpebTfFY+U1UMrtn1YidV1HCQDPhr1xOJY+0ydYMPY5JU1V96xKW5tSCRAQybM9nagsywhMSot04aiWnoe14Ai+qp5gnE6n0EfH07kvAOekbevmeb6QDBdCvbR6dUtWS1KnJt1uCNDyVVVVAG3ruBChpz2yeV40dTzTbYTqqImBlF9QrVgiSYJKCUWlrXQ6nZ77qwpYddCJUowAz4EB7Y5AuD15QDm2FyrqqSwFPMdLar+v6/rpeOgBVfVMHbm846PGxR5T1l69yMkyWdd18NYWuNfeag1VPYSW2sCGbFa9U5N69uvVa5nnhb24PKWqltR56Ty6WKUOylwyvSQZobqyXNM+BMN6z57tmArIBhT6XhQFTqcTpmmKQET7qiwE+7LM2xqjjIdVNavqVkp6Htbg3jMRC9TOZ31FtHcmvDKftf73798AEJKC6/U6krzrpXMqTlKQetzTXwVnGU5tHRaQ955KAtR1jfP5HD0fj8doQSo1aA+0DmqZp6rmzqaelFOHeD3rUnuUWQJNbXNWu4qiwIsXLyIMFQdOgVbmc6eUJYCW1Fmy3lnBeX3Z3kvyA39tmHagoG0nHdTbVpT+BWzu9KNE/khWyjbJ4PEWcloh7BLjtsx4Tsg7iuUop8ZL+1q/cjwecTweATydnT3tY9Q3z3O8D7OhSpvkOS9btjSj8V8olR6e5xllWeJwOODbt2/4+PFj2F4VKCm6aiEIlbaSdzYleRFOiv5FK3J0OBzw9etX/PjxA03T4M+fP2iaBh8+fMDhcIiyqMEJ2kGsmkYGbxZBbUoDlWuAlqhx6g5aaRgGdF0XAqGyLNF13cVFHC/q/2KInYF997y2tlViv6V2mSNNJnjEWP3m5gbn8xnjOOLNmzdYrVZRO/0qAfjrpW0MqqBzEvcW4HQ6RQuR2lZypFkTm2Sw7xo+lmUZ8eRdrEcpHjLqLQIpBV77eWHhvwL3ghkvVVsUBbquc7cg70xfkSkLzMsueOBzKVFvnCXA/9Xb2zlVsry4p6euchkEO5hl2gtScuMsBbHUB1xLCdN+NYNaqQQI5JozsjYOLJOKdYhLASzJdafi+fP5jL7v8fPnT7x+/Treh9WGLaNADNxT9WugrUNUZnPeOFW+5CqWSYy3b99eXpemGMpJVsuXqGJKwjkn5d09e33GccRut4uc1W63Q9u24R6s8g7XKQfjSZbl/w+lAn399aIm234YBvR9j3mesdls8Pj4iJcvX4aE4s3Njf+Nh+ehCVCDeE8blnpYSix1yWafgfznEJRg3/d49+5dSDEpvrIs8588pAILPnuLdW3b0TFSYFM2TSnbj174Qc3DwwNubm6iVDEXNftRS4rUxpnhpxbM8xxFWdc+frExrgLl/um1mecZu90Om80Gu90OALDdbjEMA+q6Rtu22O/36LoOfd8DADabjWptbK+pdKhnrzbM9FQ8pd4WiAXNMZn2Zdu2bUP9+XzGZrMJCz0MA+Z5xvl8xv39PW5vb0MfflpV2tQm7ZQpUlvPRVFJ6uHCLpg9OdHj5vJglK4m8z37bdsW0zRhtVphvV7j/fv3QXV//fqF79+/h/GAv4EHO1vJqbpqferk5OWYNFFgMxBeOz3Z6Hwsa9sWj4+PeHh4QFEU2Gw2YTF4ROTCfPr0KcxB1Q4fl1rGvRQt8CRZlSjLmAv2KGe/dj5KlNKlg7K3GvTCSgQ7z3M4I3Mx+r6/dFp6D+MxS0YITqXHhbDlnlMC/CsbgqEJAU8OyvuexJ55aaPalp5ZgXdd9/ydlg0rrSQBhGsPHVSTe5o5TDklBa7v9qZRv9/kO8FZohSBZ489zzP6vkdRFBHwkoyqd7Vbiv5RmjbsA65/wZ5L/ajdeh5ZSUFzIfq+R9/3OB6PQdIsI+gAWCm3jQDPnthjfskR0SPdfxWERmKUkgf24eEhGu/Lly/YbrfB/AgaAKpUgHDt1JPaj0n8Wp53UErqtOiovCublElQ3QmmbVvc399jtVrh7u4uOC1r60DiS7zcIljJ6raR2m5suaqutlOb9UDaOqps13W4u7tD3/cBpAcWcCScy1mR+BV7TgtS51u7CKopS9Ky+ksi6K7rADyBZRkQ23ywYd1WrIdWCdkgQZ2XRkoM3JVyZ95hGLKZDWu/LLu9vQ3AWGbBclH7vo8DD09lgev/U6D9tb3npOxJKPUfZPputyYSva+dRxfg4sSnjNpnZdCTcoqu5aC8eu/IZ+vss+2n+zGAcGLSBfgf6voXe47VSI8AAAAASUVORK5CYII=",[[46.0083251581089,-71.991704348775],[45.0083255354449,-70.991704741263]],0.8,null,"X2","X2"]},{"method":"removeLayersControl","args":[]},{"method":"addLayersControl","args":["OpenStreetMap",["X1","X2"],{"collapsed":true,"autoZIndex":true,"position":"topleft"}]},{"method":"addControl","args":["","topright","imageValues-X2","info legend "]},{"method":"addImageQuery","args":["X2",[-71.991704348775,45.0083255354449,-70.991704741263,46.0083251581089],"mousemove",4,"Layer"]},{"method":"addLegend","args":[{"colors":["#4D4D4D , #595959 4.24097316862544%, #747474 14.9230200311202%, #898989 25.6050668936151%, #9A9A9A 36.2871137561098%, #AAAAAA 46.9691606186046%, #B8B8B8 57.6512074810993%, #C5C5C5 68.333254343594%, #D0D0D0 79.015301206089%, #DBDBDB 89.6973480685837%, #E6E6E6 "],"labels":["-19.8","-19.6","-19.4","-19.2","-19.0","-18.8","-18.6","-18.4","-18.2"],"na_color":null,"na_label":"NA","opacity":0.3,"position":"bottomleft","type":"numeric","title":"X2","extra":{"p_1":0.0424097316862544,"p_n":0.896973480685837},"layerId":null,"className":"info legend","group":"X2"}]},{"method":"addRasterImage","args":["data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAK5UlEQVRogb1b2W7byhIsksNFm2ELDpD//6485yU2EkUSF3Eo3ge5xsXWUJLPObgNCJHImWHvXd10kh8/fowAcDqdoJRlGYZhwDAMABC+D8OALMsma3ktdp3nLhYLzJE+w54RW/fo/dj6VG/wYWSUQuhGZUj3xRjNsgxFUSDLsolCVXm3zrYf3p9Tir2uv/k9tcLqA8kkmb4lnGW07/vJudZj/g3NnXE+n6+uWaFTtao9kIzzd1EUk80xa4eD0zT81n3/hmICKaVpGviKWRcAHJm1DPP3OI5XLj9Hqij991FBVEkxGsfxofNINhyBjxgmqeAx4WxyuufeJLp3jM7nM8ZxxDiOEws+cu6tM+fI6eGqDd009x34dKNb1szzfHa/Ws0K/U9JPcXK5mIbzufz3QSTpulDzN0SMEZfddtHnqk0EZiWYtzah1tLch01GnvQfyHAVylN08CnzQ+OlrRuO5dAKDTXqxv+P4W7xSP5YX4YhgHOXWzrNBuTeJB1aX2Ijb1bD36U7mVptdattTSC9x7AFME5PciCBIuQeBAFvyfQf2VxPu/eeWoQm0wpj7Oa6vv+qmj3fT+xLAWPMfBoTf0KxbLuvXUk66WOZtcFuihNU+R5HjQUCwEAV3EcK1//lh6tzTH8z2tOk44KqwzSjecOjFl7TiH2bCuMeojd8xXv4XnsA4JLK3PqrlyQJMkEXt4S4FbdvhV/arlxHD87GykvesYjGdqeHSx8Pp+vLMYHaZ21KEhDIUmSieD3aI5hLSfKsC2bllclqyRLoSzFMm4MJcUOo+Y1/c/1ubp+7hwqV93Yls1YrqDwsZAjT06taele4x+j2L1bkwxbEWxS/AoUVc/RsyjjMAxwMYvYw8ZxnJQmu/6rnY2un0tmdrrxSKt5DwAVRRFvHuxDmYX7vv9HYOLWaOaR82xo3Upa9r7CS+CjH7Y9rr0Wg5OP9MKxqYPus+XO7iERNenvW2Tx/aTcxh52TwH3GLx3ljJzqyZzLT9zz4opzmb2gKU1uOemHJaZe/EUmyspMYnE7t/qn+ewO61YFMWVZa0sqQ6+VItWa/cmgl+hOcZ13DMn2L1zY2GnBnUEDTxQNcTNtiRZQdmKOeeC9ZIkmbXgXA2NWfNRGEnB2rad3MvzHEVRxEc8j1iMYEAHB4SDWgP1O4DJ2hiYsJnXKuVRFGdLJ8tpgJa3Nt+LaRXW7rMxrMLGRr+Krnh9DhDdI56jluWZTl0pNurRxX3f43w+B63pNPKesDFEF4Oc90a1sbYzlujmznFMVnqA0tzQziYD7tOcEHNdbdV4vjKkTQnnUMpbrO3knvP5jNPpdFW3acjT6XRx6TzPrw6Klaosy8K6JEkm7mcVRwZjbzT4r31DYS1qhxOqAApxOBzCGKqqqqsZON+Ree8xjuOlPVR/H4YB3vtJibKW1ESigt7CvXNlzYaRXR9LZNxDhYzjiNPphPf3d3z79m3yapbCpmkK59x1lmZScc5N+tyY2z86lbTZmaSZ255HYaxbk7quw+FwwM+fP7Hf74Py0jTF9+/fg9Vp2bIskSTJdGrJ8ae6hXUrCw+/IqxaiBS7Rk+bazo0CS6XSxwOB4zjeOmGPhSkxqJbA/L2UA9KkmTSS/JlGBWh5cMO98hgbDZmBbNrtRdO03SibHofExeBTVVVeHl5wTAM2G63k4GjVV6YaVltM4lZy5OJR+ZJMXR2D4PHXu147ycM67vmsixRFAXKssQ4jsjzHM65oJzT6TSpKkFgKwATFmuvJisbizqHio1mrPBK1L7N0rZU6XxN/xRjuVxOXqMAn65MmJlll0EkhQ+vSwko+DAbyyqAHe3qNesZdq8F9DEiP3ZGHuuAkiSBc+6qzDGmh2HAfr8PiNBZbGy7FVtfLeTTDDs3TbSMq4vGYliZjtVmGyIxxAZcSlLXdWiaBsClTjsy2vc9TqcT8jyfhY23SGfaalnGvlqHTFvS6zEr6z01Std1V2dpf1zXNX79+oXtdnsZ03JWxeBmYoi1b7HJQ6zMqMXt+qIoQkzxw2eqBXm2CpRlWfhdlmXYw7UETspPVVXYbrc4n8/TpFWWZVQYajs2TItplkrRB7Me0uraJXnvUdf15BqTU9d1OB6P8N6jLEtUVRXOtciubVvsdrtJGW2aJmTutm0vFs7zfAIokiQJFrLvmJQsVuZ9730A8SRm0jl83HXdxDq0ImEuS+LxeAyxzzVZlqGua7Rti+PxCAB4fn7G4XAIntP3PdbrNdxyuZwd58RACK1ERXG9IimbiGIxx+t8d8VmhEKP44iu6y6Z1Tl0XRemGVVVXXDxh7LatsU4jqjrGn3f4+XlBUmSoKoqJEkSLJ4kyfXbQyVbCxVdxea+tqaqxTj+Ube18cZzvfefQOFDWGbspmnQNE1oEKqqwuFwgHMOdV1jvV4jSRJ470PJcs4FoV0MyyqpVZU4DFAhrLtai6oSybzOoLz3qKoqKKuqKux2u2Bxnk+39t5jv9/jeDyi73s455DneXBrnrndblGW5SWGVbsxq1JoRU/aZ3KPbTHZlt2yPD+0ZNu2aNsWq9Uq7KVl27b9tJIgq9VqhSRJUNc1vPehvAKXakDo2XXdRSlaPhiLFiFRID6QJYqvX3i4VRh/aw3uui4kG7ZtFK4sSxyPx9AF0aLeezRNEzK0/mWf9x5FUcB7j6enpwAjd7sdiqLA6+trUOpms/l8XUqLMpkQgNhir/ATQKinHNNSIVQS9zMWiXGBSxl0zgWGdrtdwANcTy+gu7Zti7quURQFNptNEPrp6SmsBYDtdhsS1n6/BwAsl8tpt0TmrbXO5zOqqroCDBSsrutJCFjXVSjIetq2bVBAVVWfLveRZAgJGb9q3aenpyCoZuq+79H3PfI8D50TFcRq5LTM0E1Z9FVojWNiVGqdiqBFWOgBhNhyzuFwOATLVlUVygmAkGlJbdsGAReLRXBrPlOJXsLvfd8Hqy8Wi3Bts9l8xjCTQ5Zd/jZLhaagXEvX6boOy+UytGR6XZmgVW1/SwEJb7W20lr6G/gcQiiQ0WRFa/L5zjlsNpugQKegnwLZYbm6awy0awhoHPE397DMcFpBpjhD4xqeS2uy2wl/PhgRtq5rnE6nSbx674N7LxaLiwKpPUVGCtlYwBlrbC6oKJYgVcQ4jpea59wVwGeiUubf398vsO8jdumSeZ5P4lTJCtt1XZjUvL294fX1NQhOoJLnORw7pdhrEO1bVQm8R0UoYuL+379/I89zVFUVPio0n/H+/o7VagUA2O12V1ZUlGSFJeAAPv9Xzna7DW0uP1yz2WzgmGwojLox45EPPp1OWC6X4T6TFDGvMrper9E0TbA243i1WgVLdl2H1WqFYRjC5FHruEJIegzDgDFOenl5wfF4RFEUk7cfCi+993B1XQcLJUkS4pHCkDQ+9/v9BCkxBrWbeX5+nrgimwGOY2gdrtN2cg6i8p4OKxRZ0VMsUehxHC9lSR9Ei2ma11LD9WzHlLn1eh2sAWDixiwrLEl936OqqqBcTUxUFIGFUtu2E+jIrM1/i6KYWN45F/homuaStJxzOB6P6LouJBleBz4nC+xIWMYsxGvbNghBgfUelUeFOOfw9vYWkpRzDovFAk3TBAEUSDRNM4GyBBd930+gqLWuXndESnZupBbld2t5tb5t8EPd+9AwhdcY15IFYGJlKoH09+/fCeAgViiKAqvVKgCZ4/E4sfafP38m4fU/8sL2Dr8K4xgAAAAASUVORK5CYII=",[[46.0083251581089,-71.991704348775],[45.0083255354449,-70.991704741263]],0.8,null,"X3","X3"]},{"method":"removeLayersControl","args":[]},{"method":"addLayersControl","args":["OpenStreetMap",["X1","X2","X3"],{"collapsed":true,"autoZIndex":true,"position":"topleft"}]},{"method":"addControl","args":["","topright","imageValues-X3","info legend "]},{"method":"addImageQuery","args":["X3",[-71.991704348775,45.0083255354449,-70.991704741263,46.0083251581089],"mousemove",4,"Layer"]},{"method":"addLegend","args":[{"colors":["#4D4D4D , #666666 8.77696908314523%, #868686 24.1993346819119%, #A0A0A0 39.6217002806785%, #B4B4B4 55.0440658794452%, #C7C7C7 70.4664314782119%, #D7D7D7 85.8887970769785%, #E6E6E6 "],"labels":["-12.5","-12.0","-11.5","-11.0","-10.5","-10.0"],"na_color":null,"na_label":"NA","opacity":0.3,"position":"bottomleft","type":"numeric","title":"X3","extra":{"p_1":0.0877696908314523,"p_n":0.858887970769785},"layerId":null,"className":"info legend","group":"X3"}]}],"limits":{"lat":[45.0083255354449,46.0083251581089],"lng":[-71.991704348775,-70.991704741263]}},"evals":[],"jsHooks":{"render":[{"code":"function(el, x, data) {\n  return (\n      function(el, x, data) {\n      // get the leaflet map\n      var map = this; //HTMLWidgets.find('#' + el.id);\n      // we need a new div element because we have to handle\n      // the mouseover output separately\n      // debugger;\n      function addElement () {\n      // generate new div Element\n      var newDiv = $(document.createElement('div'));\n      // append at end of leaflet htmlwidget container\n      $(el).append(newDiv);\n      //provide ID and style\n      newDiv.addClass('lnlt');\n      newDiv.css({\n      'position': 'relative',\n      'bottomleft':  '0px',\n      'background-color': 'rgba(255, 255, 255, 0.7)',\n      'box-shadow': '0 0 2px #bbb',\n      'background-clip': 'padding-box',\n      'margin': '0',\n      'padding-left': '5px',\n      'color': '#333',\n      'font': '9px/1.5 \"Helvetica Neue\", Arial, Helvetica, sans-serif',\n      'z-index': '700',\n      });\n      return newDiv;\n      }\n\n\n      // check for already existing lnlt class to not duplicate\n      var lnlt = $(el).find('.lnlt');\n\n      if(!lnlt.length) {\n      lnlt = addElement();\n\n      // grab the special div we generated in the beginning\n      // and put the mousmove output there\n\n      map.on('mousemove', function (e) {\n      if (e.originalEvent.ctrlKey) {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                           ' lon: ' + (e.latlng.lng).toFixed(5) +\n                           ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                           ' | zoom: ' + map.getZoom() +\n                           ' | x: ' + L.CRS.EPSG3857.project(e.latlng).x.toFixed(0) +\n                           ' | y: ' + L.CRS.EPSG3857.project(e.latlng).y.toFixed(0) +\n                           ' | epsg: 3857 ' +\n                           ' | proj4: +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs ');\n      } else {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                      ' lon: ' + (e.latlng.lng).toFixed(5) +\n                      ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                      ' | zoom: ' + map.getZoom() + ' ');\n      }\n      });\n\n      // remove the lnlt div when mouse leaves map\n      map.on('mouseout', function (e) {\n      var strip = document.querySelector('.lnlt');\n      if( strip !==null) strip.remove();\n      });\n\n      };\n\n      //$(el).keypress(67, function(e) {\n      map.on('preclick', function(e) {\n      if (e.originalEvent.ctrlKey) {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                      ' lon: ' + (e.latlng.lng).toFixed(5) +\n                      ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                      ' | zoom: ' + map.getZoom() + ' ');\n      var txt = document.querySelector('.lnlt').textContent;\n      console.log(txt);\n      //txt.innerText.focus();\n      //txt.select();\n      setClipboardText('\"' + txt + '\"');\n      }\n      });\n\n      }\n      ).call(this.getMap(), el, x, data);\n}","data":null},{"code":"function(el, x, data) {\n  return (function(el,x,data){\n           var map = this;\n\n           map.on('keypress', function(e) {\n               console.log(e.originalEvent.code);\n               var key = e.originalEvent.code;\n               if (key === 'KeyE') {\n                   var bb = this.getBounds();\n                   var txt = JSON.stringify(bb);\n                   console.log(txt);\n\n                   setClipboardText('\\'' + txt + '\\'');\n               }\n           })\n        }).call(this.getMap(), el, x, data);\n}","data":null},{"code":"function(el, x, data) {\n  return (\n      function(el, x, data) {\n      // get the leaflet map\n      var map = this; //HTMLWidgets.find('#' + el.id);\n      // we need a new div element because we have to handle\n      // the mouseover output separately\n      // debugger;\n      function addElement () {\n      // generate new div Element\n      var newDiv = $(document.createElement('div'));\n      // append at end of leaflet htmlwidget container\n      $(el).append(newDiv);\n      //provide ID and style\n      newDiv.addClass('lnlt');\n      newDiv.css({\n      'position': 'relative',\n      'bottomleft':  '0px',\n      'background-color': 'rgba(255, 255, 255, 0.7)',\n      'box-shadow': '0 0 2px #bbb',\n      'background-clip': 'padding-box',\n      'margin': '0',\n      'padding-left': '5px',\n      'color': '#333',\n      'font': '9px/1.5 \"Helvetica Neue\", Arial, Helvetica, sans-serif',\n      'z-index': '700',\n      });\n      return newDiv;\n      }\n\n\n      // check for already existing lnlt class to not duplicate\n      var lnlt = $(el).find('.lnlt');\n\n      if(!lnlt.length) {\n      lnlt = addElement();\n\n      // grab the special div we generated in the beginning\n      // and put the mousmove output there\n\n      map.on('mousemove', function (e) {\n      if (e.originalEvent.ctrlKey) {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                           ' lon: ' + (e.latlng.lng).toFixed(5) +\n                           ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                           ' | zoom: ' + map.getZoom() +\n                           ' | x: ' + L.CRS.EPSG3857.project(e.latlng).x.toFixed(0) +\n                           ' | y: ' + L.CRS.EPSG3857.project(e.latlng).y.toFixed(0) +\n                           ' | epsg: 3857 ' +\n                           ' | proj4: +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs ');\n      } else {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                      ' lon: ' + (e.latlng.lng).toFixed(5) +\n                      ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                      ' | zoom: ' + map.getZoom() + ' ');\n      }\n      });\n\n      // remove the lnlt div when mouse leaves map\n      map.on('mouseout', function (e) {\n      var strip = document.querySelector('.lnlt');\n      if( strip !==null) strip.remove();\n      });\n\n      };\n\n      //$(el).keypress(67, function(e) {\n      map.on('preclick', function(e) {\n      if (e.originalEvent.ctrlKey) {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                      ' lon: ' + (e.latlng.lng).toFixed(5) +\n                      ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                      ' | zoom: ' + map.getZoom() + ' ');\n      var txt = document.querySelector('.lnlt').textContent;\n      console.log(txt);\n      //txt.innerText.focus();\n      //txt.select();\n      setClipboardText('\"' + txt + '\"');\n      }\n      });\n\n      }\n      ).call(this.getMap(), el, x, data);\n}","data":null},{"code":"function(el, x, data) {\n  return (function(el,x,data){\n           var map = this;\n\n           map.on('keypress', function(e) {\n               console.log(e.originalEvent.code);\n               var key = e.originalEvent.code;\n               if (key === 'KeyE') {\n                   var bb = this.getBounds();\n                   var txt = JSON.stringify(bb);\n                   console.log(txt);\n\n                   setClipboardText('\\'' + txt + '\\'');\n               }\n           })\n        }).call(this.getMap(), el, x, data);\n}","data":null},{"code":"function(el, x, data) {\n  return (\n      function(el, x, data) {\n      // get the leaflet map\n      var map = this; //HTMLWidgets.find('#' + el.id);\n      // we need a new div element because we have to handle\n      // the mouseover output separately\n      // debugger;\n      function addElement () {\n      // generate new div Element\n      var newDiv = $(document.createElement('div'));\n      // append at end of leaflet htmlwidget container\n      $(el).append(newDiv);\n      //provide ID and style\n      newDiv.addClass('lnlt');\n      newDiv.css({\n      'position': 'relative',\n      'bottomleft':  '0px',\n      'background-color': 'rgba(255, 255, 255, 0.7)',\n      'box-shadow': '0 0 2px #bbb',\n      'background-clip': 'padding-box',\n      'margin': '0',\n      'padding-left': '5px',\n      'color': '#333',\n      'font': '9px/1.5 \"Helvetica Neue\", Arial, Helvetica, sans-serif',\n      'z-index': '700',\n      });\n      return newDiv;\n      }\n\n\n      // check for already existing lnlt class to not duplicate\n      var lnlt = $(el).find('.lnlt');\n\n      if(!lnlt.length) {\n      lnlt = addElement();\n\n      // grab the special div we generated in the beginning\n      // and put the mousmove output there\n\n      map.on('mousemove', function (e) {\n      if (e.originalEvent.ctrlKey) {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                           ' lon: ' + (e.latlng.lng).toFixed(5) +\n                           ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                           ' | zoom: ' + map.getZoom() +\n                           ' | x: ' + L.CRS.EPSG3857.project(e.latlng).x.toFixed(0) +\n                           ' | y: ' + L.CRS.EPSG3857.project(e.latlng).y.toFixed(0) +\n                           ' | epsg: 3857 ' +\n                           ' | proj4: +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs ');\n      } else {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                      ' lon: ' + (e.latlng.lng).toFixed(5) +\n                      ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                      ' | zoom: ' + map.getZoom() + ' ');\n      }\n      });\n\n      // remove the lnlt div when mouse leaves map\n      map.on('mouseout', function (e) {\n      var strip = document.querySelector('.lnlt');\n      if( strip !==null) strip.remove();\n      });\n\n      };\n\n      //$(el).keypress(67, function(e) {\n      map.on('preclick', function(e) {\n      if (e.originalEvent.ctrlKey) {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                      ' lon: ' + (e.latlng.lng).toFixed(5) +\n                      ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                      ' | zoom: ' + map.getZoom() + ' ');\n      var txt = document.querySelector('.lnlt').textContent;\n      console.log(txt);\n      //txt.innerText.focus();\n      //txt.select();\n      setClipboardText('\"' + txt + '\"');\n      }\n      });\n\n      }\n      ).call(this.getMap(), el, x, data);\n}","data":null},{"code":"function(el, x, data) {\n  return (function(el,x,data){\n           var map = this;\n\n           map.on('keypress', function(e) {\n               console.log(e.originalEvent.code);\n               var key = e.originalEvent.code;\n               if (key === 'KeyE') {\n                   var bb = this.getBounds();\n                   var txt = JSON.stringify(bb);\n                   console.log(txt);\n\n                   setClipboardText('\\'' + txt + '\\'');\n               }\n           })\n        }).call(this.getMap(), el, x, data);\n}","data":null}]}}</script>
<p><br></p>
<p>Remarquer que vous pouvez sélectionner l’affichage de l’une ou l’autre des couches dans le menu apparaissant dans le coin gauche de la carte.</p>
</div>
<div id="lien-entre-rasterstack-et-objets-spatio-temporels" class="section level5 unnumbered hasAnchor">
<h5>Lien entre rasterStack et objets spatio-temporels<a href="lecon_spatiotemp.html#lien-entre-rasterstack-et-objets-spatio-temporels" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>Jusqu’ici nous avons implicitement utilisé un objet <code>rasterStack</code> comme un objet
spatio-temporel:</p>
<ul>
<li>chaque couche est bien un objet spatial (avec son étendue spatiale, sa projection, etc.)</li>
<li>les couches sont ordonnées dans le temps.</li>
</ul>
<p>Il est cependant important d’insister sur le fait qu’un <code>rasterStack</code> ne contient pas nécessairement un objet spatio-temporel. La seule contrainte sur les couches contenues est spatiale: étendue, projection et résolution doivent être identiques. Ainsi, il est commun de travailler sur une même période avec des objets <code>rasterStack</code> qui contiennent différentes variables pour une période donnée (par exemple, la température, les précipitations, l’élévation, etc.). Cela permet, entre autres, d’éviter la répétition des mêmes opérations sur plusieurs objets <code>rasterLayer</code>. Aussi, certaines données sont, par nature, multi-couches, c’est le cas des données d’imagerie satellitaire (on parle alors de bandes).</p>
<p>Jusqu’ici, nous n’avons pas formalisé l’utilisation du temps, nous savons simplement à quoi correspondent les différentes couches. Cette information a été donnée dans le texte plus haut. Toutefois, dans un contexte de partage de données, cette information aurait été ajoutée dans les métadonnées (les données qui décrivent les données).</p>
<p>Il existe cependant un moyen de formaliser un peu plus l’information qui ordonne les couches avec la fonction <code>setZ()</code>de la bibliothèque <code>raster</code>. Nous allons utiliser cette fonction pour associer une date à chacune des couches contenues dans le <code>rasterStack</code>.</p>
<p>En premier lieu, créons une séquence de date “mois/année”, que nous appèlerons <code>moan</code>, en utilisant les fonctions <code>R</code> <code>rep()</code> et <code>paste0()</code>:</p>
<div class="sourceCode" id="cb1344"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1344-1"><a href="lecon_spatiotemp.html#cb1344-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ci-dessous la séquence 1, 2..., 12 est répétée 10 fois (i.e. chacun des 12 mois pour chacune des 10 années)</span></span>
<span id="cb1344-2"><a href="lecon_spatiotemp.html#cb1344-2" aria-hidden="true" tabindex="-1"></a><span class="co"># et chacune des 10 années (2007, ..., 2016) est répétée consécutivement 12 fois</span></span>
<span id="cb1344-3"><a href="lecon_spatiotemp.html#cb1344-3" aria-hidden="true" tabindex="-1"></a>moan <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>, <span class="dv">10</span>), <span class="st">&quot;/&quot;</span>, <span class="fu">rep</span>(<span class="dv">2007</span><span class="sc">:</span><span class="dv">2016</span>, <span class="at">each =</span> <span class="dv">12</span>))</span>
<span id="cb1344-4"><a href="lecon_spatiotemp.html#cb1344-4" aria-hidden="true" tabindex="-1"></a>moan[<span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>]</span></code></pre></div>
<pre class="codeout"><code> [1] &quot;1/2007&quot;  &quot;2/2007&quot;  &quot;3/2007&quot;  &quot;4/2007&quot;  &quot;5/2007&quot; 
 [6] &quot;6/2007&quot;  &quot;7/2007&quot;  &quot;8/2007&quot;  &quot;9/2007&quot;  &quot;10/2007&quot;
[11] &quot;11/2007&quot; &quot;12/2007&quot;</code></pre>
<p><br></p>
<p>Nous utilisons ensuite la fonction <code>my()</code> de la bibliothèque <code>lubridate</code> pour formaliser la séquence de temps. Cette fonction transformera la séquence de caractères <code>moan</code> en objet de classe <code>date</code> donnant le mois et l’année (ainsi que le jour, correspondant au premier du mois par défaut).</p>
<div class="sourceCode" id="cb1346"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1346-1"><a href="lecon_spatiotemp.html#cb1346-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb1346-2"><a href="lecon_spatiotemp.html#cb1346-2" aria-hidden="true" tabindex="-1"></a>temps <span class="ot">&lt;-</span> <span class="fu">my</span>(moan)</span>
<span id="cb1346-3"><a href="lecon_spatiotemp.html#cb1346-3" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(temps)</span></code></pre></div>
<pre class="codeout"><code>[1] &quot;Date&quot;</code></pre>
<div class="sourceCode" id="cb1348"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1348-1"><a href="lecon_spatiotemp.html#cb1348-1" aria-hidden="true" tabindex="-1"></a>temps[<span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>]</span></code></pre></div>
<pre class="codeout"><code> [1] &quot;2007-01-01&quot; &quot;2007-02-01&quot; &quot;2007-03-01&quot;
 [4] &quot;2007-04-01&quot; &quot;2007-05-01&quot; &quot;2007-06-01&quot;
 [7] &quot;2007-07-01&quot; &quot;2007-08-01&quot; &quot;2007-09-01&quot;
[10] &quot;2007-10-01&quot; &quot;2007-11-01&quot; &quot;2007-12-01&quot;</code></pre>
<p><br></p>
<p>Le vecteur <code>temps</code> que nous venons de créer correspond à la date associée à chaque couche de l’objet <code>mint</code>.</p>
<p>Nous sommes alors en mesure d’ajouter cette information à <code>mint</code> en utilisant la fonction <code>setZ()</code>. Notons que la longueur de cette séquence doit correspondre au nombre de couches du <code>rasterStack</code>, soit <code>nlayers(mint)</code> dans le cas présent, sinon un message d’erreur sera retourné.</p>
<div class="sourceCode" id="cb1350"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1350-1"><a href="lecon_spatiotemp.html#cb1350-1" aria-hidden="true" tabindex="-1"></a>mint <span class="ot">&lt;-</span> <span class="fu">setZ</span>(mint, temps, <span class="at">name =</span> <span class="st">&quot;temps&quot;</span>)</span>
<span id="cb1350-2"><a href="lecon_spatiotemp.html#cb1350-2" aria-hidden="true" tabindex="-1"></a>mint</span></code></pre></div>
<pre class="codeout"><code>class      : RasterStack 
dimensions : 60, 60, 3600, 120  (nrow, ncol, ncell, nlayers)
resolution : 0.01667, 0.01667  (x, y)
extent     : -71.99, -70.99, 45.01, 46.01  (xmin, xmax, ymin, ymax)
crs        : +proj=longlat +ellps=WGS84 +no_defs 
names      :    X1,    X2,    X3,    X4,    X5,    X6,    X7,    X8,    X9,   X10,   X11,   X12,   X13,   X14,   X15, ... 
min values : -16.2, -19.9, -12.8,  -4.5,   2.4,   8.2,   9.7,   9.2,   6.3,   2.7,  -7.1, -13.6, -13.9, -14.5, -13.9, ... 
max values : -13.9, -18.0,  -9.5,  -0.6,   5.5,  11.8,  13.0,  11.7,   8.7,   5.3,  -4.0, -10.6, -11.8, -12.7, -10.0, ... 
temps       : 2007-01-01 - 2016-12-01 (range)</code></pre>
<p><br></p>
<p>Nous pouvons constater qu’une ligne “<code>temps</code>” a été ajoutée, résumant cette nouvelle information. Ces données sont facilement accessibles avec <code>getZ()</code> qui nous retourne les valeurs de ce nouvel axe z.</p>
<div class="sourceCode" id="cb1352"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1352-1"><a href="lecon_spatiotemp.html#cb1352-1" aria-hidden="true" tabindex="-1"></a><span class="fu">getZ</span>(mint)[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>]</span></code></pre></div>
<pre class="codeout"><code> [1] &quot;2007-01-01&quot; &quot;2007-02-01&quot; &quot;2007-03-01&quot;
 [4] &quot;2007-04-01&quot; &quot;2007-05-01&quot; &quot;2007-06-01&quot;
 [7] &quot;2007-07-01&quot; &quot;2007-08-01&quot; &quot;2007-09-01&quot;
[10] &quot;2007-10-01&quot;</code></pre>
<p><br></p>
<p>La couche <code>mint</code> pour une année donnée le long de cette axe de temps est accessible en utilisant <code>[[</code>. Par exemple, la première couche est :</p>
<div class="sourceCode" id="cb1354"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1354-1"><a href="lecon_spatiotemp.html#cb1354-1" aria-hidden="true" tabindex="-1"></a>mint[[<span class="dv">1</span>]]</span></code></pre></div>
<pre class="codeout"><code>class      : RasterLayer 
band       : 1  (of  120  bands)
dimensions : 60, 60, 3600  (nrow, ncol, ncell)
resolution : 0.01667, 0.01667  (x, y)
extent     : -71.99, -70.99, 45.01, 46.01  (xmin, xmax, ymin, ymax)
crs        : +proj=longlat +ellps=WGS84 +no_defs 
source     : mint.nc 
names      : X1 
values     : -16.2, -13.9  (min, max)
temps      : 2007-01-01 
zvar       : variable </code></pre>
<p><br></p>
<p>Il devient alors plus aisé de trier les couches sur la date. Par exemple, nous pouvons sélectionner toutes les couches de 2015 en utilisant <code>year()</code> de <code>lubridate</code>.</p>
<div class="sourceCode" id="cb1356"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1356-1"><a href="lecon_spatiotemp.html#cb1356-1" aria-hidden="true" tabindex="-1"></a>mint[[<span class="fu">which</span>(<span class="fu">year</span>(<span class="fu">getZ</span>(mint)) <span class="sc">==</span> <span class="dv">2015</span>)]]</span></code></pre></div>
<pre class="codeout"><code>class      : RasterStack 
dimensions : 60, 60, 3600, 12  (nrow, ncol, ncell, nlayers)
resolution : 0.01667, 0.01667  (x, y)
extent     : -71.99, -70.99, 45.01, 46.01  (xmin, xmax, ymin, ymax)
crs        : +proj=longlat +ellps=WGS84 +no_defs 
names      :   X97,   X98,   X99,  X100,  X101,  X102,  X103,  X104,  X105,  X106,  X107,  X108 
min values : -20.4, -23.2, -15.5,  -5.6,   4.8,   6.9,  10.6,  11.5,   8.6,  -1.7,  -4.0,  -5.7 
max values : -18.6, -22.0, -11.5,  -1.3,   8.1,  10.4,  14.1,  15.0,  11.5,   1.1,  -0.9,  -1.8 
temps       : 2015-01-01, 2015-02-01, 2015-03-01, 2015-04-01, 2015-05-01, 2015-06-01, 2015-07-01, 2015-08-01, 2015-09-01, 2015-10-01, 2015-11-01, 2015-12-01 </code></pre>
<p><br></p>
<p>Rappelons ici que la fonction <code>which()</code> retourne les indices des éléments qui satisfont à la condition.</p>
<!--  Notons qu'ici l'appel à `which()` est important, nous ne pouvons pas utiliser un vecteur de logique dans `[[` (ce qui nous permettrait de nous passer de `which()`), sinon une erreur est retournée.-->
<p><br></p>
</div>
</div>
<div id="mois-de-plus-faible-pluviométrie" class="section level4 hasAnchor" number="9.1.3.3">
<h4><span class="header-section-number">9.1.3.3</span> Mois de plus faible pluviométrie<a href="lecon_spatiotemp.html#mois-de-plus-faible-pluviométrie" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Nous sommes maintenant en mesure de répondre à la première question :</p>
<blockquote>
<p><strong>Quel mois dispose du plus faible niveau de pluviométrie dans la région du Parc national du Mont-Mégantic?</strong></p>
</blockquote>
<p><br></p>
<p>Pour ce faire, nous devons réaliser trois étapes :</p>
<blockquote>
<ol style="list-style-type: decimal">
<li>Isoler les cellules du <em>rasterstack</em> <code>pcp</code> qui correspondent à la zone du Parc national du Mont-Mégantic.</li>
<li>Calculer la pluviométrie moyenne pour toutes les couches (c’est-à-dire tous les mois).</li>
<li>Déterminer le mois et l’année pour lequel la pluviométrie moyenne ainsi calculée est la plus faible.</li>
</ol>
</blockquote>
<p><br></p>
<p>Commençons!</p>
<div id="cellules-du-parc-national-du-mont-mégantic" class="section level6 unnumbered hasAnchor">
<h6>1. Cellules du Parc national du Mont-Mégantic<a href="lecon_spatiotemp.html#cellules-du-parc-national-du-mont-mégantic" class="anchor-section" aria-label="Anchor link to header"></a></h6>
<p>Nous décidons de prendre les cellules de nos couches qui sont à l’intérieur du Parc du Mont-Mégantic ainsi que les cellules qui sont proches du parc, dans un rayon de 5 km. Cette opération de <em>buffer</em> est très souvent utilisée pour augmenter la couverture spatiale et ainsi obtenir une moyenne climatique à une plus large échelle. Nous commençons donc par extraire les limites du parc de l’objet <code>parcs</code> et nous y ajoutons une zone tampon de 5 km.</p>
<div class="sourceCode" id="cb1358"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1358-1"><a href="lecon_spatiotemp.html#cb1358-1" aria-hidden="true" tabindex="-1"></a>megantic <span class="ot">&lt;-</span> parcs[<span class="dv">2</span>, ]</span>
<span id="cb1358-2"><a href="lecon_spatiotemp.html#cb1358-2" aria-hidden="true" tabindex="-1"></a>megantic_buf <span class="ot">&lt;-</span> <span class="fu">st_buffer</span>(megantic, <span class="at">dist =</span> <span class="dv">5000</span>)</span></code></pre></div>
<p><br></p>
<p>Ici <code>dist = 5000</code>, car les distances sont à exprimer en mètre, nous pouvons le savoir en regardant le champ <code>units</code> retourner par <code>st_crs()</code>.</p>
<div class="sourceCode" id="cb1359"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1359-1"><a href="lecon_spatiotemp.html#cb1359-1" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(parcs)<span class="sc">$</span>units  </span></code></pre></div>
<pre class="codeout"><code>[1] &quot;m&quot;</code></pre>
<p><br></p>
<p>Nous affichons maintenant, les deux objets : les limites du parc et les mêmes limites auxquelles une zone tampon de 5 km a été ajoutée.</p>
<div class="sourceCode" id="cb1361"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1361-1"><a href="lecon_spatiotemp.html#cb1361-1" aria-hidden="true" tabindex="-1"></a>parc_buffer <span class="ot">&lt;-</span> <span class="fu">mapview</span>(megantic, <span class="at">col.regions =</span> <span class="st">&quot;seagreen&quot;</span>) <span class="sc">+</span> <span class="fu">mapview</span>(megantic_buf, <span class="at">col.regions =</span> <span class="st">&quot;lightgreen&quot;</span>) </span>
<span id="cb1361-2"><a href="lecon_spatiotemp.html#cb1361-2" aria-hidden="true" tabindex="-1"></a>parc_buffer<span class="sc">@</span>map</span></code></pre></div>
<div class="leaflet html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-a5d46a8fca84e2aa8900" style="width:720px;height:720px;"></div>
<script type="application/json" data-for="htmlwidget-a5d46a8fca84e2aa8900">{"x":{"options":{"minZoom":1,"maxZoom":52,"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}},"preferCanvas":false,"bounceAtZoomLimits":false,"maxBounds":[[[-90,-370]],[[90,370]]]},"calls":[{"method":"addProviderTiles","args":["OpenStreetMap","OpenStreetMap","OpenStreetMap",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"createMapPane","args":["polygon",420]},{"method":"addFlatGeoBuf","args":["megantic","megantic",null,true,"mvFeatureId",{"radius":6,"stroke":true,"color":"#333333","weight":0.5,"opacity":0.9,"fill":true,"fillColor":"#2E8B57","fillOpacity":0.6},{"className":"","pane":"polygon"},"mapview-popup",{"radius":{"to":[3,15],"from":[3,15]},"weight":{"to":[1,10],"from":[1,10]},"opacity":{"to":[0,1],"from":[0,1]},"fillOpacity":{"to":[0,1],"from":[0,1]}}]},{"method":"addScaleBar","args":[{"maxWidth":100,"metric":true,"imperial":true,"updateWhenIdle":true,"position":"bottomleft"}]},{"method":"addHomeButton","args":[-71.228534213,45.4015032000001,-71.084892033,45.4941795190001,true,"megantic","Zoom to megantic","<strong> megantic <\/strong>","bottomright"]},{"method":"addLegend","args":[{"colors":["#2E8B57"],"labels":["megantic"],"na_color":null,"na_label":"NA","opacity":0.3,"position":"bottomleft","type":"factor","title":"","extra":null,"layerId":null,"className":"info legend","group":"megantic"}]},{"method":"addFlatGeoBuf","args":["megantic_buf","megantic_buf",null,true,"mvFeatureId",{"radius":6,"stroke":true,"color":"#333333","weight":0.5,"opacity":0.9,"fill":true,"fillColor":"#90EE90","fillOpacity":0.6},{"className":"","pane":"polygon"},"mapview-popup",{"radius":{"to":[3,15],"from":[3,15]},"weight":{"to":[1,10],"from":[1,10]},"opacity":{"to":[0,1],"from":[0,1]},"fillOpacity":{"to":[0,1],"from":[0,1]}}]},{"method":"addHomeButton","args":[-71.2924212544673,45.3565831815223,-71.0210304179347,45.5391106563517,true,"megantic_buf","Zoom to megantic_buf","<strong> megantic_buf <\/strong>","bottomright"]},{"method":"addLayersControl","args":["OpenStreetMap",["megantic","megantic_buf"],{"collapsed":true,"autoZIndex":true,"position":"topleft"}]},{"method":"addLegend","args":[{"colors":["#90EE90"],"labels":["megantic_buf"],"na_color":null,"na_label":"NA","opacity":0.3,"position":"bottomleft","type":"factor","title":"","extra":null,"layerId":null,"className":"info legend","group":"megantic_buf"}]},{"method":"addHomeButton","args":[-71.2924212544673,45.3565831815223,-71.0210304179347,45.5391106563517,true,null,"Zoom to full extent","<strong>Zoom full<\/strong>","bottomleft"]}],"fitBounds":[45.3565831815223,-71.2924212544673,45.5391106563517,-71.0210304179347,[]]},"evals":[],"jsHooks":{"render":[{"code":"function(el, x, data) {\n  return (\n      function(el, x, data) {\n      // get the leaflet map\n      var map = this; //HTMLWidgets.find('#' + el.id);\n      // we need a new div element because we have to handle\n      // the mouseover output separately\n      // debugger;\n      function addElement () {\n      // generate new div Element\n      var newDiv = $(document.createElement('div'));\n      // append at end of leaflet htmlwidget container\n      $(el).append(newDiv);\n      //provide ID and style\n      newDiv.addClass('lnlt');\n      newDiv.css({\n      'position': 'relative',\n      'bottomleft':  '0px',\n      'background-color': 'rgba(255, 255, 255, 0.7)',\n      'box-shadow': '0 0 2px #bbb',\n      'background-clip': 'padding-box',\n      'margin': '0',\n      'padding-left': '5px',\n      'color': '#333',\n      'font': '9px/1.5 \"Helvetica Neue\", Arial, Helvetica, sans-serif',\n      'z-index': '700',\n      });\n      return newDiv;\n      }\n\n\n      // check for already existing lnlt class to not duplicate\n      var lnlt = $(el).find('.lnlt');\n\n      if(!lnlt.length) {\n      lnlt = addElement();\n\n      // grab the special div we generated in the beginning\n      // and put the mousmove output there\n\n      map.on('mousemove', function (e) {\n      if (e.originalEvent.ctrlKey) {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                           ' lon: ' + (e.latlng.lng).toFixed(5) +\n                           ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                           ' | zoom: ' + map.getZoom() +\n                           ' | x: ' + L.CRS.EPSG3857.project(e.latlng).x.toFixed(0) +\n                           ' | y: ' + L.CRS.EPSG3857.project(e.latlng).y.toFixed(0) +\n                           ' | epsg: 3857 ' +\n                           ' | proj4: +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs ');\n      } else {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                      ' lon: ' + (e.latlng.lng).toFixed(5) +\n                      ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                      ' | zoom: ' + map.getZoom() + ' ');\n      }\n      });\n\n      // remove the lnlt div when mouse leaves map\n      map.on('mouseout', function (e) {\n      var strip = document.querySelector('.lnlt');\n      if( strip !==null) strip.remove();\n      });\n\n      };\n\n      //$(el).keypress(67, function(e) {\n      map.on('preclick', function(e) {\n      if (e.originalEvent.ctrlKey) {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                      ' lon: ' + (e.latlng.lng).toFixed(5) +\n                      ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                      ' | zoom: ' + map.getZoom() + ' ');\n      var txt = document.querySelector('.lnlt').textContent;\n      console.log(txt);\n      //txt.innerText.focus();\n      //txt.select();\n      setClipboardText('\"' + txt + '\"');\n      }\n      });\n\n      }\n      ).call(this.getMap(), el, x, data);\n}","data":null},{"code":"function(el, x, data) {\n  return (function(el,x,data){\n           var map = this;\n\n           map.on('keypress', function(e) {\n               console.log(e.originalEvent.code);\n               var key = e.originalEvent.code;\n               if (key === 'KeyE') {\n                   var bb = this.getBounds();\n                   var txt = JSON.stringify(bb);\n                   console.log(txt);\n\n                   setClipboardText('\\'' + txt + '\\'');\n               }\n           })\n        }).call(this.getMap(), el, x, data);\n}","data":null}]}}</script>
<p><br></p>
<p>Nous allons maintenant appeler la fonction <code>mask()</code> de la bibliothèque <code>raster</code> pour extraire les cellules désirées du <em>raster</em> <code>pcp</code> (précipitations cumulées). Utiliser cette fonction nous permet de visualiser spatialement les données extraites, mais notons que nous aurions pu aussi utiliser la fonction <code>extract()</code> pour répondre à la question.</p>
<div class="sourceCode" id="cb1362"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1362-1"><a href="lecon_spatiotemp.html#cb1362-1" aria-hidden="true" tabindex="-1"></a>pcp_megantic <span class="ot">&lt;-</span> <span class="fu">mask</span>(pcp, <span class="fu">st_transform</span>(megantic_buf, <span class="fu">st_crs</span>(pcp)))</span></code></pre></div>
<p><br></p>
<p>Notez également, que nous nous sommes assurés que le <em>raster</em> utilisé pour créer le masque soit dans le même système de coordonnées de référence que le <code>rasterStack</code> interrogé.</p>
<p>Visualisons les quatres premières couches de <code>pcp_megantic</code> :</p>
<div class="sourceCode" id="cb1363"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1363-1"><a href="lecon_spatiotemp.html#cb1363-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(pcp_megantic[[<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>]])</span></code></pre></div>
<p><img src="Cours_SpatialR_files/figure-html/plot_pcp_megantic-1.png" width="720" style="display: block; margin: auto;" />
<br></p>
<p>Celles-ci correspondent aux précipitations cumulées dans la région autour du Parc national du Mont-Mégantic pour les quatre premiers mois répertoriés.</p>
</div>
<div id="calculer-la-pluviométrie-moyenne-pour-toutes-les-couches" class="section level6 unnumbered hasAnchor">
<h6>2. Calculer la pluviométrie moyenne pour toutes les couches<a href="lecon_spatiotemp.html#calculer-la-pluviométrie-moyenne-pour-toutes-les-couches" class="anchor-section" aria-label="Anchor link to header"></a></h6>
<p>Nous pouvons alors extraire les valeurs des différentes couches avec la fonction <code>getValues()</code> et faire la moyenne couche par couche (c’est-à-dire mois par mois) en utilisant les fonctions <code>R</code> <code>apply()</code> et <code>mean()</code>, sans oublier d’enlever les valeurs non attribuées (<code>NA</code>).</p>
<div class="sourceCode" id="cb1364"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1364-1"><a href="lecon_spatiotemp.html#cb1364-1" aria-hidden="true" tabindex="-1"></a>mean_pcp <span class="ot">&lt;-</span> <span class="fu">apply</span>(<span class="fu">getValues</span>(pcp_megantic), <span class="dv">2</span>, mean, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p><br></p>
<p>Rappelez-vous que l’argument 2 signifie que la fonction <code>mean()</code> est appliquée sur la deuxième dimension de la matrice <code>getValues(pcp_megantic)</code> (c’est-à-dire la dimension associée aux couches).</p>
<p>Utilisons le vecteur <code>temps</code> créé plus tôt pour visualisons le changement dans les précipitations cumulées moyennes en fonction du temps :</p>
<div class="sourceCode" id="cb1365"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1365-1"><a href="lecon_spatiotemp.html#cb1365-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(temps, mean_pcp)</span></code></pre></div>
<p><img src="Cours_SpatialR_files/figure-html/mean_pcp_plot-1.png" width="720" style="display: block; margin: auto;" />
<br></p>
</div>
<div id="déterminer-le-mois-de-plus-faible-pluviométrie-moyenne" class="section level6 unnumbered hasAnchor">
<h6>3. Déterminer le mois de plus faible pluviométrie moyenne<a href="lecon_spatiotemp.html#déterminer-le-mois-de-plus-faible-pluviométrie-moyenne" class="anchor-section" aria-label="Anchor link to header"></a></h6>
<p>Nous sommes maintenant en mesure de chercher le minimum de ces moyennes.</p>
<div class="sourceCode" id="cb1366"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1366-1"><a href="lecon_spatiotemp.html#cb1366-1" aria-hidden="true" tabindex="-1"></a><span class="fu">min</span>(mean_pcp)</span></code></pre></div>
<pre class="codeout"><code>[1] 39.81</code></pre>
<p><br></p>
<p>Cette valeur correspond à la plus faible pluviométrie moyenne. Pour quel mois cette valeur a-t-elle été enregistrée?</p>
<div class="sourceCode" id="cb1368"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1368-1"><a href="lecon_spatiotemp.html#cb1368-1" aria-hidden="true" tabindex="-1"></a><span class="fu">which.min</span>(mean_pcp)</span></code></pre></div>
<pre class="codeout"><code>X71 
 71 </code></pre>
<div class="sourceCode" id="cb1370"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1370-1"><a href="lecon_spatiotemp.html#cb1370-1" aria-hidden="true" tabindex="-1"></a>temps[<span class="fu">which.min</span>(mean_pcp)]</span></code></pre></div>
<pre class="codeout"><code>[1] &quot;2012-11-01&quot;</code></pre>
<div class="sourceCode" id="cb1372"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1372-1"><a href="lecon_spatiotemp.html#cb1372-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ou encore</span></span>
<span id="cb1372-2"><a href="lecon_spatiotemp.html#cb1372-2" aria-hidden="true" tabindex="-1"></a><span class="fu">getZ</span>(mint)[<span class="fu">which.min</span>(mean_pcp)]</span></code></pre></div>
<pre class="codeout"><code>[1] &quot;2012-11-01&quot;</code></pre>
<p><br></p>
<p>C’est la couche 71 qui présente la plus faible valeur moyenne des précipitations totales, cette couche correspond au mois de novembre 2012.</p>
<p><br></p>
</div>
</div>
<div id="points-les-plus-chauds" class="section level4 hasAnchor" number="9.1.3.4">
<h4><span class="header-section-number">9.1.3.4</span> Points les plus chauds<a href="lecon_spatiotemp.html#points-les-plus-chauds" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Nous allons maintenant répondre à la deuxième question :</p>
<blockquote>
<p><strong>Où se situe le (ou les) point(s) le(s) plus chaud(s) dans la région du Parc national du Mont-Mégantic? </strong></p>
</blockquote>
<p><br></p>
<p>Pour ce faire, nous allons réaliser deux étapes :</p>
<blockquote>
<ol style="list-style-type: decimal">
<li>Isoler les cellules de <code>maxt</code> qui correspondent à la zone du parc du Mont-Mégantic.</li>
<li>Trouver la ou les cellules pour laquelle cette valeur est maximale.</li>
</ol>
</blockquote>
<p><br></p>
<p>Commençons!</p>
<div id="cellules-du-parc-national-du-mont-mégantic-1" class="section level6 unnumbered hasAnchor">
<h6>1. Cellules du Parc national du Mont-Mégantic<a href="lecon_spatiotemp.html#cellules-du-parc-national-du-mont-mégantic-1" class="anchor-section" aria-label="Anchor link to header"></a></h6>
<p>Pour répondre à cette question, nous utilisons seulement les cellules contenues dans les limites du Parc national du Mont-Mégantic. Ainsi, nous n’ajouterons pas de zone tampon autour du parc.</p>
<p>Nous appliquons la fonction <code>mask()</code> au <code>rasterStack</code> <code>maxt</code> qui contient les températures maximales moyennes en utilisant les limites du parc. Comme nous avons déjà réalisé des opérations de <code>mask()</code> à plusieurs reprises, nous allons faire cette première étape à l’aide d’une seule ligne de commande.</p>
<div class="sourceCode" id="cb1374"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1374-1"><a href="lecon_spatiotemp.html#cb1374-1" aria-hidden="true" tabindex="-1"></a>maxt_megantic <span class="ot">&lt;-</span> <span class="fu">mask</span>(maxt, <span class="fu">st_transform</span>(megantic, <span class="fu">st_crs</span>(maxt)))</span></code></pre></div>
<p><br></p>
</div>
<div id="cellules-de-température-maximale" class="section level6 unnumbered hasAnchor">
<h6>2. Cellules de température maximale<a href="lecon_spatiotemp.html#cellules-de-température-maximale" class="anchor-section" aria-label="Anchor link to header"></a></h6>
<p>Pour la seconde étape, il y a plusieurs façons de procéder. Ici, nous allons procéder en deux temps : nous allons d’abord trouver la couche (ou les couches) qui contient (ou contiennent) la valeur de température maximale, puis trouver les coordonnées du point (ou des points) associées. Nous calculons donc le maximum pour chaque couche, puis nous déterminons quel est le maximum de ces maxima.</p>
<div class="sourceCode" id="cb1375"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1375-1"><a href="lecon_spatiotemp.html#cb1375-1" aria-hidden="true" tabindex="-1"></a>id <span class="ot">&lt;-</span> <span class="fu">which.max</span>(<span class="fu">apply</span>(<span class="fu">getValues</span>(maxt_megantic), <span class="dv">2</span>, max, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb1375-2"><a href="lecon_spatiotemp.html#cb1375-2" aria-hidden="true" tabindex="-1"></a>id</span></code></pre></div>
<pre class="codeout"><code>X43 
 43 </code></pre>
<p><br></p>
<p>Notez que la fonction <code>apply()</code> calcule le maximum pour chacune des couches contenues dans <code>maxt_megantic</code>, alors que le fonction <code>which.max()</code> détermine l’indice de la couche qui contient le maximum de ces maxima.</p>
<p>C’est donc la couche 43 qui contient ce maximum.</p>
<p>Nous pouvons également déterminer que c’est au mois de juillet 2010 que ce maximum a été atteint :</p>
<div class="sourceCode" id="cb1377"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1377-1"><a href="lecon_spatiotemp.html#cb1377-1" aria-hidden="true" tabindex="-1"></a>temps[id]</span></code></pre></div>
<pre class="codeout"><code>[1] &quot;2010-07-01&quot;</code></pre>
<p><br></p>
<p>et que cette température était de 24.7°C :</p>
<div class="sourceCode" id="cb1379"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1379-1"><a href="lecon_spatiotemp.html#cb1379-1" aria-hidden="true" tabindex="-1"></a><span class="fu">max</span>(<span class="fu">apply</span>(<span class="fu">getValues</span>(maxt_megantic), <span class="dv">2</span>, max, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span></code></pre></div>
<pre class="codeout"><code>[1] 24.7</code></pre>
<p><br></p>
<p>Utilisons maintenant la fonction <code>xyFromCell()</code> de la bibliothèque <code>raster</code> pour déterminer les coordonnées spatiales auxquelles cette température a été enregistrée.</p>
<div class="sourceCode" id="cb1381"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1381-1"><a href="lecon_spatiotemp.html#cb1381-1" aria-hidden="true" tabindex="-1"></a><span class="fu">xyFromCell</span>(maxt_megantic[[id]], <span class="fu">which.max</span>(maxt_megantic[[id]]))</span></code></pre></div>
<pre class="codeout"><code>          x     y
[1,] -71.22 45.48
[2,] -71.20 45.42
[3,] -71.18 45.42</code></pre>
<p><br></p>
<p>Rappelons que la fonction <code>xyFromCell(A,id)</code> détermine les coordonnées (x,y) de la cellule d’un <em>raster</em> <code>A</code> dont l’indice est <code>id</code>. Ainsi, dans la ligne de code précédente, le premier argument de la fonction <code>xyFromCell()</code> correspond au <em>raster</em> au sein duquel on recherche les coordonnées (x,y). Dans le cas présent, ce <em>raster</em> est la couche 43 du <code>rasterStack</code> <code>maxt_megantic</code>. Le deuxième argument correspond à l’indice de la ou des cellules qui contiennent le maximum.</p>
<p>Ainsi, la température maximale a été enregistrée sur trois cellules à l’intérieur du parc.</p>
<p><br></p>
</div>
</div>
<div id="profils-de-temperatures-et-de-precipitations" class="section level4 hasAnchor" number="9.1.3.5">
<h4><span class="header-section-number">9.1.3.5</span> Profils de temperatures et de precipitations<a href="lecon_spatiotemp.html#profils-de-temperatures-et-de-precipitations" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Nous allons maintenant réaliser des profils de températures et de précipitations. Ces profils correspondent à l’évolution temporelle des températures (maximales et minimales) et des précipitations moyennes. Plus précisément, nous cherchons à créer des graphiques où l’ordonnée correspondra à l’une des trois valeurs environnementales moyennes et l’abscisse au temps, selon une résolution mensuelle.</p>
<p>Pour réaliser ces profils, nous allons faire une moyenne pour chaque couche des valeurs puis les afficher en fonction du temps. Nous allons répéter trois fois la même opération ici (une fois pour chaque <code>rasterStack</code>: <code>maxt.nc</code>, <code>mint.nc</code> et <code>pcp.nc</code>). Au lieu de copier/coller notre code pour les trois sources de données, nous allons créer une fonction <code>profil()</code>. Cette fonction prend en intrant <code>ras</code>, un objet <code>rasterLayer</code> ou <code>rasterStack</code> et <code>masque</code>, l’objet spatial qui sera utilisé pour découper le <em>raster</em>.</p>
<div class="sourceCode" id="cb1383"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1383-1"><a href="lecon_spatiotemp.html#cb1383-1" aria-hidden="true" tabindex="-1"></a>profil <span class="ot">&lt;-</span> <span class="cf">function</span>(ras, masque) {</span>
<span id="cb1383-2"><a href="lecon_spatiotemp.html#cb1383-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># l&#39;argument masque doit utiliser le même SCR que ras</span></span>
<span id="cb1383-3"><a href="lecon_spatiotemp.html#cb1383-3" aria-hidden="true" tabindex="-1"></a>  masque_crs <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(masque, <span class="fu">st_crs</span>(ras))</span>
<span id="cb1383-4"><a href="lecon_spatiotemp.html#cb1383-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># extraire les valeurs de ras au sein du masque ainsi créé</span></span>
<span id="cb1383-5"><a href="lecon_spatiotemp.html#cb1383-5" aria-hidden="true" tabindex="-1"></a>  ras_extract <span class="ot">&lt;-</span> <span class="fu">extract</span>(ras, masque_crs)[[<span class="dv">1</span>]]</span>
<span id="cb1383-6"><a href="lecon_spatiotemp.html#cb1383-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># notons que la fonction `extract()` permet de faire des extractions </span></span>
<span id="cb1383-7"><a href="lecon_spatiotemp.html#cb1383-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># pour plusieurs polygones, ici masque_crs n&#39;aura qu&#39;un seul polygon et nous </span></span>
<span id="cb1383-8"><a href="lecon_spatiotemp.html#cb1383-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># utilisons donc que le premier élément de la liste retournée par `extract()` </span></span>
<span id="cb1383-9"><a href="lecon_spatiotemp.html#cb1383-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># calculer la moyenne pour chaque couche</span></span>
<span id="cb1383-10"><a href="lecon_spatiotemp.html#cb1383-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">apply</span>(ras_extract, <span class="dv">2</span>, mean, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1383-11"><a href="lecon_spatiotemp.html#cb1383-11" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><br></p>
<p>Cette fonction nous permet donc d’obtenir les valeurs environnementales moyennes à mettre en ordonnées de nos profils. Il nous reste à obtenir les valeurs des abscisses, autrement dit les dates pour chacune des moyennes. Comme les dates sont les mêmes pour <code>mint</code>, <code>maxt</code> et <code>pcp</code>, nous utilisons <code>getZ(mint)</code> qui nous donne exactement ce dont nous avons besoin. Notez que nous pouvons également utiliser le vecteur <code>temps</code> créé plus tôt.</p>
<p>Nous allons maintenant créer la figure. Celle-ci contiendra trois panneaux. Chaque panneau appelle la fonction <code>profil()</code> que nous venons de créer avec en argument l’une ou l’autre des variables environnementales (<code>mint</code>, <code>maxt</code> et <code>pcp</code>) ainsi que le <em>raster</em> correspondant aux frontières élargies du Parc national du Mont-Mégantic,<code>megantic_buf</code>.</p>
<p>Pour illustrer les températures, nous utilisons des lignes et pour les précipitations nous utilisons des barres, ces réglages peuvent se faire avec l’argument <code>type</code> de la fonction <code>plot()</code>. Enfin comme l’axe des abscisses est identique pour les trois panneaux, nous ajoutons un titre seulement à cet axe, donc seulement pour le dernier panneau.</p>
<div class="sourceCode" id="cb1384"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1384-1"><a href="lecon_spatiotemp.html#cb1384-1" aria-hidden="true" tabindex="-1"></a><span class="co"># figures de trois lignes et 1 seule colonne</span></span>
<span id="cb1384-2"><a href="lecon_spatiotemp.html#cb1384-2" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">1</span>), <span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb1384-3"><a href="lecon_spatiotemp.html#cb1384-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">getZ</span>(mint), <span class="fu">profil</span>(mint, megantic_buf), </span>
<span id="cb1384-4"><a href="lecon_spatiotemp.html#cb1384-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">&quot;l&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;Températures minimales (°C)&quot;</span>, <span class="at">xlab =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb1384-5"><a href="lecon_spatiotemp.html#cb1384-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">getZ</span>(mint), <span class="fu">profil</span>(maxt, megantic_buf), </span>
<span id="cb1384-6"><a href="lecon_spatiotemp.html#cb1384-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">&quot;l&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;Températures maximales (°C)&quot;</span>, <span class="at">xlab =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb1384-7"><a href="lecon_spatiotemp.html#cb1384-7" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">getZ</span>(mint), <span class="fu">profil</span>(pcp, megantic_buf), </span>
<span id="cb1384-8"><a href="lecon_spatiotemp.html#cb1384-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">&quot;h&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;Précipitations totales (mm)&quot;</span>, <span class="at">xlab =</span> <span class="st">&quot;Années&quot;</span>)</span></code></pre></div>
<p><img src="Cours_SpatialR_files/figure-html/profils-1.png" width="720" style="display: block; margin: auto;" />
<br></p>
<p>Ces profils, s’échelonnant sur plusieurs années, nous permettent d’observer la périodicité annuelle des variables environnementales illustrées.</p>
</div>
<div id="animations" class="section level4 hasAnchor" number="9.1.3.6">
<h4><span class="header-section-number">9.1.3.6</span> Animations<a href="lecon_spatiotemp.html#animations" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Pour finir, nous allons animer les profils que nous venons de dessiner.</p>
<p>Ici, au lieu d’appeler la fonction <code>profil()</code> dans la fonction <code>plot()</code>, comme fait précédemment, nous calculons les profils des trois variables environnementales (<code>mint</code>, <code>maxt</code> et <code>pcp</code>) en amont. Cela permet de gagner du temps de calcul.</p>
<div class="sourceCode" id="cb1385"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1385-1"><a href="lecon_spatiotemp.html#cb1385-1" aria-hidden="true" tabindex="-1"></a>pr_mint <span class="ot">&lt;-</span> <span class="fu">profil</span>(mint, megantic_buf)</span>
<span id="cb1385-2"><a href="lecon_spatiotemp.html#cb1385-2" aria-hidden="true" tabindex="-1"></a>pr_maxt <span class="ot">&lt;-</span> <span class="fu">profil</span>(maxt, megantic_buf)</span>
<span id="cb1385-3"><a href="lecon_spatiotemp.html#cb1385-3" aria-hidden="true" tabindex="-1"></a>pr_pcp <span class="ot">&lt;-</span> <span class="fu">profil</span>(pcp, megantic_buf)</span></code></pre></div>
<p><br></p>
<p>Nous allons maintenant créer une nouvelle fonction, <code>plot_profil()</code>, pour produire une figure affichant les profils des trois variables d’intérêt pour un nombre donné de mois. Cette fonction prend en entrée cinq arguments :</p>
<ul>
<li><code>n</code>, le nombre de mois pour lequel nous voulons afficher les profils,</li>
<li>les trois profils des variables environnementales d’intérêt (<code>pr_mint</code>, <code>pr_maxt</code> et <code>pr_pcp</code>), et</li>
<li>la variable temporelle <code>temps</code>.</li>
</ul>
<p>De plus, nous voulons améliorer quelque peu le rendu visuel obtenu avec la fonction <code>plot()</code>. Tout d’abord, nous souhaitons
utiliser les températures minimales et maximales moyennes pour créer une envelope de températures. Cela est possible en faisant appel à la fonction <code>polygon()</code>. Attention, la fonction <code>polygon()</code> n’est pas liée à la fonction <code>st_polygon()</code>!</p>
<p>La fonction <code>polygon(x,y,...)</code> dessine un polygone dont les coordonnées des sommets sont données par les vecteurs <code>x</code> et <code>y</code>.
Par exemple :</p>
<div class="sourceCode" id="cb1386"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1386-1"><a href="lecon_spatiotemp.html#cb1386-1" aria-hidden="true" tabindex="-1"></a><span class="co"># soit les vecteurs x et y des sommets du polygone</span></span>
<span id="cb1386-2"><a href="lecon_spatiotemp.html#cb1386-2" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>,<span class="dv">5</span><span class="sc">:</span><span class="dv">1</span>)</span>
<span id="cb1386-3"><a href="lecon_spatiotemp.html#cb1386-3" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">3</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">5</span>)</span>
<span id="cb1386-4"><a href="lecon_spatiotemp.html#cb1386-4" aria-hidden="true" tabindex="-1"></a><span class="co"># tracer le polygone de couleur rose délimité par une ligne rouge</span></span>
<span id="cb1386-5"><a href="lecon_spatiotemp.html#cb1386-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">6</span>),<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">5</span>), <span class="at">type =</span> <span class="st">&quot;n&quot;</span>)</span>
<span id="cb1386-6"><a href="lecon_spatiotemp.html#cb1386-6" aria-hidden="true" tabindex="-1"></a><span class="fu">polygon</span>(x, y, <span class="at">col =</span> <span class="st">&quot;pink&quot;</span>, <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">border =</span> <span class="st">&quot;red&quot;</span>)</span></code></pre></div>
<p><img src="Cours_SpatialR_files/figure-html/unnamed-chunk-552-1.svg" width="720" style="display: block; margin: auto;" />
<br></p>
<p>Deux remarques méritent d’être mentionnées :</p>
<ol style="list-style-type: lower-roman">
<li>Un polygone est une figure fermée. Le premier et le dernier sommets sont donc joints.</li>
<li>l’argument <code>type = "n"</code> dans la fonction <code>plot()</code> permet de créer une figure vide (dans laquelle on ajoute le polygone).</li>
</ol>
<p><br></p>
<p>Ainsi, pour créer une enveloppe, nous définissions les sommets du polygone en utilisant la variable temporelle <code>temps</code> pour définir les coordonnées en x, et les profils <code>pr_mint</code>et <code>pr_maxt</code> pour définir les coordonnées en y.</p>
<p>De plus, toujours dans l’objectif d’améliorer le rendu visuel de la figure, nous ajoutons les valeurs de précipitations sur la même figure que celle des températures.</p>
<p>La fonction <code>plot_profil()</code> prend la forme suivante :</p>
<div class="sourceCode" id="cb1387"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1387-1"><a href="lecon_spatiotemp.html#cb1387-1" aria-hidden="true" tabindex="-1"></a>plot_profil <span class="ot">&lt;-</span> <span class="cf">function</span>(n, pr_mint, pr_maxt, pr_pcp, temps) {</span>
<span id="cb1387-2"><a href="lecon_spatiotemp.html#cb1387-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Créer un vecteur allant de 1 à n</span></span>
<span id="cb1387-3"><a href="lecon_spatiotemp.html#cb1387-3" aria-hidden="true" tabindex="-1"></a>    id <span class="ot">&lt;-</span> <span class="fu">seq_len</span>(n)</span>
<span id="cb1387-4"><a href="lecon_spatiotemp.html#cb1387-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1387-5"><a href="lecon_spatiotemp.html#cb1387-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Premier affichage sur la figure: les temperatures </span></span>
<span id="cb1387-6"><a href="lecon_spatiotemp.html#cb1387-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># definition des paramètres (par) de ce premier graphique:</span></span>
<span id="cb1387-7"><a href="lecon_spatiotemp.html#cb1387-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># les marges (mar) et le style d&#39;écriture horizontal sur les axes (las = 1)</span></span>
<span id="cb1387-8"><a href="lecon_spatiotemp.html#cb1387-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="fl">4.5</span>, <span class="dv">1</span>, <span class="fl">4.5</span>), <span class="at">las =</span> <span class="dv">1</span>) </span>
<span id="cb1387-9"><a href="lecon_spatiotemp.html#cb1387-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># créer une figure vide (type = &quot;n&quot;) </span></span>
<span id="cb1387-10"><a href="lecon_spatiotemp.html#cb1387-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># dont la limite des axes est définie par les températures minimale et maximale</span></span>
<span id="cb1387-11"><a href="lecon_spatiotemp.html#cb1387-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot</span>(<span class="fu">range</span>(temps), <span class="fu">c</span>(<span class="fu">min</span>(pr_mint), <span class="fu">max</span>(pr_maxt)), <span class="at">type =</span> <span class="st">&quot;n&quot;</span>, </span>
<span id="cb1387-12"><a href="lecon_spatiotemp.html#cb1387-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">xlab =</span> <span class="st">&quot;Années&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;Températures minimales et maximales (°C)&quot;</span>)</span>
<span id="cb1387-13"><a href="lecon_spatiotemp.html#cb1387-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># créer une enveloppe </span></span>
<span id="cb1387-14"><a href="lecon_spatiotemp.html#cb1387-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">polygon</span>(<span class="fu">c</span>(temps[id], <span class="fu">rev</span>(temps[id])), <span class="fu">c</span>(pr_mint[id], pr_maxt[<span class="fu">rev</span>(id)]), <span class="at">col =</span> <span class="st">&quot;#aaaaaa&quot;</span>, <span class="at">border =</span> <span class="st">&quot;#6a6a6a&quot;</span>)</span>
<span id="cb1387-15"><a href="lecon_spatiotemp.html#cb1387-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1387-16"><a href="lecon_spatiotemp.html#cb1387-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Deuxième affichage sur la figure: les précipitations</span></span>
<span id="cb1387-17"><a href="lecon_spatiotemp.html#cb1387-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># permettre de recommencer à dessiner sur la figure </span></span>
<span id="cb1387-18"><a href="lecon_spatiotemp.html#cb1387-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">par</span>(<span class="at">new =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1387-19"><a href="lecon_spatiotemp.html#cb1387-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># créer une figure vide (type = &quot;n&quot;) </span></span>
<span id="cb1387-20"><a href="lecon_spatiotemp.html#cb1387-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># dont la limite des axes est définie par l&#39;étendue des valeurs de temps et de précipitations</span></span>
<span id="cb1387-21"><a href="lecon_spatiotemp.html#cb1387-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># sans ajout d&#39;axes (axes), et sans annotation sur les axes (ann)</span></span>
<span id="cb1387-22"><a href="lecon_spatiotemp.html#cb1387-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot</span>(<span class="fu">range</span>(temps), <span class="fu">range</span>(pr_pcp), <span class="at">type =</span> <span class="st">&quot;n&quot;</span>, <span class="at">axes =</span> <span class="cn">FALSE</span>, <span class="at">ann =</span> <span class="cn">FALSE</span>) </span>
<span id="cb1387-23"><a href="lecon_spatiotemp.html#cb1387-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ajouter des points pour chaque valeur du vecteur id</span></span>
<span id="cb1387-24"><a href="lecon_spatiotemp.html#cb1387-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">points</span>(temps[id], pr_pcp[id], <span class="at">type =</span> <span class="st">&quot;h&quot;</span>, <span class="at">col =</span> <span class="st">&quot;#c62b63&quot;</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb1387-25"><a href="lecon_spatiotemp.html#cb1387-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ajout d&#39;un axe à droite</span></span>
<span id="cb1387-26"><a href="lecon_spatiotemp.html#cb1387-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">axis</span>(<span class="dv">4</span>)</span>
<span id="cb1387-27"><a href="lecon_spatiotemp.html#cb1387-27" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ajouts d&#39;un texte à droite</span></span>
<span id="cb1387-28"><a href="lecon_spatiotemp.html#cb1387-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mtext</span>(<span class="st">&quot;Précipitations totales (mm)&quot;</span>, <span class="at">side =</span> <span class="dv">4</span>, <span class="at">line =</span> <span class="dv">3</span>, <span class="at">las =</span> <span class="dv">0</span>, <span class="at">col =</span> <span class="st">&quot;#c62b63&quot;</span>)</span>
<span id="cb1387-29"><a href="lecon_spatiotemp.html#cb1387-29" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1387-30"><a href="lecon_spatiotemp.html#cb1387-30" aria-hidden="true" tabindex="-1"></a> <span class="co"># Ajouter le mois en bas a gauche de la figure</span></span>
<span id="cb1387-31"><a href="lecon_spatiotemp.html#cb1387-31" aria-hidden="true" tabindex="-1"></a>   <span class="fu">mtext</span>(temps[n], <span class="at">side =</span> <span class="dv">1</span>, <span class="at">line =</span> <span class="fl">2.5</span>, <span class="at">at =</span> <span class="fu">as.Date</span>(<span class="st">&quot;2007-01-01&quot;</span>),<span class="at">cex =</span> <span class="fl">1.4</span>)</span>
<span id="cb1387-32"><a href="lecon_spatiotemp.html#cb1387-32" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><br></p>
<p>Nous devons maintenant passer les profils calculés précédemment à la fonction <code>plot_profil()</code> pour les afficher. Par exemple, pour visualiser les profils pour les 40 premiers mois, nous utilisons la valeur <code>40</code> pour <code>n</code>.</p>
<div class="sourceCode" id="cb1388"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1388-1"><a href="lecon_spatiotemp.html#cb1388-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_profil</span>(<span class="dv">40</span>, pr_mint, pr_maxt, pr_pcp, temps)</span></code></pre></div>
<p><img src="Cours_SpatialR_files/figure-html/plot_profil_40-1.svg" width="720" style="display: block; margin: auto;" />
<br></p>
<p>Finalement, nous utilisons la fonction <code>saveGIF()</code> de la bibliothèque <code>animation</code>, pour enregistrée une séquence de figures produites avec <code>plot_profil()</code> en faisant évoluer le nombre de mois :</p>
<div class="sourceCode" id="cb1389"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1389-1"><a href="lecon_spatiotemp.html#cb1389-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(animation)</span>
<span id="cb1389-2"><a href="lecon_spatiotemp.html#cb1389-2" aria-hidden="true" tabindex="-1"></a><span class="fu">saveGIF</span>({</span>
<span id="cb1389-3"><a href="lecon_spatiotemp.html#cb1389-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># nous générons une figure par trimestre en commençant au mois de mars </span></span>
<span id="cb1389-4"><a href="lecon_spatiotemp.html#cb1389-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq</span>(<span class="dv">3</span>, <span class="dv">120</span>, <span class="at">by =</span> <span class="dv">3</span>)) <span class="fu">plot_profil</span>(i, pr_mint, pr_maxt, pr_pcp, temps)</span>
<span id="cb1389-5"><a href="lecon_spatiotemp.html#cb1389-5" aria-hidden="true" tabindex="-1"></a>}, <span class="at">movie.name =</span> <span class="st">&quot;anim3.gif&quot;</span>, <span class="at">ani.height =</span> <span class="dv">400</span>, <span class="at">ani.width =</span> <span class="dv">600</span>)</span></code></pre></div>
<p><img src="Module9/images/anim3.gif" style="display: block; margin: auto;" /></p>
<!-- ![](Module9/images/anim3.gif)-->
<p><br></p>
</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="spatiotemp.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="ex_spatiotemp.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": [["Cours_SpatialR.pdf", "pdf"]],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection",
"scroll_highlight": true,
"edit": "https://github.com/sci1031/sci1031/edit/master/%s"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
